!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("siick",[],t):"object"==typeof exports?exports.siick=t():e.siick=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=21)}([function(e,t,n){"use strict";n(9);var i=n(1),o=n(29),r=n(17),a=n(30),s=n(31),l=n(32),c=(n(8),n(18)),u=n(7),d=n(20);let h;class f{constructor(e){this._initialize()}_initialize(){h=canvas.getContext("webgl2",{antialias:!0});let e=p();console.log("amx draw buffers",e.getParameter(e.MAX_DRAW_BUFFERS)),this.quad=new d.a,this.renderToShadowMap=!0,this.voxelize=!0,this.materialUBO=new o.a(new Float32Array(f.MATERIAL_DATA_CHUNK_SIZE)),this.modelMatricesUBO=new o.a([...i.a.create(),...i.a.create()]),this.guiUBO=new o.a(new Float32Array(600)),this.sceneUBO=new o.a(new Float32Array(500)),this.pointLightUBO=new o.a(new Float32Array(f.MAX_LIGHTS*f.LIGHT_DATA_CHUNK_SIZE)),this.directionalLightUBO=new o.a(new Float32Array(f.MAX_LIGHTS*f.LIGHT_DATA_CHUNK_SIZE)),this.shadowMapResolution=4096,this.sceneScale=3e3,this.standardShader=new a.a,this.shadowShader=new s.a,this.screenSpaceImageShader=new r.a,this.voxelConeTracer=new l.a(this.sceneScale,2e3,256,this.materialUBO,this.pointLightUBO,this.modelMatricesUBO,this.sceneUBO),this.sceneUBO.bind(),this.pointLightUBO.bind(),this.directionalLightUBO.bind(),this.modelMatricesUBO.bind(),this.materialUBO.bind(),this.guiUBO.bind()}_initShadowMap(e){const t=p();this.depthFBO=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.depthFBO),this.depthTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT16,this.shadowMapResolution,this.shadowMapResolution,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depthTexture,0),t.drawBuffers([t.NONE]),t.checkFramebufferStatus(t.FRAMEBUFFER)!=t.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+c.a.checkFrameBufferStatus(t.checkFramebufferStatus(t.FRAMEBUFFER))),this.shadowCam=new u.a(-this.sceneScale,this.sceneScale,-this.sceneScale,this.sceneScale,-this.sceneScale,this.sceneScale),this.shadowCam.position=i.c.fromValues(e[0],e[1],e[2]),this.shadowCam.lookAt(i.c.fromValues(0,0,0)),this.shadowCam.MVP=i.a.create(),i.a.multiply(this.shadowCam.MVP,this.shadowCam.projectionMatrix,this.shadowCam.viewMatrix),t.bindFramebuffer(t.FRAMEBUFFER,null)}_renderObject(e,t,n,i){this.modelMatricesUBO.update([...e.modelMatrix,...e.normalMatrix]);const o=e.materialData;this.materialUBO.update([...[...o.ambient,0],...[...o.diffuse,0],...[...o.specular,0],o.specularExponent,Boolean(o.mapDiffuse),Boolean(o.mapBump),Boolean(o.mapSpecular),Boolean(o.mapDissolve)]);const r=p();r.uniformBlockBinding(i,r.getUniformBlockIndex(i,"materialBuffer"),this.materialUBO.location),r.uniformBlockBinding(i,r.getUniformBlockIndex(i,"modelMatrices"),this.modelMatricesUBO.location),e.uploadTextures(i),e.draw()}_uploadLightning(e,t){for(let t=0;t<e.pointLights.length;t++){const n=e.pointLights[t];this.pointLightUBO.update([...[n.position[0],n.position[1],n.position[2],0],...n.color,n.intensity],t*f.LIGHT_DATA_CHUNK_SIZE)}}_renderShadowMapToScreen(){const e=p();this.screenSpaceImageShader.activate(),e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.uniform1i(e.getUniformLocation(this.screenSpaceImageShader.program,"Texture"),0),e.viewport(0,0,300*window.devicePixelRatio,300*window.devicePixelRatio),this.quad.draw(),e.viewport(0,0,e.canvas.width,e.canvas.height)}_debugLightning(e,t){e.pointLights.forEach(e=>{if(e._debug){const n=i.a.create();i.a.multiply(n,t.viewMatrix,e.modelMatrix),i.a.multiply(n,t.projectionMatrix,n),e.draw(n)}}),e.directionalLights.forEach(e=>{if(e._debug){const n=i.a.create();i.a.multiply(n,t.viewMatrix,e.modelMatrix),i.a.multiply(n,t.projectionMatrix,n),e.draw(n)}})}_internalRender(e,t){this.guiUBO.update([e.gui.bumpIntensity,e.gui.indirectLightningMultiplier,e.gui.directLightningMultiplier,e.gui.specularLightningMultiplier,e.gui.occlusionMultiplier,e.gui.voxelConeStepSize,e.gui.voxelConeMaxDist,e.gui.displayBump,e.gui.displayOcclusion]),this.renderToShadowMap&&(this._initShadowMap(e.directionalLights[0].direction),this._renderToShadowMap(e,t),this.renderToShadowMap=!1);const n=this.shadowCam.MVP;this.sceneUBO.update([...t.viewMatrix,...t.projectionMatrix,...n,...e.directionalLights[0].direction]),this._uploadLightning(e,t),e.gui.displayShadowMapTextureQuad&&this._renderShadowMapToScreen(),this.voxelize&&(this.voxelConeTracer.voxelize(e,t,this.depthTexture,this.sceneUBO,this.materialUBO,this.modelMatricesUBO),this.voxelize=!1),e.gui.showVoxels?this.voxelConeTracer.renderVoxelDebug(e,t,this.sceneUBO):e.gui.useVoxelGI?this.voxelConeTracer.render(e,t,this.depthTexture,this.guiUBO,this.sceneUBO,this.materialUBO,this.modelMatricesUBO):this._renderScene(e,t)}_renderScene(e,t){this.standardShader.activate();const n=p(),i=this.standardShader.program;n.uniform3fv(n.getUniformLocation(i,"camera_world"),t.position),n.activeTexture(n.TEXTURE0+4),n.bindTexture(n.TEXTURE_2D,this.depthTexture),n.uniform1i(n.getUniformLocation(i,"shadowMap"),4),n.uniformBlockBinding(i,n.getUniformBlockIndex(i,"guiDataBuffer"),this.guiUBO.location),n.uniformBlockBinding(i,n.getUniformBlockIndex(i,"sceneBuffer"),this.sceneUBO.location),e.objects.forEach(n=>{this._renderObject(n,e,t,i)})}_renderToShadowMap(e,t){const n=p();this.shadowShader.activate(),n.bindFramebuffer(n.FRAMEBUFFER,this.depthFBO),n.viewport(0,0,this.shadowMapResolution,this.shadowMapResolution),n.uniformMatrix4fv(n.getUniformLocation(this.shadowShader.program,"depthView"),!1,this.shadowCam.viewMatrix),n.uniformMatrix4fv(n.getUniformLocation(this.shadowShader.program,"depthProj"),!1,this.shadowCam.projectionMatrix),e.objects.forEach(e=>{this.modelMatricesUBO.update([...e.modelMatrix,...e.normalMatrix]),n.uniformBlockBinding(this.shadowShader.program,n.getUniformBlockIndex(this.shadowShader.program,"modelMatrices"),this.modelMatricesUBO.location),e.draw()}),n.viewport(0,0,n.canvas.width,n.canvas.height),n.bindFramebuffer(n.FRAMEBUFFER,null)}setSize(e,t){const n=e*window.devicePixelRatio,i=t*window.devicePixelRatio,o=p();o.canvas.width=n,o.canvas.height=i,o.canvas.style.width=`${n/window.devicePixelRatio}px`,o.canvas.style.height=`${i/window.devicePixelRatio}px`}render(e,t){const n=p();n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(127,127,213,1),n.clearDepth(1),n.cullFace(n.BACK),n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this._internalRender(e,t)}}f.LIGHT_DATA_CHUNK_SIZE=12,f.MATERIAL_DATA_CHUNK_SIZE=50,f.MAX_LIGHTS=16,f.MAX_MATERIALS=25;const p=()=>h;t.b=p,t.a=f},function(e,t,n){"use strict";n(2),n(22),n(23),n(10);var i=n(24),o=n(25),r=(n(26),n(11)),a=n(12);n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return r}),n.d(t,"d",function(){return a})},function(e,t,n){"use strict";n.d(t,"a",function(){return o});const i=1e-6;t.b=i;let o="undefined"!=typeof Float32Array?Float32Array:Array;const r=Math.random;t.c=r;Math.PI},function(e,t,n){"use strict";function i(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(i)),e.deleteShader(i),null)}t.a=((e,t,n)=>{const o=i(e,e.VERTEX_SHADER,t),r=i(e,e.FRAGMENT_SHADER,n),a=e.createProgram();if(e.attachShader(a,o),e.attachShader(a,r),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS))return a;alert("Unable to initialize the shader program: "+e.getProgramInfoLog(a))})},function(e,t,n){"use strict";var i=n(0);class o{constructor(){const e=Object(i.b)();this._textureId=e.createTexture()}createTexture(e){const t=Object(i.b)();this._level=0,this._internalFormat=t.RGBA4,this._width=e.width,this._height=e.height,this._border=0,this._format=t.RGBA,this._dataType=t.UNSIGNED_BYTE,this._data=e,this.bind(),t.texImage2D(t.TEXTURE_2D,this._level,this._internalFormat,this._width,this._height,this._border,this._format,this._dataType,this._data),this._width&&this._height||console.err("Missing width or height"),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR)}bind(){const e=Object(i.b)();e.bindTexture(e.TEXTURE_2D,this._textureId)}}t.a=o},function(e,t,n){"use strict";var i=n(1);class o{constructor(){this.quaternionAxisAngle=i.c.create(),this.position=i.c.create(),this.rotation=i.c.create(),this.scale=i.c.fromValues(1,1,1),this.quaternion=i.b.create(),this.modelMatrix=i.a.create()}update(){i.a.identity(this.modelMatrix),i.b.identity(this.quaternion),i.b.rotateX(this.quaternion,this.quaternion,this.rotation[0]),i.b.rotateY(this.quaternion,this.quaternion,this.rotation[1]),i.b.rotateZ(this.quaternion,this.quaternion,this.rotation[2]);const e=i.b.getAxisAngle(this.quaternionAxisAngle,this.quaternion);i.a.translate(this.modelMatrix,this.modelMatrix,this.position),i.a.rotate(this.modelMatrix,this.modelMatrix,e,this.quaternionAxisAngle),i.a.scale(this.modelMatrix,this.modelMatrix,this.scale)}}t.a=o},function(e,t,n){"use strict";var i=n(14);class o{constructor(e,t=0){const n=.5+Math.sqrt(5)/2;let o=[-1,+n,0,1,+n,0,-1,-n,0,1,-n,0,0,-1,+n,0,1,+n,0,-1,-n,0,1,-n,+n,0,-1,+n,0,1,-n,0,-1,-n,0,1];const r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],a=[];let s={faces:Object(i.d)(r,3),positions:Object(i.d)(o,3)},l=Math.min(t,3);for(;l-- >0;)s=this.subdivide(s);for(let e=0;e<s.positions.length;e++){const t=this.normalize(s.positions[e]),n=.5*(-Math.atan2(t[2],-t[0])/Math.PI+1),i=.5+Math.asin(t[1])/Math.PI;a.push([1-n,1-i])}o=s.positions;for(let t=0;t<o.length;t++)this.scale(o[t],e);const c={positions:Object(i.a)(s.positions),indices:Object(i.a)(s.faces),normals:null,uvs:Object(i.a)(a,2)};return c.normals=Object(i.b)(c.positions,c.indices),c}fixPoleUVs(e,t,n){function i(t,i,o,r){const c=n[o],u=n[r];n[i][0]=(c[0]+u[0])/2,l++,a.push(e[i].slice()),s.push(n[i].slice()),t[0]=l}const o=this.firstYIndex(e,1),r=this.firstYIndex(e,-1);if(-1===o||-1===r)return;const a=e.slice(),s=n.slice();let l=a.length-1;for(let e=0;e<t.length;++e){const n=t[e],a=n[0],s=n[1],l=n[2];a===o?i(n,o,s,l):a===r&&i(n,r,s,l)}e=a,n=s}firstYIndex(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(Math.abs(i[1]-t)<=1e-4)return n}return-1}normalize(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];if(0===(t=Math.sqrt(t)))return Array.apply(null,new Array(e.length)).map(Number.prototype.valueOf,0);for(let n=0;n<e.length;n++)e[n]/=t;return e}scale(e,t){for(let n=0;n<e.length;n++)e[n]*=t;return e}subdivide(e){function t(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2,(e[2]+t[2])/2]}function n(e){return`${e[0].toPrecision(6)},${e[1].toPrecision(6)},${e[2].toPrecision(6)}`}function i(e,i){const o=t(e,i),r=n(o),a=l[r];return a||(l[r]=o,l[r])}const{positions:o,faces:r}=e,a=[],s=[],l={};let c=0;for(let e=0;e<r.length;e++){const t=r[e],n=t[0],l=t[1],u=t[2],d=o[n],h=o[l],f=o[u],p=i(d,h),m=i(h,f),v=i(f,d);let _=s.indexOf(p);-1===_&&(_=c++,s.push(p));let b=s.indexOf(m);-1===b&&(b=c++,s.push(m));let g=s.indexOf(v);-1===g&&(g=c++,s.push(v));let x=s.indexOf(d);-1===x&&(x=c++,s.push(d));let M=s.indexOf(h);-1===M&&(M=c++,s.push(h));let y=s.indexOf(f);-1===y&&(y=c++,s.push(f)),a.push([x,_,g]),a.push([M,b,_]),a.push([y,g,b]),a.push([_,b,g])}return{faces:a,positions:s}}}t.a=o},function(e,t,n){"use strict";var i=n(5),o=n(1);n(0);class r extends i.a{constructor(e,t,n,i,r,a){super(),this.left=e,this.right=t,this.bottom=n,this.top=i,this.near=r,this.far=a,this.up=o.c.fromValues(0,1,0),this.position=o.c.fromValues(0,0,0),this.projectionMatrix=o.a.create(),this.viewMatrix=o.a.create(),this.updateProjectionMatrix(e,t,n,i,r,a),this.lookAt(o.c.fromValues(-1,0,0))}lookAt(e){o.a.lookAt(this.viewMatrix,this.position,e,this.up)}updateProjectionMatrix(e,t,n,i,r,a){o.a.ortho(this.projectionMatrix,e,t,n,i,r,a)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=n(5),r=n(4),a=n(1);class s extends o.a{constructor(e,t){super(),this._normalMatrix=a.a.create(),this._geometry=e,this._indices=t,this._buffers=this._initializeBuffers()}get normalMatrix(){return this._normalMatrix}get shaders(){return this._shaders}get indexCount(){return this._indexCount}get buffers(){return this._buffers}set normalMatrix(e){this._normalMatrix=e}setMaterialData(e){this.materialData=e,e.mapSpecular&&(this._specularMap=new r.a,this._specularMap.createTexture(e.mapSpecular.texture)),e.mapDiffuse&&(this._diffuseMap=new r.a,this._diffuseMap.createTexture(e.mapDiffuse.texture)),e.mapBump&&(this._bumpMap=new r.a,this._bumpMap.createTexture(e.mapBump.texture)),e.mapDissolve&&(this._dissolveMap=new r.a,this._dissolveMap.createTexture(e.mapDissolve.texture))}uploadTextures(e){const t=Object(i.b)();let n;this._diffuseMap&&(t.activeTexture(t.TEXTURE0+0),this._diffuseMap.bind(),n=t.getUniformLocation(e,"textureMap"),t.uniform1i(n,0)),this._bumpMap&&(t.activeTexture(t.TEXTURE0+1),this._bumpMap.bind(),n=t.getUniformLocation(e,"bumpMap"),t.uniform1i(n,1)),this._specularMap&&(t.activeTexture(t.TEXTURE0+2),this._specularMap.bind(),n=t.getUniformLocation(e,"specularMap"),t.uniform1i(n,2)),this._dissolveMap&&(t.activeTexture(t.TEXTURE0+3),this._dissolveMap.bind(),n=t.getUniformLocation(e,"dissolveMap"),t.uniform1i(n,3))}_initializeBuffers(){const e=this._geometry,t=Object(i.b)();this._vao=t.createVertexArray(),t.bindVertexArray(this._vao);{const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.positions),t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0)}{const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.normals),t.STATIC_DRAW),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,3,t.FLOAT,!1,0,0)}{const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.uvs),t.STATIC_DRAW),t.enableVertexAttribArray(2),t.vertexAttribPointer(2,2,t.FLOAT,!1,0,0)}if(e.tangents){const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.tangents),t.STATIC_DRAW),t.enableVertexAttribArray(3),t.vertexAttribPointer(3,3,t.FLOAT,!1,0,0)}if(e.bitangents){const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.bitangents),t.STATIC_DRAW),t.enableVertexAttribArray(4),t.vertexAttribPointer(4,3,t.FLOAT,!1,0,0)}const n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(this._indices),t.STATIC_DRAW)}draw(){const e=Object(i.b)();e.bindVertexArray(this._vao),e.drawElements(e.TRIANGLES,this._indices.length,e.UNSIGNED_INT,0)}}t.a=s},function(e,t,n){"use strict";var i=n(1),o=n(27),r=n(13),a=n(16);class s{constructor(){this.objects=[],this.pointLights=[],this.directionalLights=[],this._gui=new o.a}get gui(){return this._gui}add(e){if(e instanceof r.a){const t=e;this.pointLights.push(t);const n=this._gui.lights.addFolder("Light "+this.pointLights.length);return n.add(t.position,"x",-1e3,1e3).name("Pos x"),n.add(t.position,"y",-1e3,1e3).name("Pos y"),void n.add(t.position,"z",-1e3,1e3).name("Pos z")}if(e instanceof a.a){const t=e;this.directionalLights.push(t)}else this.objects.push(e)}traverse(e){this._gui;e.setFov(this._gui.fov);for(let t=0;t<this.objects.length;++t){this.objects[t].update();const n=this.objects[t].modelMatrix,o=i.a.create(),r=i.a.create();i.a.multiply(r,e.viewMatrix,n),i.a.invert(o,r),i.a.transpose(this.objects[t].normalMatrix,o)}for(let e=0;e<this.pointLights.length;e++)this.pointLights[e].update()}}t.a=s},function(e,t,n){"use strict";t.a=function(){let e=new i.a(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e};var i=n(2)},function(e,t,n){"use strict";function i(){let e=new p.a(3);return e[0]=0,e[1]=0,e[2]=0,e}function o(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function r(e,t,n){let i=new p.a(3);return i[0]=e,i[1]=t,i[2]=n,i}function a(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function s(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function l(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function c(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+i*i+o*o)}function u(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return n*n+i*i+o*o}function d(e){let t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function h(e,t){let n=t[0],i=t[1],o=t[2],r=n*n+i*i+o*o;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r),e}function f(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){var t=new p.a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=o,t.fromValues=r,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},t.subtract=a,t.multiply=s,t.divide=l,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},t.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},t.distance=c,t.squaredDistance=u,t.squaredLength=d,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=h,t.dot=f,t.cross=function(e,t,n){let i=t[0],o=t[1],r=t[2],a=n[0],s=n[1],l=n[2];return e[0]=o*l-r*s,e[1]=r*a-i*l,e[2]=i*s-o*a,e},t.lerp=function(e,t,n,i){let o=t[0],r=t[1],a=t[2];return e[0]=o+i*(n[0]-o),e[1]=r+i*(n[1]-r),e[2]=a+i*(n[2]-a),e},t.hermite=function(e,t,n,i,o,r){let a=r*r,s=a*(2*r-3)+1,l=a*(r-2)+r,c=a*(r-1),u=a*(3-2*r);return e[0]=t[0]*s+n[0]*l+i[0]*c+o[0]*u,e[1]=t[1]*s+n[1]*l+i[1]*c+o[1]*u,e[2]=t[2]*s+n[2]*l+i[2]*c+o[2]*u,e},t.bezier=function(e,t,n,i,o,r){let a=1-r,s=a*a,l=r*r,c=s*a,u=3*r*s,d=3*l*a,h=l*r;return e[0]=t[0]*c+n[0]*u+i[0]*d+o[0]*h,e[1]=t[1]*c+n[1]*u+i[1]*d+o[1]*h,e[2]=t[2]*c+n[2]*u+i[2]*d+o[2]*h,e},t.random=function(e,t){t=t||1;let n=2*p.c()*Math.PI,i=2*p.c()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=i*t,e},t.transformMat4=function(e,t,n){let i=t[0],o=t[1],r=t[2],a=n[3]*i+n[7]*o+n[11]*r+n[15];return a=a||1,e[0]=(n[0]*i+n[4]*o+n[8]*r+n[12])/a,e[1]=(n[1]*i+n[5]*o+n[9]*r+n[13])/a,e[2]=(n[2]*i+n[6]*o+n[10]*r+n[14])/a,e},t.transformMat3=function(e,t,n){let i=t[0],o=t[1],r=t[2];return e[0]=i*n[0]+o*n[3]+r*n[6],e[1]=i*n[1]+o*n[4]+r*n[7],e[2]=i*n[2]+o*n[5]+r*n[8],e},t.transformQuat=function(e,t,n){let i=t[0],o=t[1],r=t[2],a=n[0],s=n[1],l=n[2],c=n[3],u=c*i+s*r-l*o,d=c*o+l*i-a*r,h=c*r+a*o-s*i,f=-a*i-s*o-l*r;return e[0]=u*c+f*-a+d*-l-h*-s,e[1]=d*c+f*-s+h*-a-u*-l,e[2]=h*c+f*-l+u*-s-d*-a,e},t.rotateX=function(e,t,n,i){let o=[],r=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],r[0]=o[0],r[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),r[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e},t.rotateY=function(e,t,n,i){let o=[],r=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],r[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),r[1]=o[1],r[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e},t.rotateZ=function(e,t,n,i){let o=[],r=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],r[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),r[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),r[2]=o[2],e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e},t.angle=function(e,t){let n=r(e[0],e[1],e[2]),i=r(t[0],t[1],t[2]);h(n,n),h(i,i);let o=f(n,i);return o>1?0:o<-1?Math.PI:Math.acos(o)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){let n=e[0],i=e[1],o=e[2],r=t[0],a=t[1],s=t[2];return Math.abs(n-r)<=p.b*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-a)<=p.b*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(o-s)<=p.b*Math.max(1,Math.abs(o),Math.abs(s))};var p=n(2);const m=a;t.sub=m;const v=s;t.mul=v;const _=l;t.div=_;const b=c;t.dist=b;const g=u;t.sqrDist=g;const x=o;t.len=x;const M=d;t.sqrLen=M;const y=function(){let e=i();return function(t,n,i,o,r,a){let s,l;for(n||(n=3),i||(i=0),l=o?Math.min(o*n+i,t.length):t.length,s=i;s<l;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],r(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();t.forEach=y},function(e,t,n){"use strict";function i(){let e=new f.a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function o(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function r(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function a(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function s(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function l(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],r=t[3]-e[3];return Math.sqrt(n*n+i*i+o*o+r*r)}function c(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],r=t[3]-e[3];return n*n+i*i+o*o+r*r}function u(e){let t=e[0],n=e[1],i=e[2],o=e[3];return Math.sqrt(t*t+n*n+i*i+o*o)}function d(e){let t=e[0],n=e[1],i=e[2],o=e[3];return t*t+n*n+i*i+o*o}function h(e,t){let n=t[0],i=t[1],o=t[2],r=t[3],a=n*n+i*i+o*o+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=n*a,e[1]=i*a,e[2]=o*a,e[3]=r*a),e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){let t=new f.a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,n,i){let o=new f.a(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,n,i,o){return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=o,t.multiply=r,t.divide=a,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=s,t.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},t.distance=l,t.squaredDistance=c,t.length=u,t.squaredLength=d,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=h,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,n,i){let o=t[0],r=t[1],a=t[2],s=t[3];return e[0]=o+i*(n[0]-o),e[1]=r+i*(n[1]-r),e[2]=a+i*(n[2]-a),e[3]=s+i*(n[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=f.c(),e[1]=f.c(),e[2]=f.c(),e[3]=f.c(),h(e,e),s(e,e,t),e},t.transformMat4=function(e,t,n){let i=t[0],o=t[1],r=t[2],a=t[3];return e[0]=n[0]*i+n[4]*o+n[8]*r+n[12]*a,e[1]=n[1]*i+n[5]*o+n[9]*r+n[13]*a,e[2]=n[2]*i+n[6]*o+n[10]*r+n[14]*a,e[3]=n[3]*i+n[7]*o+n[11]*r+n[15]*a,e},t.transformQuat=function(e,t,n){let i=t[0],o=t[1],r=t[2],a=n[0],s=n[1],l=n[2],c=n[3],u=c*i+s*r-l*o,d=c*o+l*i-a*r,h=c*r+a*o-s*i,f=-a*i-s*o-l*r;return e[0]=u*c+f*-a+d*-l-h*-s,e[1]=d*c+f*-s+h*-a-u*-l,e[2]=h*c+f*-l+u*-s-d*-a,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let n=e[0],i=e[1],o=e[2],r=e[3],a=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(n-a)<=f.b*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=f.b*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-l)<=f.b*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(r-c)<=f.b*Math.max(1,Math.abs(r),Math.abs(c))};var f=n(2);const p=o;t.sub=p;const m=r;t.mul=m;const v=a;t.div=v;const _=l;t.dist=_;const b=c;t.sqrDist=b;const g=u;t.len=g;const x=d;t.sqrLen=x;const M=function(){let e=i();return function(t,n,i,o,r,a){let s,l;for(n||(n=4),i||(i=0),l=o?Math.min(o*n+i,t.length):t.length,s=i;s<l;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],r(e,e,a),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();t.forEach=M},function(e,t,n){"use strict";var i=n(5),o=n(1),r=n(6),a=n(0),s=n(15);class l extends i.a{constructor(e){if(super(),this._debug=e.debug,this._color=e&&e.color||[1,1,1,1],this._intensity=e&&e.intensity||.5,this._positionViewSpace=o.c.create(),e.debug){const e=new r.a(3.2,6),t=Object(a.b)(),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.positions),t.STATIC_DRAW);const i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.indices),t.STATIC_DRAW),this._indexCount=e.indices.length,this.buffers={positions:n,indices:i},this._shader=new s.a}}get color(){return this._color}get intensity(){return this._intensity}set color(e){this._color=e}set intensity(e){this._intensity=e}draw(e){console.assert(this._debug);const t=Object(a.b)(),n=this._shader.programInfo;this._shader.activate(),t.uniformMatrix4fv(n.uniformLocations.mvp,!1,e),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.positions),t.enableVertexAttribArray(n.attribLocations.position),t.vertexAttribPointer(n.attribLocations.position,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffers.indices),t.drawElements(t.TRIANGLES,this._indexCount,t.UNSIGNED_INT,0)}}t.a=l},function(e,t,n){"use strict";function i(e){let t=[];for(let n=0;n<e.length;++n)Array.isArray(e[n])||e[n]instanceof Float32Array?t=t.concat(i(e[n])):t.push(e[n]);return t}function o(e,t){const n=[];for(let i=0;i<e.length;i+=t){const o=[];for(let n=0;n<t;n++)o.push(e[i+n]);n.push(o)}return n}function r(e,t){const n=o(t,3),r=o(e,3),s=[],l=a.c.create(),c=a.c.create(),u=a.c.create();let d,h,f;for(let e=0;e<n.length;e++){const t=n[e],i=t[0],o=t[1],p=t[2];d=r[i],h=r[o],f=r[p],a.c.subtract(l,f,h),a.c.subtract(c,d,h),a.c.cross(u,l,c),void 0===s[i]&&(s[i]=a.c.create()),void 0===s[o]&&(s[o]=a.c.create()),void 0===s[p]&&(s[p]=a.c.create()),a.c.add(s[i],s[i],u),a.c.add(s[o],s[o],u),a.c.add(s[p],s[p],u)}for(let e=0;e<s.length;e++)a.c.normalize(s[e],s[e]);return i(s,3)}t.a=i,t.d=o,t.c=function(e){const t=[];for(let n=0;n<e.length;++n)t[n]=.5;return t},t.b=r;var a=n(1)},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));class r{constructor(){`#version 300 es\n            precision mediump float;\n\n            uniform mat4 mvp;\n            in vec3 position;            \n\n            void main() {\n                gl_Position = mvp * vec4(position, 1.0);\n            }\n            `,`#version 300 es\n        precision mediump float;\n\n        out vec4 outColor;\n\n        void main() {\n            outColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }\n        `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision mediump float;\n\n            uniform mat4 mvp;\n            in vec3 position;            \n\n            void main() {\n                gl_Position = mvp * vec4(position, 1.0);\n            }\n            ","#version 300 es\n        precision mediump float;\n\n        out vec4 outColor;\n\n        void main() {\n            outColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }\n        "),this.programInfo={attribLocations:{position:e.getAttribLocation(this.program,"position")},uniformLocations:{mvp:e.getUniformLocation(this.program,"mvp")}}}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(5),o=n(1),r=n(6),a=n(0),s=n(15);class l extends i.a{constructor(e){if(super(),this._color=e&&e.color||[1,1,1,1],this._intensity=e&&e.intensity||.5,this.direction=e&&o.d.fromValues(e.direction[0],e.direction[1],e.direction[2],e.direction[3])||[0,-20,0,1],e.debug){const e=new r.a(3.2,6),t=Object(a.b)(),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.positions),t.STATIC_DRAW);const i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.indices),t.STATIC_DRAW),this._indexCount=e.indices.length,this.buffers={positions:n,indices:i},this._shader=new s.a}}get color(){return this._color}get intensity(){return this._intensity}set color(e){this._color=e}set intensity(e){this._intensity=e}draw(e){console.assert(this._debug);const t=Object(a.b)(),n=this._shader.programInfo;this._shader.activate(),t.uniformMatrix4fv(n.uniformLocations.mvp,!1,e),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.positions),t.enableVertexAttribArray(n.attribLocations.position),t.vertexAttribPointer(n.attribLocations.position,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffers.indices),t.drawElements(t.TRIANGLES,this._indexCount,t.UNSIGNED_INT,0)}}t.a=l},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));n(4);class r{constructor(){`#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 VertexPosition_model;\n\n            out vec2 vUv;\n\n            void main(){\n                gl_Position =  vec4(VertexPosition_model, 1);\n                vUv  = (VertexPosition_model.xy + vec2(1, 1))/2.0f;\n            }            \n        `,`#version 300 es \n            precision highp float;\n            in vec2 vUv;\n\n            layout(location = 0) out vec4 outColor;\n            \n            uniform sampler2D Texture;\n            \n            void main(){\n                float res = texture(Texture, vUv).r;\n                outColor = vec4(res, res, res, 1.0);\n\n                //vec3 res = vec3(worldPosition);\n\n                //outColor = vec4(normalize(res), 1.0);\n                //outColor = vec4(texture(Texture, vUv).rgb, 1.0);\n            }\n            \n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 VertexPosition_model;\n\n            out vec2 vUv;\n\n            void main(){\n                gl_Position =  vec4(VertexPosition_model, 1);\n                vUv  = (VertexPosition_model.xy + vec2(1, 1))/2.0f;\n            }            \n        ","#version 300 es \n            precision highp float;\n            in vec2 vUv;\n\n            layout(location = 0) out vec4 outColor;\n            \n            uniform sampler2D Texture;\n            \n            void main(){\n                float res = texture(Texture, vUv).r;\n                outColor = vec4(res, res, res, 1.0);\n\n                //vec3 res = vec3(worldPosition);\n\n                //outColor = vec4(normalize(res), 1.0);\n                //outColor = vec4(texture(Texture, vUv).rgb, 1.0);\n            }\n            \n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0);class o{constructor(e,t){const n=Object(i.b)();this.fbo=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),n.getExtension("EXT_color_buffer_float"),this.colorBuffer=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.colorBuffer),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texImage2D(n.TEXTURE_2D,0,n.RGBA16F,e,t,0,n.RGBA,n.FLOAT,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.colorBuffer,0),this.renderBuffer=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.renderBuffer);const r=n.getError();console.assert(r==n.NO_ERROR);const a=n.checkFramebufferStatus(n.FRAMEBUFFER);a!=n.FRAMEBUFFER_COMPLETE&&console.error(o.checkFrameBufferStatus(a)),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null)}static checkFrameBufferStatus(e){const t=Object(i.b)();switch(e){case t.FRAMEBUFFER_COMPLETE:return"Framebuffer complete!";case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Framebuffer incomplete attachment";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"Framebuffer incomplete missing attachment";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Framebuffer incomplete dimensions!";case t.FRAMEBUFFER_UNSUPPORTED:return"Framebuffer unsupported!";case t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Framebuffer incomplete multisample!";case t.RENDERBUFFER_SAMPLES:return"Framebuffer samples!";default:return"WTF FBO!"}}transitionToShaderResource(e){const t=Object(i.b)();t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.colorBuffer),t.uniform1i(t.getUniformLocation(e,"Texture"),1)}bind(){const e=Object(i.b)();e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer)}}t.a=o},function(e,t,n){"use strict";class i{constructor(e,t,n){const i=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];for(let o=0;o<i.length;o+=3)i[o+0]*=e,i[o+1]*=t,i[o+2]*=n;return{indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],geometry:{positions:i,uvs:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]}}}}t.a=i},function(e,t,n){"use strict";var i=n(0),o=n(5);class r extends o.a{constructor(e,t){super(),this.positions=[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0];const n=Object(i.b)();this._vao=n.createVertexArray(),n.bindVertexArray(this._vao);{const e=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,new Float32Array(this.positions),n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,3,n.FLOAT,!1,0,0)}}draw(){const e=Object(i.b)();e.bindVertexArray(this._vao),e.drawArrays(e.TRIANGLES,0,6)}}t.a=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"Material",function(){return Material}),n.d(t,"BasicMaterial",function(){return BasicMaterial});var i=n(0),o=n(19),r=n(6),a=n(9),s=n(8),l=n(37),c=n(7),u=n(38),d=n(40),h=n(13),f=n(16),p=n(41),m=n(43);n.d(t,"ObjectLoader",function(){return p.a}),n.d(t,"Renderer",function(){return i.a}),n.d(t,"Cube",function(){return o.a}),n.d(t,"Sphere",function(){return r.a}),n.d(t,"Mesh",function(){return s.a}),n.d(t,"Scene",function(){return a.a}),n.d(t,"PerspectiveCamera",function(){return l.a}),n.d(t,"OrthographicCamera",function(){return c.a}),n.d(t,"OrbitControls",function(){return u.a}),n.d(t,"FlyControls",function(){return d.a}),n.d(t,"PointLight",function(){return h.a}),n.d(t,"DirectionalLight",function(){return f.a}),n.d(t,"ResourceLoader",function(){return m.a}),Object.defineProperty(Float32Array.prototype,"x",{get:function(){return this[0]},set:function(e){this[0]=e}}),Object.defineProperty(Float32Array.prototype,"y",{get:function(){return this[1]},set:function(e){this[1]=e}}),Object.defineProperty(Float32Array.prototype,"z",{get:function(){return this[2]},set:function(e){this[2]=e}})},function(e,t,n){"use strict";n(2)},function(e,t,n){"use strict";n(2)},function(e,t,n){"use strict";function i(e,t,n){let i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],f=t[10],p=t[11],m=t[12],v=t[13],_=t[14],b=t[15],g=n[0],x=n[1],M=n[2],y=n[3];return e[0]=g*i+x*s+M*d+y*m,e[1]=g*o+x*l+M*h+y*v,e[2]=g*r+x*c+M*f+y*_,e[3]=g*a+x*u+M*p+y*b,g=n[4],x=n[5],M=n[6],y=n[7],e[4]=g*i+x*s+M*d+y*m,e[5]=g*o+x*l+M*h+y*v,e[6]=g*r+x*c+M*f+y*_,e[7]=g*a+x*u+M*p+y*b,g=n[8],x=n[9],M=n[10],y=n[11],e[8]=g*i+x*s+M*d+y*m,e[9]=g*o+x*l+M*h+y*v,e[10]=g*r+x*c+M*f+y*_,e[11]=g*a+x*u+M*p+y*b,g=n[12],x=n[13],M=n[14],y=n[15],e[12]=g*i+x*s+M*d+y*m,e[13]=g*o+x*l+M*h+y*v,e[14]=g*r+x*c+M*f+y*_,e[15]=g*a+x*u+M*p+y*b,e}function o(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new r.a(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){let t=new r.a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,n,i,o,a,s,l,c,u,d,h,f,p,m,v){let _=new r.a(16);return _[0]=e,_[1]=t,_[2]=n,_[3]=i,_[4]=o,_[5]=a,_[6]=s,_[7]=l,_[8]=c,_[9]=u,_[10]=d,_[11]=h,_[12]=f,_[13]=p,_[14]=m,_[15]=v,_},t.set=function(e,t,n,i,o,r,a,s,l,c,u,d,h,f,p,m,v){return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e[4]=r,e[5]=a,e[6]=s,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=h,e[12]=f,e[13]=p,e[14]=m,e[15]=v,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){let n=t[1],i=t[2],o=t[3],r=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=r,e[11]=t[14],e[12]=o,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){let n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],v=t[14],_=t[15],b=n*s-i*a,g=n*l-o*a,x=n*c-r*a,M=i*l-o*s,y=i*c-r*s,E=o*c-r*l,w=u*m-d*p,T=u*v-h*p,A=u*_-f*p,R=d*v-h*m,S=d*_-f*m,F=h*_-f*v,B=b*F-g*S+x*R+M*A-y*T+E*w;return B?(B=1/B,e[0]=(s*F-l*S+c*R)*B,e[1]=(o*S-i*F-r*R)*B,e[2]=(m*E-v*y+_*M)*B,e[3]=(h*y-d*E-f*M)*B,e[4]=(l*A-a*F-c*T)*B,e[5]=(n*F-o*A+r*T)*B,e[6]=(v*x-p*E-_*g)*B,e[7]=(u*E-h*x+f*g)*B,e[8]=(a*S-s*A+c*w)*B,e[9]=(i*A-n*S-r*w)*B,e[10]=(p*y-m*x+_*b)*B,e[11]=(d*x-u*y-f*b)*B,e[12]=(s*T-a*R-l*w)*B,e[13]=(n*R-i*T+o*w)*B,e[14]=(m*g-p*M-v*b)*B,e[15]=(u*M-d*g+h*b)*B,e):null},t.adjoint=function(e,t){let n=t[0],i=t[1],o=t[2],r=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],f=t[11],p=t[12],m=t[13],v=t[14],_=t[15];return e[0]=s*(h*_-f*v)-d*(l*_-c*v)+m*(l*f-c*h),e[1]=-(i*(h*_-f*v)-d*(o*_-r*v)+m*(o*f-r*h)),e[2]=i*(l*_-c*v)-s*(o*_-r*v)+m*(o*c-r*l),e[3]=-(i*(l*f-c*h)-s*(o*f-r*h)+d*(o*c-r*l)),e[4]=-(a*(h*_-f*v)-u*(l*_-c*v)+p*(l*f-c*h)),e[5]=n*(h*_-f*v)-u*(o*_-r*v)+p*(o*f-r*h),e[6]=-(n*(l*_-c*v)-a*(o*_-r*v)+p*(o*c-r*l)),e[7]=n*(l*f-c*h)-a*(o*f-r*h)+u*(o*c-r*l),e[8]=a*(d*_-f*m)-u*(s*_-c*m)+p*(s*f-c*d),e[9]=-(n*(d*_-f*m)-u*(i*_-r*m)+p*(i*f-r*d)),e[10]=n*(s*_-c*m)-a*(i*_-r*m)+p*(i*c-r*s),e[11]=-(n*(s*f-c*d)-a*(i*f-r*d)+u*(i*c-r*s)),e[12]=-(a*(d*v-h*m)-u*(s*v-l*m)+p*(s*h-l*d)),e[13]=n*(d*v-h*m)-u*(i*v-o*m)+p*(i*h-o*d),e[14]=-(n*(s*v-l*m)-a*(i*v-o*m)+p*(i*l-o*s)),e[15]=n*(s*h-l*d)-a*(i*h-o*d)+u*(i*l-o*s),e},t.determinant=function(e){let t=e[0],n=e[1],i=e[2],o=e[3],r=e[4],a=e[5],s=e[6],l=e[7],c=e[8],u=e[9],d=e[10],h=e[11],f=e[12],p=e[13],m=e[14],v=e[15];return(t*a-n*r)*(d*v-h*m)-(t*s-i*r)*(u*v-h*p)+(t*l-o*r)*(u*m-d*p)+(n*s-i*a)*(c*v-h*f)-(n*l-o*a)*(c*m-d*f)+(i*l-o*s)*(c*p-u*f)},t.multiply=i,t.translate=function(e,t,n){let i,o,r,a,s,l,c,u,d,h,f,p,m=n[0],v=n[1],_=n[2];return t===e?(e[12]=t[0]*m+t[4]*v+t[8]*_+t[12],e[13]=t[1]*m+t[5]*v+t[9]*_+t[13],e[14]=t[2]*m+t[6]*v+t[10]*_+t[14],e[15]=t[3]*m+t[7]*v+t[11]*_+t[15]):(i=t[0],o=t[1],r=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],f=t[10],p=t[11],e[0]=i,e[1]=o,e[2]=r,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=h,e[10]=f,e[11]=p,e[12]=i*m+s*v+d*_+t[12],e[13]=o*m+l*v+h*_+t[13],e[14]=r*m+c*v+f*_+t[14],e[15]=a*m+u*v+p*_+t[15]),e},t.scale=function(e,t,n){let i=n[0],o=n[1],r=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,n,i){let o,a,s,l,c,u,d,h,f,p,m,v,_,b,g,x,M,y,E,w,T,A,R,S,F=i[0],B=i[1],O=i[2],C=Math.sqrt(F*F+B*B+O*O);return Math.abs(C)<r.b?null:(C=1/C,F*=C,B*=C,O*=C,o=Math.sin(n),a=Math.cos(n),s=1-a,l=t[0],c=t[1],u=t[2],d=t[3],h=t[4],f=t[5],p=t[6],m=t[7],v=t[8],_=t[9],b=t[10],g=t[11],x=F*F*s+a,M=B*F*s+O*o,y=O*F*s-B*o,E=F*B*s-O*o,w=B*B*s+a,T=O*B*s+F*o,A=F*O*s+B*o,R=B*O*s-F*o,S=O*O*s+a,e[0]=l*x+h*M+v*y,e[1]=c*x+f*M+_*y,e[2]=u*x+p*M+b*y,e[3]=d*x+m*M+g*y,e[4]=l*E+h*w+v*T,e[5]=c*E+f*w+_*T,e[6]=u*E+p*w+b*T,e[7]=d*E+m*w+g*T,e[8]=l*A+h*R+v*S,e[9]=c*A+f*R+_*S,e[10]=u*A+p*R+b*S,e[11]=d*A+m*R+g*S,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,n){let i=Math.sin(n),o=Math.cos(n),r=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=r*o+c*i,e[5]=a*o+u*i,e[6]=s*o+d*i,e[7]=l*o+h*i,e[8]=c*o-r*i,e[9]=u*o-a*i,e[10]=d*o-s*i,e[11]=h*o-l*i,e},t.rotateY=function(e,t,n){let i=Math.sin(n),o=Math.cos(n),r=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*o-c*i,e[1]=a*o-u*i,e[2]=s*o-d*i,e[3]=l*o-h*i,e[8]=r*i+c*o,e[9]=a*i+u*o,e[10]=s*i+d*o,e[11]=l*i+h*o,e},t.rotateZ=function(e,t,n){let i=Math.sin(n),o=Math.cos(n),r=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=r*o+c*i,e[1]=a*o+u*i,e[2]=s*o+d*i,e[3]=l*o+h*i,e[4]=c*o-r*i,e[5]=u*o-a*i,e[6]=d*o-s*i,e[7]=h*o-l*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,n){let i,o,a,s=n[0],l=n[1],c=n[2],u=Math.sqrt(s*s+l*l+c*c);return Math.abs(u)<r.b?null:(u=1/u,s*=u,l*=u,c*=u,i=Math.sin(t),o=Math.cos(t),a=1-o,e[0]=s*s*a+o,e[1]=l*s*a+c*i,e[2]=c*s*a-l*i,e[3]=0,e[4]=s*l*a-c*i,e[5]=l*l*a+o,e[6]=c*l*a+s*i,e[7]=0,e[8]=s*c*a+l*i,e[9]=l*c*a-s*i,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){let n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){let n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){let n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,n){let i=t[0],o=t[1],r=t[2],a=t[3],s=i+i,l=o+o,c=r+r,u=i*s,d=i*l,h=i*c,f=o*l,p=o*c,m=r*c,v=a*s,_=a*l,b=a*c;return e[0]=1-(f+m),e[1]=d+b,e[2]=h-_,e[3]=0,e[4]=d-b,e[5]=1-(u+m),e[6]=p+v,e[7]=0,e[8]=h+_,e[9]=p-v,e[10]=1-(u+f),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){let n=t[0],i=t[1],o=t[2],r=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(n*n+i*i+o*o),e[1]=Math.sqrt(r*r+a*a+s*s),e[2]=Math.sqrt(l*l+c*c+u*u),e},t.getRotation=function(e,t){let n=t[0]+t[5]+t[10],i=0;return n>0?(i=2*Math.sqrt(n+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},t.fromRotationTranslationScale=function(e,t,n,i){let o=t[0],r=t[1],a=t[2],s=t[3],l=o+o,c=r+r,u=a+a,d=o*l,h=o*c,f=o*u,p=r*c,m=r*u,v=a*u,_=s*l,b=s*c,g=s*u,x=i[0],M=i[1],y=i[2];return e[0]=(1-(p+v))*x,e[1]=(h+g)*x,e[2]=(f-b)*x,e[3]=0,e[4]=(h-g)*M,e[5]=(1-(d+v))*M,e[6]=(m+_)*M,e[7]=0,e[8]=(f+b)*y,e[9]=(m-_)*y,e[10]=(1-(d+p))*y,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,n,i,o){let r=t[0],a=t[1],s=t[2],l=t[3],c=r+r,u=a+a,d=s+s,h=r*c,f=r*u,p=r*d,m=a*u,v=a*d,_=s*d,b=l*c,g=l*u,x=l*d,M=i[0],y=i[1],E=i[2],w=o[0],T=o[1],A=o[2];return e[0]=(1-(m+_))*M,e[1]=(f+x)*M,e[2]=(p-g)*M,e[3]=0,e[4]=(f-x)*y,e[5]=(1-(h+_))*y,e[6]=(v+b)*y,e[7]=0,e[8]=(p+g)*E,e[9]=(v-b)*E,e[10]=(1-(h+m))*E,e[11]=0,e[12]=n[0]+w-(e[0]*w+e[4]*T+e[8]*A),e[13]=n[1]+T-(e[1]*w+e[5]*T+e[9]*A),e[14]=n[2]+A-(e[2]*w+e[6]*T+e[10]*A),e[15]=1,e},t.fromQuat=function(e,t){let n=t[0],i=t[1],o=t[2],r=t[3],a=n+n,s=i+i,l=o+o,c=n*a,u=i*a,d=i*s,h=o*a,f=o*s,p=o*l,m=r*a,v=r*s,_=r*l;return e[0]=1-d-p,e[1]=u+_,e[2]=h-v,e[3]=0,e[4]=u-_,e[5]=1-c-p,e[6]=f+m,e[7]=0,e[8]=h+v,e[9]=f-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,n,i,o,r,a){let s=1/(n-t),l=1/(o-i),c=1/(r-a);return e[0]=2*r*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*r*l,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(o+i)*l,e[10]=(a+r)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*r*2*c,e[15]=0,e},t.perspective=function(e,t,n,i,o){let r=1/Math.tan(t/2),a=1/(i-o);return e[0]=r/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+i)*a,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*i*a,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,n,i){let o=Math.tan(t.upDegrees*Math.PI/180),r=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+s),c=2/(o+r);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(a-s)*l*.5,e[9]=(o-r)*c*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},t.ortho=function(e,t,n,i,o,r,a){let s=1/(t-n),l=1/(i-o),c=1/(r-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+n)*s,e[13]=(o+i)*l,e[14]=(a+r)*c,e[15]=1,e},t.lookAt=function(e,t,n,i){let o,a,s,l,c,u,d,h,f,p,m=t[0],v=t[1],_=t[2],b=i[0],g=i[1],x=i[2],M=n[0],y=n[1],E=n[2];return Math.abs(m-M)<r.b&&Math.abs(v-y)<r.b&&Math.abs(_-E)<r.b?mat4.identity(e):(d=m-M,h=v-y,f=_-E,p=1/Math.sqrt(d*d+h*h+f*f),d*=p,h*=p,f*=p,o=g*f-x*h,a=x*d-b*f,s=b*h-g*d,(p=Math.sqrt(o*o+a*a+s*s))?(o*=p=1/p,a*=p,s*=p):(o=0,a=0,s=0),l=h*s-f*a,c=f*o-d*s,u=d*a-h*o,(p=Math.sqrt(l*l+c*c+u*u))?(l*=p=1/p,c*=p,u*=p):(l=0,c=0,u=0),e[0]=o,e[1]=l,e[2]=d,e[3]=0,e[4]=a,e[5]=c,e[6]=h,e[7]=0,e[8]=s,e[9]=u,e[10]=f,e[11]=0,e[12]=-(o*m+a*v+s*_),e[13]=-(l*m+c*v+u*_),e[14]=-(d*m+h*v+f*_),e[15]=1,e)},t.targetTo=function(e,t,n,i){let o=t[0],r=t[1],a=t[2],s=i[0],l=i[1],c=i[2],u=o-n[0],d=r-n[1],h=a-n[2],f=u*u+d*d+h*h;f>0&&(u*=f=1/Math.sqrt(f),d*=f,h*=f);let p=l*h-c*d,m=c*u-s*h,v=s*d-l*u;return e[0]=p,e[1]=m,e[2]=v,e[3]=0,e[4]=d*v-h*m,e[5]=h*p-u*v,e[6]=u*m-d*p,e[7]=0,e[8]=u,e[9]=d,e[10]=h,e[11]=0,e[12]=o,e[13]=r,e[14]=a,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},t.subtract=o,t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){let n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],l=e[5],c=e[6],u=e[7],d=e[8],h=e[9],f=e[10],p=e[11],m=e[12],v=e[13],_=e[14],b=e[15],g=t[0],x=t[1],M=t[2],y=t[3],E=t[4],w=t[5],T=t[6],A=t[7],R=t[8],S=t[9],F=t[10],B=t[11],O=t[12],C=t[13],U=t[14],L=t[15];return Math.abs(n-g)<=r.b*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-x)<=r.b*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-M)<=r.b*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(a-y)<=r.b*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(s-E)<=r.b*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(l-w)<=r.b*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(c-T)<=r.b*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-A)<=r.b*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(d-R)<=r.b*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(h-S)<=r.b*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(f-F)<=r.b*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(p-B)<=r.b*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(m-O)<=r.b*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(v-C)<=r.b*Math.max(1,Math.abs(v),Math.abs(C))&&Math.abs(_-U)<=r.b*Math.max(1,Math.abs(_),Math.abs(U))&&Math.abs(b-L)<=r.b*Math.max(1,Math.abs(b),Math.abs(L))};var r=n(2);const a=i;t.mul=a;const s=o;t.sub=s},function(e,t,n){"use strict";function i(){let e=new l.a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function o(e,t,n){n*=.5;let i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function r(e,t,n){let i=t[0],o=t[1],r=t[2],a=t[3],s=n[0],l=n[1],c=n[2],u=n[3];return e[0]=i*u+a*s+o*c-r*l,e[1]=o*u+a*l+r*s-i*c,e[2]=r*u+a*c+i*l-o*s,e[3]=a*u-i*s-o*l-r*c,e}function a(e,t,n,i){let o,r,a,s,l,c=t[0],u=t[1],d=t[2],h=t[3],f=n[0],p=n[1],m=n[2],v=n[3];return(r=c*f+u*p+d*m+h*v)<0&&(r=-r,f=-f,p=-p,m=-m,v=-v),1-r>1e-6?(o=Math.acos(r),a=Math.sin(o),s=Math.sin((1-i)*o)/a,l=Math.sin(i*o)/a):(s=1-i,l=i),e[0]=s*c+l*f,e[1]=s*u+l*p,e[2]=s*d+l*m,e[3]=s*h+l*v,e}function s(e,t){let n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let o=(i+1)%3,r=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*r+r]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*o+r]-t[3*r+o])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[r]=(t[3*r+i]+t[3*i+r])*n}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=o,t.getAxisAngle=function(e,t){let n=2*Math.acos(t[3]),i=Math.sin(n/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},t.multiply=r,t.rotateX=function(e,t,n){n*=.5;let i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+a*s,e[1]=o*l+r*s,e[2]=r*l-o*s,e[3]=a*l-i*s,e},t.rotateY=function(e,t,n){n*=.5;let i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l-r*s,e[1]=o*l+a*s,e[2]=r*l+i*s,e[3]=a*l-o*s,e},t.rotateZ=function(e,t,n){n*=.5;let i=t[0],o=t[1],r=t[2],a=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=i*l+o*s,e[1]=o*l-i*s,e[2]=r*l+a*s,e[3]=a*l-r*s,e},t.calculateW=function(e,t){let n=t[0],i=t[1],o=t[2];return e[0]=n,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-o*o)),e},t.slerp=a,t.invert=function(e,t){let n=t[0],i=t[1],o=t[2],r=t[3],a=n*n+i*i+o*o+r*r,s=a?1/a:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-o*s,e[3]=r*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=s,t.fromEuler=function(e,t,n,i){let o=.5*Math.PI/180;t*=o,n*=o,i*=o;let r=Math.sin(t),a=Math.cos(t),s=Math.sin(n),l=Math.cos(n),c=Math.sin(i),u=Math.cos(i);return e[0]=r*l*u-a*s*c,e[1]=a*s*u+r*l*c,e[2]=a*l*c-r*s*u,e[3]=a*l*u+r*s*c,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var l=n(2),c=n(10),u=n(11),d=n(12);const h=d.clone;t.clone=h;const f=d.fromValues;t.fromValues=f;const p=d.copy;t.copy=p;const m=d.set;t.set=m;const v=d.add;t.add=v;const _=r;t.mul=_;const b=d.scale;t.scale=b;const g=d.dot;t.dot=g;const x=d.lerp;t.lerp=x;const M=d.length;t.length=M;const y=M;t.len=y;const E=d.squaredLength;t.squaredLength=E;const w=E;t.sqrLen=w;const T=d.normalize;t.normalize=T;const A=d.exactEquals;t.exactEquals=A;const R=d.equals;t.equals=R;const S=function(){let e=u.create(),t=u.fromValues(1,0,0),n=u.fromValues(0,1,0);return function(i,r,a){let s=u.dot(r,a);return s<-.999999?(u.cross(e,t,r),u.len(e)<1e-6&&u.cross(e,n,r),u.normalize(e,e),o(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(u.cross(e,r,a),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,T(i,i))}}();t.rotationTo=S;const F=function(){let e=i(),t=i();return function(n,i,o,r,s,l){return a(e,i,s,l),a(t,o,r,l),a(n,e,t,2*l*(1-l)),n}}();t.sqlerp=F;const B=function(){let e=c.a();return function(t,n,i,o){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],T(t,s(t,e))}}();t.setAxes=B},function(e,t,n){"use strict";function i(){let e=new o.a(2);return e[0]=0,e[1]=0,e}var o=n(2);!function(){let e=i()}()},function(e,t,n){"use strict";const i=n(28).default;class o{constructor(){this._gui=new i.GUI,this._lightsFolder=this._gui.addFolder("Lights"),this.displayBump=!1,this.displaySpecular=!1,this.displayOcclusion=!1,this.bumpIntensity=1,this.fov=90,this.displayShadowMapTextureQuad=!1,this.useVoxelGI=!0,this._voxelFolder=this._gui.addFolder("Voxel GI Settings"),this._voxelDebugFolder=this._voxelFolder.addFolder("Debug"),this.showVoxels=!1,this.voxelMipmap=0,this.voxelDebugStepSize=5,this.voxelConeStepSize=25,this.voxelConeMaxDist=100,this.indirectLightningMultiplier=4,this.directLightningMultiplier=1.5,this.specularLightningMultiplier=1,this.occlusionMultiplier=1.5,this._voxelFolder.add(this,"indirectLightningMultiplier",0,10).name("Indirect light"),this._voxelFolder.add(this,"directLightningMultiplier",0,10).name("Direct light"),this._voxelFolder.add(this,"specularLightningMultiplier",0,10).name("Specular light"),this._voxelFolder.add(this,"occlusionMultiplier",0,5).name("Occlusion"),this._voxelFolder.add(this,"voxelConeStepSize",.2,100).name("Step Size"),this._voxelFolder.add(this,"voxelConeMaxDist",1,500).name("Max Trace Dist"),this._voxelFolder.add(this,"displayOcclusion").name("Show AO"),this._useVoxelGI=this._gui.add(this,"useVoxelGI").name("Voxel GI"),this._bumpMap=this._gui.add(this,"displayBump").name("Normal Map"),this._bumpIntensity=this._gui.add(this,"bumpIntensity",0,2).name("Bump Intensity"),this._fov=this._gui.add(this,"fov",0,100),this._showVoxels=this._voxelDebugFolder.add(this,"showVoxels").name("Render Voxels"),this._voxelMipmap=this._voxelDebugFolder.add(this,"voxelMipmap",0,5).name("Voxel Mipmap"),this._voxelDebugStepSize=this._voxelDebugFolder.add(this,"voxelDebugStepSize",1,20).name("Voxel Debug Step Size"),this._displayShadowMapTextureQuad=this._gui.add(this,"displayShadowMapTextureQuad").name("Display Shadow Map")}get lights(){return this._lightsFolder}}t.a=o},function(e,t,n){"use strict";function i(e,t){var n=e.__state.conversionName.toString(),i=Math.round(e.r),o=Math.round(e.g),r=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),c=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+i+","+o+","+r+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+r+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+r+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+r+","+a+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+r+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+c+",a:"+a+"}":"unknown format"}function o(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(V.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(V.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function r(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(V.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(V.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function a(e){if("0"===e||F.isUndefined(e))return 0;var t=e.match(W);return F.isNull(t)?0:parseFloat(t[1])}function s(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}function l(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function c(e,t,n,i,o){return i+(e-t)/(n-t)*(o-i)}function u(e,t,n,i){e.style.background="",F.each(ne,function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}function d(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function h(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,n):e.__ul.appendChild(i),e.onResize(),i}function f(e){Y.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&Y.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function p(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function m(e,t,n){if(n.__li=t,n.__gui=e,F.extend(n,{options:function(t){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),_(e,n.object,n.property,{before:i,factoryArgs:[F.toArray(arguments)]})}if(F.isArray(t)||F.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),_(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof $){var i=new Z(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});F.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],o=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(i,e),t.apply(n,e)}}),Y.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof Z){var o=function(t){if(F.isNumber(n.__min)&&F.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=_(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(i),o&&r.listen(),r}return t};n.min=F.compose(o,n.min),n.max=F.compose(o,n.max)}else n instanceof q?(Y.bind(t,"click",function(){Y.fakeEvent(n.__checkbox,"click")}),Y.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof ee?(Y.bind(t,"click",function(){Y.fakeEvent(n.__button,"click")}),Y.bind(t,"mouseover",function(){Y.addClass(n.__button,"hover")}),Y.bind(t,"mouseout",function(){Y.removeClass(n.__button,"hover")})):n instanceof te&&(Y.addClass(t,"color"),n.updateDisplay=F.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=F.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&p(e.getRoot(),!0),t},n.setValue)}function v(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[t.property]=t,n.load&&n.load.remembered){var r=n.load.remembered,a=void 0;if(r[e.preset])a=r[e.preset];else{if(!r[le])return;a=r[le]}if(a[i]&&void 0!==a[i][t.property]){var s=a[i][t.property];t.initialValue=s,t.setValue(s)}}}}function _(e,t,n,i){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new te(t,n);else{var r=[t,n].concat(i.factoryArgs);o=oe.apply(e,r)}i.before instanceof X&&(i.before=i.before.__li),v(e,o),Y.addClass(o.domElement,"c");var a=document.createElement("span");Y.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var l=h(e,s,i.before);return Y.addClass(l,me.CLASS_CONTROLLER_ROW),o instanceof te?Y.addClass(l,"color"):Y.addClass(l,k(o.getValue())),m(e,l,o),e.__controllers.push(o),o}function b(e,t){return document.location.href+"."+t}function g(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function x(e,t){t.style.display=e.useLocalStorage?"block":"none"}function M(e){var t=e.__save_row=document.createElement("li");Y.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),Y.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Y.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",Y.addClass(i,"button"),Y.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",Y.addClass(o,"button"),Y.addClass(o,"save-as");var r=document.createElement("span");r.innerHTML="Revert",Y.addClass(r,"button"),Y.addClass(r,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?F.each(e.load.remembered,function(t,n){g(e,n,n===e.preset)}):g(e,le,!1),Y.bind(a,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(a),t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(r),ce){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(b(e,"isLocal"))&&l.setAttribute("checked","checked"),x(e,s),Y.bind(l,"change",function(){e.useLocalStorage=!e.useLocalStorage,x(e,s)})}var c=document.getElementById("dg-new-constructor");Y.bind(c,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||ue.hide()}),Y.bind(n,"click",function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),ue.show(),c.focus(),c.select()}),Y.bind(i,"click",function(){e.save()}),Y.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),Y.bind(r,"click",function(){e.revert()})}function y(e){function t(t){return t.preventDefault(),e.width+=o-t.clientX,e.onResize(),o=t.clientX,!1}function n(){Y.removeClass(e.__closeButton,me.CLASS_DRAG),Y.unbind(window,"mousemove",t),Y.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),o=i.clientX,Y.addClass(e.__closeButton,me.CLASS_DRAG),Y.bind(window,"mousemove",t),Y.bind(window,"mouseup",n),!1}var o=void 0;e.__resize_handle=document.createElement("div"),F.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Y.bind(e.__resize_handle,"mousedown",i),Y.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function E(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function w(e,t){var n={};return F.each(e.__rememberedObjects,function(i,o){var r={},a=e.__rememberedObjectIndecesToControllers[o];F.each(a,function(e,n){r[n]=t?e.initialValue:e.getValue()}),n[o]=r}),n}function T(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function A(e){0!==e.length&&re.call(window,function(){A(e)}),F.each(e,function(e){e.updateDisplay()})}Object.defineProperty(t,"__esModule",{value:!0});var R=Array.prototype.forEach,S=Array.prototype.slice,F={BREAK:{},extend:function(e){return this.each(S.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(S.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=S.call(arguments);return function(){for(var t=S.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(R&&e.forEach&&e.forEach===R)e.forEach(t,n);else if(e.length===e.length+0){var i=void 0,o=void 0;for(i=0,o=e.length;i<o;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var r in e)if(t.call(n,e[r],r)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i=void 0;return function(){var o=this,r=arguments,a=n||!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(o,r)},t),a&&e.apply(o,r)}},toArray:function(e){return e.toArray?e.toArray():S.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},B=[{litmus:F.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:i},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:i},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:i},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:i}}},{litmus:F.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:F.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:F.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(F.isNumber(e.r)&&F.isNumber(e.g)&&F.isNumber(e.b)&&F.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(F.isNumber(e.r)&&F.isNumber(e.g)&&F.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(F.isNumber(e.h)&&F.isNumber(e.s)&&F.isNumber(e.v)&&F.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(F.isNumber(e.h)&&F.isNumber(e.s)&&F.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],O=void 0,C=void 0,U=function(){C=!1;var e=arguments.length>1?F.toArray(arguments):arguments[0];return F.each(B,function(t){if(t.litmus(e))return F.each(t.conversions,function(t,n){if(O=t.read(e),!1===C&&!1!==O)return C=O,O.conversionName=n,O.conversion=t,F.BREAK}),F.BREAK}),C},L=void 0,D={hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),r=n*(1-t),a=n*(1-o*t),s=n*(1-(1-o)*t),l=[[n,s,r],[a,n,r],[r,n,s],[r,a,n],[s,r,n],[n,r,a]][i];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),o=Math.max(e,t,n),r=o-i,a=void 0,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=r/o,a=e===o?(t-n)/r:t===o?2+(n-e)/r:4+(e-t)/r,(a/=6)<0&&(a+=1),{h:360*a,s:s,v:o/255})},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(L=8*t)|e&~(255<<L)}},k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},I=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),N=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,n,i)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(i)},z=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},j=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},V=function(){function e(){if(P(this,e),this.__state=U.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return I(e,[{key:"toString",value:function(){return i(this)}},{key:"toHexString",value:function(){return i(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();V.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=D.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");F.extend(e.__state,D.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},V.recalculateHSV=function(e){var t=D.rgb_to_hsv(e.r,e.g,e.b);F.extend(e.__state,{s:t.s,v:t.v}),F.isNaN(t.h)?F.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},V.COMPONENTS=["r","g","b","h","s","v","hex","a"],o(V.prototype,"r",2),o(V.prototype,"g",1),o(V.prototype,"b",0),r(V.prototype,"h"),r(V.prototype,"s"),r(V.prototype,"v"),Object.defineProperty(V.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(V.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=D.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var X=function(){function e(t,n){P(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return I(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),H={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},G={};F.each(H,function(e,t){F.each(e,function(e){G[e]=t})});var W=/(\d+(\.\d+)?)px/,Y={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,o=t;F.isUndefined(o)&&(o=!0),F.isUndefined(i)&&(i=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var o=n||{},r=G[t];if(!r)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(r);switch(r){case"MouseEvents":var s=o.x||o.clientX||0,l=o.y||o.clientY||0;a.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;F.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(t,o.bubbles||!1,o.cancelable||!0)}F.defaults(a,i),e.dispatchEvent(a)},bind:function(e,t,n,i){var o=i||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),Y},unbind:function(e,t,n,i){var o=i||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),Y},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Y},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!==i&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return Y},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return a(t["border-left-width"])+a(t["border-right-width"])+a(t["padding-left"])+a(t["padding-right"])+a(t.width)},getHeight:function(e){var t=getComputedStyle(e);return a(t["border-top-width"])+a(t["border-bottom-width"])+a(t["padding-top"])+a(t["padding-bottom"])+a(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},q=function(e){function t(e,n){P(this,t);var i=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),Y.bind(i.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return z(t,X),I(t,[{key:"setValue",value:function(e){var n=N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),K=function(e){function t(e,n,i){P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i,a=o;if(o.__select=document.createElement("select"),F.isArray(r)){var s={};F.each(r,function(e){s[e]=e}),r=s}return F.each(r,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)}),o.updateDisplay(),Y.bind(o.__select,"change",function(){var e=this.options[this.selectedIndex].value;a.setValue(e)}),o.domElement.appendChild(o.__select),o}return z(t,X),I(t,[{key:"setValue",value:function(e){var n=N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Y.isActive(this.__select)?this:(this.__select.value=this.getValue(),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),Q=function(e){function t(e,n){function i(){r.setValue(r.__input.value)}P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=o;return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Y.bind(o.__input,"keyup",i),Y.bind(o.__input,"change",i),Y.bind(o.__input,"blur",function(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}),Y.bind(o.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return z(t,X),I(t,[{key:"updateDisplay",value:function(){return Y.isActive(this.__input)||(this.__input.value=this.getValue()),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),J=function(e){function t(e,n,i){P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=i||{};return o.__min=r.min,o.__max=r.max,o.__step=r.step,F.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=s(o.__impliedStep),o}return z(t,X),I(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=s(e),this}}]),t}(),Z=function(e){function t(e,n,i){function o(){l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}function r(e){var t=c-e.clientY;l.setValue(l.getValue()+t*l.__impliedStep),c=e.clientY}function a(){Y.unbind(window,"mousemove",r),Y.unbind(window,"mouseup",a),o()}P(this,t);var s=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));s.__truncationSuspended=!1;var l=s,c=void 0;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),Y.bind(s.__input,"change",function(){var e=parseFloat(l.__input.value);F.isNaN(e)||l.setValue(e)}),Y.bind(s.__input,"blur",function(){o()}),Y.bind(s.__input,"mousedown",function(e){Y.bind(window,"mousemove",r),Y.bind(window,"mouseup",a),c=e.clientY}),Y.bind(s.__input,"keydown",function(e){13===e.keyCode&&(l.__truncationSuspended=!0,this.blur(),l.__truncationSuspended=!1,o())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return z(t,J),I(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():l(this.getValue(),this.__precision),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),$=function(e){function t(e,n,i,o,r){function a(e){e.preventDefault();var t=h.__background.getBoundingClientRect();return h.setValue(c(e.clientX,t.left,t.right,h.__min,h.__max)),!1}function s(){Y.unbind(window,"mousemove",a),Y.unbind(window,"mouseup",s),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function l(e){var t=e.touches[0].clientX,n=h.__background.getBoundingClientRect();h.setValue(c(t,n.left,n.right,h.__min,h.__max))}function u(){Y.unbind(window,"touchmove",l),Y.unbind(window,"touchend",u),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}P(this,t);var d=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:i,max:o,step:r})),h=d;return d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),Y.bind(d.__background,"mousedown",function(e){document.activeElement.blur(),Y.bind(window,"mousemove",a),Y.bind(window,"mouseup",s),a(e)}),Y.bind(d.__background,"touchstart",function(e){1===e.touches.length&&(Y.bind(window,"touchmove",l),Y.bind(window,"touchend",u),l(e))}),Y.addClass(d.__background,"slider"),Y.addClass(d.__foreground,"slider-fg"),d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return z(t,J),I(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),ee=function(e){function t(e,n,i){P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),r=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,Y.bind(o.__button,"click",function(e){return e.preventDefault(),r.fire(),!1}),Y.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return z(t,X),I(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),te=function(e){function t(e,n){function i(e){c(e),Y.bind(window,"mousemove",c),Y.bind(window,"touchmove",c),Y.bind(window,"mouseup",r),Y.bind(window,"touchend",r)}function o(e){h(e),Y.bind(window,"mousemove",h),Y.bind(window,"touchmove",h),Y.bind(window,"mouseup",a),Y.bind(window,"touchend",a)}function r(){Y.unbind(window,"mousemove",c),Y.unbind(window,"touchmove",c),Y.unbind(window,"mouseup",r),Y.unbind(window,"touchend",r),l()}function a(){Y.unbind(window,"mousemove",h),Y.unbind(window,"touchmove",h),Y.unbind(window,"mouseup",a),Y.unbind(window,"touchend",a),l()}function s(){var e=U(this.value);!1!==e?(p.__color.__state=e,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function l(){p.__onFinishChange&&p.__onFinishChange.call(p,p.__color.toOriginal())}function c(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=p.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,i=n.clientX,o=n.clientY,r=(i-t.left)/(t.right-t.left),a=1-(o-t.top)/(t.bottom-t.top);return a>1?a=1:a<0&&(a=0),r>1?r=1:r<0&&(r=0),p.__color.v=a,p.__color.s=r,p.setValue(p.__color.toOriginal()),!1}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=p.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),p.__color.h=360*n,p.setValue(p.__color.toOriginal()),!1}P(this,t);var f=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));f.__color=new V(f.getValue()),f.__temp=new V(0);var p=f;f.domElement=document.createElement("div"),Y.makeSelectable(f.domElement,!1),f.__selector=document.createElement("div"),f.__selector.className="selector",f.__saturation_field=document.createElement("div"),f.__saturation_field.className="saturation-field",f.__field_knob=document.createElement("div"),f.__field_knob.className="field-knob",f.__field_knob_border="2px solid ",f.__hue_knob=document.createElement("div"),f.__hue_knob.className="hue-knob",f.__hue_field=document.createElement("div"),f.__hue_field.className="hue-field",f.__input=document.createElement("input"),f.__input.type="text",f.__input_textShadow="0 1px 1px ",Y.bind(f.__input,"keydown",function(e){13===e.keyCode&&s.call(this)}),Y.bind(f.__input,"blur",s),Y.bind(f.__selector,"mousedown",function(){Y.addClass(this,"drag").bind(window,"mouseup",function(){Y.removeClass(p.__selector,"drag")})}),Y.bind(f.__selector,"touchstart",function(){Y.addClass(this,"drag").bind(window,"touchend",function(){Y.removeClass(p.__selector,"drag")})});var m=document.createElement("div");return F.extend(f.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),F.extend(f.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:f.__field_knob_border+(f.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),F.extend(f.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),F.extend(f.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),F.extend(m.style,{width:"100%",height:"100%",background:"none"}),u(m,"top","rgba(0,0,0,0)","#000"),F.extend(f.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),d(f.__hue_field),F.extend(f.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:f.__input_textShadow+"rgba(0,0,0,0.7)"}),Y.bind(f.__saturation_field,"mousedown",i),Y.bind(f.__saturation_field,"touchstart",i),Y.bind(f.__field_knob,"mousedown",i),Y.bind(f.__field_knob,"touchstart",i),Y.bind(f.__hue_field,"mousedown",o),Y.bind(f.__hue_field,"touchstart",o),f.__saturation_field.appendChild(m),f.__selector.appendChild(f.__field_knob),f.__selector.appendChild(f.__saturation_field),f.__selector.appendChild(f.__hue_field),f.__hue_field.appendChild(f.__hue_knob),f.domElement.appendChild(f.__input),f.domElement.appendChild(f.__selector),f.updateDisplay(),f}return z(t,X),I(t,[{key:"updateDisplay",value:function(){var e=U(this.getValue());if(!1!==e){var t=!1;F.each(V.COMPONENTS,function(n){if(!F.isUndefined(e[n])&&!F.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&F.extend(this.__color.__state,e)}F.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;F.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,u(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),F.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(),ne=["-moz-","-o-","-webkit-","-ms-",""],ie={load:function(e,t){var n=t||document,i=n.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,n.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(e){}}},oe=function(e,t){var n=e[t];return F.isArray(arguments[2])||F.isObject(arguments[2])?new K(e,t,arguments[2]):F.isNumber(n)?F.isNumber(arguments[2])&&F.isNumber(arguments[3])?F.isNumber(arguments[4])?new $(e,t,arguments[2],arguments[3],arguments[4]):new $(e,t,arguments[2],arguments[3]):F.isNumber(arguments[4])?new Z(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Z(e,t,{min:arguments[2],max:arguments[3]}):F.isString(n)?new Q(e,t):F.isFunction(n)?new ee(e,t,""):F.isBoolean(n)?new q(e,t):null},re=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},ae=function(){function e(){P(this,e),this.backgroundElement=document.createElement("div"),F.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Y.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),F.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;Y.bind(this.backgroundElement,"click",function(){t.hide()})}return I(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),F.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",Y.unbind(e.domElement,"webkitTransitionEnd",t),Y.unbind(e.domElement,"transitionend",t),Y.unbind(e.domElement,"oTransitionEnd",t)};Y.bind(this.domElement,"webkitTransitionEnd",t),Y.bind(this.domElement,"transitionend",t),Y.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Y.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Y.getHeight(this.domElement)/2+"px"}}]),e}(),se=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ie.inject(se);var le="Default",ce=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),ue=void 0,de=!0,he=void 0,fe=!1,pe=[],me=function e(t){var n=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Y.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=F.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=F.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),F.isUndefined(i.load)?i.load={preset:le}:i.preset&&(i.load.preset=i.preset),F.isUndefined(i.parent)&&i.hideable&&pe.push(this),i.resizable=F.isUndefined(i.parent)&&i.resizable,i.autoPlace&&F.isUndefined(i.scrollable)&&(i.scrollable=!0);var o=ce&&"true"===localStorage.getItem(b(this,"isLocal")),r=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(e){n.parent?n.getRoot().preset=e:i.load.preset=e,T(this),n.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,E(n,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,titleRowName&&(titleRowName.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?Y.addClass(n.__ul,e.CLASS_CLOSED):Y.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return o},set:function(e){ce&&(o=e,e?Y.bind(window,"unload",r):Y.unbind(window,"unload",r),localStorage.setItem(b(n,"isLocal"),e))}}}),F.isUndefined(i.parent)){if(i.closed=!1,Y.addClass(this.domElement,e.CLASS_MAIN),Y.makeSelectable(this.domElement,!1),ce&&o){n.useLocalStorage=!0;var a=localStorage.getItem(b(this,"gui"));a&&(i.load=JSON.parse(a))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,Y.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(Y.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Y.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Y.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===i.closed&&(i.closed=!0);var s=document.createTextNode(i.name);Y.addClass(s,"controller-name");var l=h(n,s),c=function(e){return e.preventDefault(),n.closed=!n.closed,!1};Y.addClass(this.__ul,e.CLASS_CLOSED),Y.addClass(l,"title"),Y.bind(l,"click",c),i.closed||(this.closed=!1)}i.autoPlace&&(F.isUndefined(i.parent)&&(de&&(he=document.createElement("div"),Y.addClass(he,"dg"),Y.addClass(he,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(he),de=!1),he.appendChild(this.domElement),Y.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||E(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Y.bind(window,"resize",this.__resizeHandler),Y.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Y.bind(this.__ul,"transitionend",this.__resizeHandler),Y.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&y(this),r=function(){ce&&"true"===localStorage.getItem(b(n,"isLocal"))&&localStorage.setItem(b(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=r,i.parent||function(){var e=n.getRoot();e.width+=1,F.defer(function(){e.width-=1})}()};me.toggleHide=function(){fe=!fe,F.each(pe,function(e){e.domElement.style.display=fe?"none":""})},me.CLASS_AUTO_PLACE="a",me.CLASS_AUTO_PLACE_CONTAINER="ac",me.CLASS_MAIN="main",me.CLASS_CONTROLLER_ROW="cr",me.CLASS_TOO_TALL="taller-than-window",me.CLASS_CLOSED="closed",me.CLASS_CLOSE_BUTTON="close-button",me.CLASS_CLOSE_TOP="close-top",me.CLASS_CLOSE_BOTTOM="close-bottom",me.CLASS_DRAG="drag",me.DEFAULT_WIDTH=245,me.TEXT_CLOSED="Close Controls",me.TEXT_OPEN="Open Controls",me._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||me.toggleHide()},Y.bind(window,"keydown",me._keydownHandler,!1),F.extend(me.prototype,{add:function(e,t){return _(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return _(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;F.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&he.removeChild(this.domElement);var e=this;F.each(this.__folders,function(t){e.removeFolder(t)}),Y.unbind(window,"keydown",me._keydownHandler,!1),f(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new me(t);this.__folders[e]=n;var i=h(this,n.domElement);return Y.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],f(e);var t=this;F.each(e.__folders,function(t){e.removeFolder(t)}),F.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=Y.getOffset(e.__ul).top,n=0;F.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=Y.getHeight(t))}),window.innerHeight-t-20<n?(Y.addClass(e.domElement,me.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(Y.removeClass(e.domElement,me.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&F.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:F.debounce(function(){this.onResize()},50),remember:function(){if(F.isUndefined(ue)&&((ue=new ae).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;F.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&M(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&E(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=w(this)),e.folders={},F.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=w(this),p(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[le]=w(this,!0)),this.load.remembered[e]=w(this),this.preset=e,g(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){F.each(this.__controllers,function(t){this.getRoot().load.remembered?v(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),F.each(this.__folders,function(e){e.revert(e)}),e||p(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&A(this.__listening)},updateDisplay:function(){F.each(this.__controllers,function(e){e.updateDisplay()}),F.each(this.__folders,function(e){e.updateDisplay()})}});var ve={color:{Color:V,math:D,interpret:U},controllers:{Controller:X,BooleanController:q,OptionController:K,StringController:Q,NumberController:J,NumberControllerBox:Z,NumberControllerSlider:$,FunctionController:ee,ColorController:te},dom:{dom:Y},gui:{GUI:me},GUI:me};t.default=ve},function(e,t,n){"use strict";var i=n(0);class o{constructor(e){const t=Object(i.b)();this.location=++o.location,this.data=new Float32Array(e),this.buffer=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,this.buffer),t.bufferData(t.UNIFORM_BUFFER,this.data,t.STATIC_DRAW),t.bindBuffer(t.UNIFORM_BUFFER,null)}bind(){const e=Object(i.b)();e.bindBufferBase(e.UNIFORM_BUFFER,this.location,this.buffer)}update(e,t=0){const n=Object(i.b)();this.data.set(e,t),n.bindBuffer(n.UNIFORM_BUFFER,this.buffer),n.bufferSubData(n.UNIFORM_BUFFER,0,this.data,0,null),n.bindBuffer(n.UNIFORM_BUFFER,null)}}o.location=0,t.a=o},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));n(4);class r{constructor(){`#version 300 es\n            precision highp float;\n\n            // Cred https://turanszkij.wordpress.com/2017/08/30/voxel-based-global-illumination/\n            // https://github.com/Cigg/Voxel-Cone-Tracing/blob/master/shaders/standard.frag\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            out vec2 vUv;\n            out vec3 position_world;\n            out vec4 position_depth;\n\n            out vec3 normal_world;\n            out mat3 tangentToWorld;\n\n            void main() {\n\n                mat4 biasMatrix = mat4(\n                    0.5, 0.0, 0.0, 0.0,\n                    0.0, 0.5, 0.0, 0.0,\n                    0.0, 0.0, 0.5, 0.0,\n                    0.5, 0.5, 0.5, 1.0\n                );\n\n                position_world = (modelMatrix * vec4(position, 1.0)).xyz;\n                position_depth = biasMatrix * depthMVP * vec4(position, 1.0);\n\n                // TODO: why do I need to normalize here? Bump factor too much weight otherwise\n                normal_world = normalize((modelMatrix * vec4(normal,0.0)).xyz);\n                vec3 tangent_world = normalize((modelMatrix * vec4(tangent,0.0)).xyz);\n                vec3 bitangent_world = normalize((modelMatrix * vec4(bitangent,0.0)).xyz);\n\n                vUv = uv;\n\n                tangentToWorld = mat3(\n                    tangent_world,\n                    normal_world,\n                    bitangent_world\n                );\n\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es\n            precision highp float;\n            precision mediump sampler3D;\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 - base | aligned offset\n                vec4 mdiffuse; // 16 16\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 52\n                bool hasNormalMap; // 4 56\n                bool hasSpecularMap; // 4 60\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n            uniform sampler2D shadowMap;\n            uniform sampler3D voxelTexture;\n\n            uniform float sceneScale;\n            uniform float voxelResolution;\n            uniform vec3 camera_world;\n\n            in vec2 vUv;\n            in vec3 position_world;\n            in vec4 position_depth;\n            in vec3 normal_world;\n\n            in mat3 tangentToWorld;\n\n            out vec4 outColor;\n\n            float voxelWorldSize;\n\n            const int NUM_CONES = 6;\n            vec3 coneDirections[6] = vec3[](                            \n                                        vec3(0, 1, 0),\n                                        vec3(0, 0.5, 0.866025),\n                                        vec3(0.823639, 0.5, 0.267617),\n                                        vec3(0.509037, 0.5, -0.700629),\n                                        vec3(-0.509037, 0.5, -0.700629),\n                                        vec3(-0.823639, 0.5, 0.267617)\n                                        );\n            float coneWeights[6] = float[](0.25, 0.15, 0.15, 0.15, 0.15, 0.15);\n\n            layout (std140) uniform guiDataBuffer {\n                float bumpIntensity;\n                float indirectMultiplier;\n                float directMultiplier;\n                float specularMultiplier;\n                float occlusionMultiplier;\n                float voxelConeStepSize;\n                float voxelConeMaxDist;\n                bool displayNormalMap;\n                bool displayOcclusion;\n            };\n\n            vec3 calculateBumpNormal() {\n                vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                bn.x *= bumpIntensity;\n                bn.y *= bumpIntensity;\n                return normalize(tangentToWorld * vec3(bn.x, 1.0, bn.y));\n            }\n\n            void main() {\n                if (hasDissolveMap) {\n                    if (texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y)).r  < 0.1) {\n                        discard;\n                    }\n                }\n\n                vec3 N = hasNormalMap ? calculateBumpNormal() : normalize(normal_world.xyz);\n                vec3 L = normalize(directional_world);\n                vec3 E = normalize(camera_world);\n\n                vec4 materialColor = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                float alpha = materialColor.a;\n\n                float visibility = 1.0;\n                if (texture( shadowMap, position_depth.xy ).r  <  position_depth.z - 0.005) {\n                    visibility = 0.0;\n                }\n\n                float cosTheta = max(0.0, dot(N, L));\n                vec3 directDiffuseLight = vec3(visibility * cosTheta);\n                vec3 diffuseReflection = 2.0 * mdiffuse.xyz * directDiffuseLight * materialColor.rgb;\n                \n                if (displayNormalMap && hasNormalMap) {\n                    outColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                } else {\n                    outColor = vec4(diffuseReflection, alpha);\n                }\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n\n            // Cred https://turanszkij.wordpress.com/2017/08/30/voxel-based-global-illumination/\n            // https://github.com/Cigg/Voxel-Cone-Tracing/blob/master/shaders/standard.frag\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            out vec2 vUv;\n            out vec3 position_world;\n            out vec4 position_depth;\n\n            out vec3 normal_world;\n            out mat3 tangentToWorld;\n\n            void main() {\n\n                mat4 biasMatrix = mat4(\n                    0.5, 0.0, 0.0, 0.0,\n                    0.0, 0.5, 0.0, 0.0,\n                    0.0, 0.0, 0.5, 0.0,\n                    0.5, 0.5, 0.5, 1.0\n                );\n\n                position_world = (modelMatrix * vec4(position, 1.0)).xyz;\n                position_depth = biasMatrix * depthMVP * vec4(position, 1.0);\n\n                // TODO: why do I need to normalize here? Bump factor too much weight otherwise\n                normal_world = normalize((modelMatrix * vec4(normal,0.0)).xyz);\n                vec3 tangent_world = normalize((modelMatrix * vec4(tangent,0.0)).xyz);\n                vec3 bitangent_world = normalize((modelMatrix * vec4(bitangent,0.0)).xyz);\n\n                vUv = uv;\n\n                tangentToWorld = mat3(\n                    tangent_world,\n                    normal_world,\n                    bitangent_world\n                );\n\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es\n            precision highp float;\n            precision mediump sampler3D;\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 - base | aligned offset\n                vec4 mdiffuse; // 16 16\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 52\n                bool hasNormalMap; // 4 56\n                bool hasSpecularMap; // 4 60\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n            uniform sampler2D shadowMap;\n            uniform sampler3D voxelTexture;\n\n            uniform float sceneScale;\n            uniform float voxelResolution;\n            uniform vec3 camera_world;\n\n            in vec2 vUv;\n            in vec3 position_world;\n            in vec4 position_depth;\n            in vec3 normal_world;\n\n            in mat3 tangentToWorld;\n\n            out vec4 outColor;\n\n            float voxelWorldSize;\n\n            const int NUM_CONES = 6;\n            vec3 coneDirections[6] = vec3[](                            \n                                        vec3(0, 1, 0),\n                                        vec3(0, 0.5, 0.866025),\n                                        vec3(0.823639, 0.5, 0.267617),\n                                        vec3(0.509037, 0.5, -0.700629),\n                                        vec3(-0.509037, 0.5, -0.700629),\n                                        vec3(-0.823639, 0.5, 0.267617)\n                                        );\n            float coneWeights[6] = float[](0.25, 0.15, 0.15, 0.15, 0.15, 0.15);\n\n            layout (std140) uniform guiDataBuffer {\n                float bumpIntensity;\n                float indirectMultiplier;\n                float directMultiplier;\n                float specularMultiplier;\n                float occlusionMultiplier;\n                float voxelConeStepSize;\n                float voxelConeMaxDist;\n                bool displayNormalMap;\n                bool displayOcclusion;\n            };\n\n            vec3 calculateBumpNormal() {\n                vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                bn.x *= bumpIntensity;\n                bn.y *= bumpIntensity;\n                return normalize(tangentToWorld * vec3(bn.x, 1.0, bn.y));\n            }\n\n            void main() {\n                if (hasDissolveMap) {\n                    if (texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y)).r  < 0.1) {\n                        discard;\n                    }\n                }\n\n                vec3 N = hasNormalMap ? calculateBumpNormal() : normalize(normal_world.xyz);\n                vec3 L = normalize(directional_world);\n                vec3 E = normalize(camera_world);\n\n                vec4 materialColor = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                float alpha = materialColor.a;\n\n                float visibility = 1.0;\n                if (texture( shadowMap, position_depth.xy ).r  <  position_depth.z - 0.005) {\n                    visibility = 0.0;\n                }\n\n                float cosTheta = max(0.0, dot(N, L));\n                vec3 directDiffuseLight = vec3(visibility * cosTheta);\n                vec3 diffuseReflection = 2.0 * mdiffuse.xyz * directDiffuseLight * materialColor.rgb;\n                \n                if (displayNormalMap && hasNormalMap) {\n                    outColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                } else {\n                    outColor = vec4(diffuseReflection, alpha);\n                }\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));class r{constructor(){`#version 300 es\n            precision highp float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            uniform mat4 depthView;\n            uniform mat4 depthProj;\n\n            void main() {\n                gl_Position = depthProj * depthView * modelMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es \n            precision highp float;\n        \n            layout(location = 0) out float outColor;\n            \n            void main() {\n                // Not really needed, OpenGL does it anyway\n                outColor = gl_FragCoord.z;\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            uniform mat4 depthView;\n            uniform mat4 depthProj;\n\n            void main() {\n                gl_Position = depthProj * depthView * modelMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es \n            precision highp float;\n        \n            layout(location = 0) out float outColor;\n            \n            void main() {\n                // Not really needed, OpenGL does it anyway\n                outColor = gl_FragCoord.z;\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(33),o=n(34),r=n(35),a=n(36),s=n(17),l=n(18),c=n(7),u=n(19),d=n(8),h=n(20),f=n(0),p=n(1);class m{constructor(e,t,n){const c=Object(f.b)();this.sceneScale=e,this.voxelTextureSize=n;const p=new u.a(t,t,t);this.cubeMesh=new d.a(p.geometry,p.indices),this.screenSpaceImageShader=new s.a,this.voxelDebugShader=new o.a,this.voxelizationShader=new i.a,this.coneTracerShader=new r.a,this.worldPositionShader=new a.a,this.quad=new h.a,this.backFBO=new l.a(c.canvas.width,c.canvas.height),this.xTexture=c.createTexture(),c.bindTexture(c.TEXTURE_2D_ARRAY,this.xTexture),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_R,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage3D(c.TEXTURE_2D_ARRAY,0,c.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,c.RGBA,c.UNSIGNED_BYTE,null),this.zTexture=c.createTexture(),c.bindTexture(c.TEXTURE_2D_ARRAY,this.zTexture),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_R,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage3D(c.TEXTURE_2D_ARRAY,0,c.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,c.RGBA,c.UNSIGNED_BYTE,null),this.yTexture=c.createTexture(),c.bindTexture(c.TEXTURE_2D_ARRAY,this.yTexture),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_R,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D_ARRAY,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage3D(c.TEXTURE_2D_ARRAY,0,c.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,c.RGBA,c.UNSIGNED_BYTE,null),this.voxelTexture=c.createTexture(),c.bindTexture(c.TEXTURE_3D,this.voxelTexture),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MIN_FILTER,c.LINEAR_MIPMAP_LINEAR),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_R,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_3D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texImage3D(c.TEXTURE_3D,0,c.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,c.RGBA,c.UNSIGNED_BYTE,null),this.voxelFb=c.createFramebuffer()}renderVoxelDebug(e,t,n){const i=Object(f.b)();this.worldPositionShader.activate();const o=this.worldPositionShader.program;i.disable(i.CULL_FACE),i.enable(i.DEPTH_TEST),i.cullFace(i.FRONT),i.viewport(0,0,i.canvas.width,i.canvas.height),this.backFBO.bind(),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"sceneBuffer"),n.location),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),this.cubeMesh.draw(),i.bindFramebuffer(i.FRAMEBUFFER,null),this.voxelDebugShader.activate(),i.uniform1f(i.getUniformLocation(this.voxelDebugShader.program,"mipmapLevel"),e.gui.voxelMipmap),i.uniform1f(i.getUniformLocation(this.voxelDebugShader.program,"stepLength"),e.gui.voxelDebugStepSize),i.uniform1f(i.getUniformLocation(this.voxelDebugShader.program,"sceneScale"),this.sceneScale),i.uniform3fv(i.getUniformLocation(this.voxelDebugShader.program,"cameraPosition"),t.position),i.activeTexture(i.TEXTURE0+0),i.bindTexture(i.TEXTURE_3D,this.voxelTexture),i.uniform1i(i.getUniformLocation(this.voxelDebugShader.program,"texture3D"),0),this.backFBO.transitionToShaderResource(this.voxelDebugShader.program),this.quad.draw(),this.screenSpaceImageShader.activate(),this.backFBO.transitionToShaderResource(this.screenSpaceImageShader.program),i.viewport(0,0,150,150),this.quad.draw(),i.viewport(0,0,i.canvas.width,i.canvas.height)}voxelize(e,t,n,i,o,r){var a=performance.now();const s=Object(f.b)();s.viewport(0,0,this.voxelTextureSize,this.voxelTextureSize),s.disable(s.CULL_FACE),s.enable(s.DEPTH_TEST),s.bindFramebuffer(s.FRAMEBUFFER,this.voxelFb),s.clearColor(0,0,0,0),this.voxelizationShader.activate();const u=this.voxelizationShader.program;s.activeTexture(s.TEXTURE0+4),s.bindTexture(s.TEXTURE_2D,n),s.uniform1i(s.getUniformLocation(u,"shadowMap"),4),s.uniformBlockBinding(u,s.getUniformBlockIndex(u,"sceneBuffer"),i.location),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE);const d=this.sceneScale;s.bindTexture(s.TEXTURE_2D_ARRAY,this.yTexture);for(let n=0;n<this.voxelTextureSize;n++){const a=new c.a(-d,d,-d,d,d-n/this.voxelTextureSize*d*2,d-(n+1)/this.voxelTextureSize*d*2);a.up=p.c.fromValues(0,0,1),a.lookAt(p.c.fromValues(0,-1,0)),s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,this.yTexture,0,n),s.checkFramebufferStatus(s.FRAMEBUFFER)!=s.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+l.a.checkFrameBufferStatus(s.checkFramebufferStatus(s.FRAMEBUFFER)));const h=p.a.create();p.a.multiply(h,a.projectionMatrix,a.viewMatrix),s.uniformMatrix4fv(s.getUniformLocation(u,"viewProjection"),!1,h),s.uniformBlockBinding(u,s.getUniformBlockIndex(u,"sceneBuffer"),i.location),e.objects.forEach(n=>{this._renderObject(n,e,t,u,o,r)})}s.bindTexture(s.TEXTURE_2D_ARRAY,this.zTexture);for(let n=0;n<this.voxelTextureSize;n++){const a=new c.a(-d,d,-d,d,d-n/this.voxelTextureSize*d*2,d-(n+1)/this.voxelTextureSize*d*2);a.lookAt(p.c.fromValues(0,0,-1)),s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,this.zTexture,0,n),s.checkFramebufferStatus(s.FRAMEBUFFER)!=s.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+l.a.checkFrameBufferStatus(s.checkFramebufferStatus(s.FRAMEBUFFER)));const h=p.a.create();p.a.multiply(h,a.projectionMatrix,a.viewMatrix),s.uniformMatrix4fv(s.getUniformLocation(u,"viewProjection"),!1,h),s.uniformBlockBinding(u,s.getUniformBlockIndex(u,"sceneBuffer"),i.location),e.objects.forEach(n=>{this._renderObject(n,e,t,u,o,r)})}s.bindTexture(s.TEXTURE_2D_ARRAY,this.xTexture);for(let n=0;n<this.voxelTextureSize;n++){const a=new c.a(-d,d,-d,d,d-n/this.voxelTextureSize*d*2,d-(n+1)/this.voxelTextureSize*d*2);a.up=p.c.fromValues(0,1,0),a.lookAt(p.c.fromValues(1,0,0)),s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,this.xTexture,0,n),s.checkFramebufferStatus(s.FRAMEBUFFER)!=s.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+l.a.checkFrameBufferStatus(s.checkFramebufferStatus(s.FRAMEBUFFER)));const h=p.a.create();p.a.multiply(h,a.projectionMatrix,a.viewMatrix),s.uniformMatrix4fv(s.getUniformLocation(u,"viewProjection"),!1,h),s.uniformBlockBinding(u,s.getUniformBlockIndex(u,"sceneBuffer"),i.location),e.objects.forEach(n=>{this._renderObject(n,e,t,u,o,r)})}let h=performance.now();console.log("Voxel rendering took "+(h-a)+" milliseconds.");const m=this.voxelTextureSize;let v=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*this.voxelTextureSize*4);for(let e=0;e<this.voxelTextureSize;e++){let t=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*4);s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,this.xTexture,0,e),s.readPixels(0,0,this.voxelTextureSize,this.voxelTextureSize,s.RGBA,s.UNSIGNED_BYTE,t,0);let n=0,i=0;for(let o=0;o<m*m;o++){o>0&&o%m==0&&i++;v[4*(m-1+0+o*m*m-e-(m*m*m*i-m*i))+0]=t[n++],v[4*(m-1+0+o*m*m-e-(m*m*m*i-m*i))+1]=t[n++],v[4*(m-1+0+o*m*m-e-(m*m*m*i-m*i))+2]=t[n++],v[4*(m-1+0+o*m*m-e-(m*m*m*i-m*i))+3]=t[n++]}}for(let e=0;e<this.voxelTextureSize;e++){let t=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*4);s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,this.yTexture,0,e),s.readPixels(0,0,this.voxelTextureSize,this.voxelTextureSize,s.RGBA,s.UNSIGNED_BYTE,t,0);let n=0,i=0,o=0;for(let r=0;r<m*m;r++)r>0&&r%m==0&&(i=0,o++),t[n+0]>0&&(v[4*(e*m+m*m*o+m-i-1)+0]=t[n+0]),t[n+1]>0&&(v[4*(e*m+m*m*o+m-i-1)+1]=t[n+1]),t[n+2]>0&&(v[4*(e*m+m*m*o+m-i-1)+2]=t[n+2]),t[n+3]>0&&(v[4*(e*m+m*m*o+m-i-1)+3]=t[n+3]),n+=4,i++}for(let e=0;e<this.voxelTextureSize;e++){let t=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*4);s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,this.zTexture,0,e),s.readPixels(0,0,this.voxelTextureSize,this.voxelTextureSize,s.RGBA,s.UNSIGNED_BYTE,t,0);for(let n=0;n<this.voxelTextureSize*this.voxelTextureSize*4;n++)t[n]>0&&(v[this.voxelTextureSize*this.voxelTextureSize*e*4+n]=t[n])}s.bindTexture(s.TEXTURE_3D,this.voxelTexture),s.texImage3D(s.TEXTURE_3D,0,s.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,s.RGBA,s.UNSIGNED_BYTE,v),s.generateMipmap(s.TEXTURE_3D),s.disable(s.BLEND),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.viewport(0,0,s.canvas.width,s.canvas.height),h=performance.now(),console.log("Voxelization took "+(h-a)+" milliseconds.")}render(e,t,n,i,o,r,a){this.coneTracerShader.activate();const s=Object(f.b)(),l=this.coneTracerShader.program;s.activeTexture(s.TEXTURE0+4),s.bindTexture(s.TEXTURE_2D,n),s.uniform1i(s.getUniformLocation(l,"shadowMap"),4),s.activeTexture(s.TEXTURE0+5),s.bindTexture(s.TEXTURE_3D,this.voxelTexture),s.uniform1i(s.getUniformLocation(l,"voxelTexture"),5),s.uniformBlockBinding(l,s.getUniformBlockIndex(l,"guiDataBuffer"),i.location),s.uniformBlockBinding(l,s.getUniformBlockIndex(l,"sceneBuffer"),o.location),s.uniform1f(s.getUniformLocation(l,"sceneScale"),this.sceneScale),s.uniform1f(s.getUniformLocation(l,"voxelResolution"),this.voxelTextureSize),s.uniform3fv(s.getUniformLocation(l,"camera_world"),t.position),e.objects.forEach(n=>{this._renderObject(n,e,t,l,r,a)})}_renderObject(e,t,n,i,o,r){r.update([...e.modelMatrix,...e.normalMatrix]);const a=e.materialData;o.update([...[...a.ambient,0],...[...a.diffuse,0],...[...a.specular,0],a.specularExponent,Boolean(a.mapDiffuse),Boolean(a.mapBump),Boolean(a.mapSpecular),Boolean(a.mapDissolve)]);const s=Object(f.b)();s.uniformBlockBinding(i,s.getUniformBlockIndex(i,"materialBuffer"),o.location),s.uniformBlockBinding(i,s.getUniformBlockIndex(i,"modelMatrices"),r.location),e.uploadTextures(i),e.draw()}}t.a=m},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));n(4);class r{constructor(){`#version 300 es\n\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            out vec2 vUv;\n            out vec3 normal_world;\n            out vec4 position_depth;\n\n            uniform mat4 viewProjection;\n\n            void main() {\n                mat4 biasMatrix = mat4(\n                    0.5, 0.0, 0.0, 0.0,\n                    0.0, 0.5, 0.0, 0.0,\n                    0.0, 0.0, 0.5, 0.0,\n                    0.5, 0.5, 0.5, 1.0\n                );\n                position_depth = biasMatrix * depthMVP * vec4(position, 1.0);\n\n                vUv = uv;\n                normal_world = vec3(modelMatrix * vec4(normal, 1.0));\n                gl_Position = viewProjection * modelMatrix *  vec4(position, 1.0);\n            }\n        `,`#version 300 es\n        precision highp float;\n        precision highp int;\n        precision mediump sampler2DShadow;\n\n        in vec2 vUv;\n        in vec3 normal_world;\n        in vec4 position_depth;\n\n        layout (std140) uniform sceneBuffer {\n            mat4 viewMatrix;\n            mat4 projectionMatrix;\n            mat4 depthMVP;\n            vec3 directional_world;\n        };\n\n        layout (std140) uniform materialBuffer {\n            vec4 mambient; // 16 0 - base | aligned offset\n            vec4 mdiffuse; // 16 16\n            //vec4 memissive;\n            vec4 mspecular; // 16 32\n            float specularExponent; // 4 48\n            bool hasDiffuseMap; // 4 52\n            bool hasNormalMap; // 4 56\n            bool hasSpecularMap; // 4 60\n            bool hasDissolveMap; // 4 64\n        };\n\n        uniform sampler2D textureMap;\n        uniform sampler2D bumpMap;\n        uniform sampler2D specularMap;\n        uniform sampler2D dissolveMap;\n        uniform sampler2D shadowMap;\n\n        layout(location = 0) out vec4 layer0;\n\n        void main() {\n            vec3 L = normalize(directional_world);\n            vec3 N = normalize(normal_world);\n\n            // why you not work\n            //float visibility = texture(shadowMap, vec3(position_depth.xy, position_depth.z / position_depth.w), 0.005);\n            float visibility = 1.0;\n            if (texture( shadowMap, position_depth.xy ).r  <  position_depth.z - 0.005){\n                //visibility = texture( shadowMap, position_depth.xy ).r;\n                visibility = 0.2;\n            }\n\n            float cosTheta = visibility *  max(dot(N, L), 0.0);\n\n            if (hasDiffuseMap) {\n                float alpha = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y)).a;\n                layer0 = cosTheta * texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                layer0.a = alpha;\n            } else {\n                layer0 = cosTheta * vec4(1.0);\n                layer0.a = 1.0;\n            }\n        }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            out vec2 vUv;\n            out vec3 normal_world;\n            out vec4 position_depth;\n\n            uniform mat4 viewProjection;\n\n            void main() {\n                mat4 biasMatrix = mat4(\n                    0.5, 0.0, 0.0, 0.0,\n                    0.0, 0.5, 0.0, 0.0,\n                    0.0, 0.0, 0.5, 0.0,\n                    0.5, 0.5, 0.5, 1.0\n                );\n                position_depth = biasMatrix * depthMVP * vec4(position, 1.0);\n\n                vUv = uv;\n                normal_world = vec3(modelMatrix * vec4(normal, 1.0));\n                gl_Position = viewProjection * modelMatrix *  vec4(position, 1.0);\n            }\n        ","#version 300 es\n        precision highp float;\n        precision highp int;\n        precision mediump sampler2DShadow;\n\n        in vec2 vUv;\n        in vec3 normal_world;\n        in vec4 position_depth;\n\n        layout (std140) uniform sceneBuffer {\n            mat4 viewMatrix;\n            mat4 projectionMatrix;\n            mat4 depthMVP;\n            vec3 directional_world;\n        };\n\n        layout (std140) uniform materialBuffer {\n            vec4 mambient; // 16 0 - base | aligned offset\n            vec4 mdiffuse; // 16 16\n            //vec4 memissive;\n            vec4 mspecular; // 16 32\n            float specularExponent; // 4 48\n            bool hasDiffuseMap; // 4 52\n            bool hasNormalMap; // 4 56\n            bool hasSpecularMap; // 4 60\n            bool hasDissolveMap; // 4 64\n        };\n\n        uniform sampler2D textureMap;\n        uniform sampler2D bumpMap;\n        uniform sampler2D specularMap;\n        uniform sampler2D dissolveMap;\n        uniform sampler2D shadowMap;\n\n        layout(location = 0) out vec4 layer0;\n\n        void main() {\n            vec3 L = normalize(directional_world);\n            vec3 N = normalize(normal_world);\n\n            // why you not work\n            //float visibility = texture(shadowMap, vec3(position_depth.xy, position_depth.z / position_depth.w), 0.005);\n            float visibility = 1.0;\n            if (texture( shadowMap, position_depth.xy ).r  <  position_depth.z - 0.005){\n                //visibility = texture( shadowMap, position_depth.xy ).r;\n                visibility = 0.2;\n            }\n\n            float cosTheta = visibility *  max(dot(N, L), 0.0);\n\n            if (hasDiffuseMap) {\n                float alpha = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y)).a;\n                layer0 = cosTheta * texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                layer0.a = alpha;\n            } else {\n                layer0 = cosTheta * vec4(1.0);\n                layer0.a = 1.0;\n            }\n        }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));n(4);class r{constructor(){`#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 position;\n        \n            out vec2 textureCoordinateFrag;\n\n            vec2 scaleAndBias(vec2 p) { return 0.5 * p + vec2(0.5); }\n            void main() {\n                textureCoordinateFrag = scaleAndBias(position.xy);\n                gl_Position = vec4(position, 1);\n            }\n        `,`#version 300 es     \n            precision highp float;      \n            precision mediump sampler3D;                  \n\n            #define STEP_LENGTH 5.0\n            \n            const int MAX_POINT_LIGHTS = 8;\n\n            uniform sampler2D Texture; // Unit cube back FBO.\n            uniform sampler3D texture3D; // Texture in which voxelization is stored.\n            uniform vec3 cameraPosition;\n\n            uniform float mipmapLevel;\n            uniform float stepLength;\n            uniform float sceneScale;\n\n            in vec2 textureCoordinateFrag; \n            out vec4 color;\n                        \n            // Scales and bias a given vector (i.e. from [-1, 1] to [0, 1]).\n            vec3 scaleAndBias(vec3 p) { return 0.5 * p + vec3(0.5); }\n\n            void main() {\n                // Initialize ray.\n                vec3 origin = cameraPosition;\n                vec3 direction = texture(Texture, textureCoordinateFrag).xyz - origin;\n                int numberOfSteps = int( length(direction) / stepLength);\n                direction = normalize(direction);\n                \n                // trace\n                color = vec4(0.0);\n                for(int i = 0; i < numberOfSteps; ++i) {\n                    vec3 currentPoint = origin + stepLength * float(i) * direction;\n                    vec4 currentSample = textureLod(texture3D, scaleAndBias(currentPoint / sceneScale), mipmapLevel);\n\n                    if (currentSample.a > 0.0) {\n                        currentSample.rgb /= currentSample.a;\n                        // Alpha compositing\n                        color.rgb = color.rgb + (1.0 - color.a) * currentSample.a * currentSample.rgb;\n                        color.a   = color.a   + (1.0 - color.a) * currentSample.a;\n                    }\n                    if (color.a > 0.95) {\n                        break;\n                    }\n                    color += currentSample;\n                } \n                //color.rgb = pow(color.rgb, vec3(1.0 / 3.2));\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 position;\n        \n            out vec2 textureCoordinateFrag;\n\n            vec2 scaleAndBias(vec2 p) { return 0.5 * p + vec2(0.5); }\n            void main() {\n                textureCoordinateFrag = scaleAndBias(position.xy);\n                gl_Position = vec4(position, 1);\n            }\n        ","#version 300 es     \n            precision highp float;      \n            precision mediump sampler3D;                  \n\n            #define STEP_LENGTH 5.0\n            \n            const int MAX_POINT_LIGHTS = 8;\n\n            uniform sampler2D Texture; // Unit cube back FBO.\n            uniform sampler3D texture3D; // Texture in which voxelization is stored.\n            uniform vec3 cameraPosition;\n\n            uniform float mipmapLevel;\n            uniform float stepLength;\n            uniform float sceneScale;\n\n            in vec2 textureCoordinateFrag; \n            out vec4 color;\n                        \n            // Scales and bias a given vector (i.e. from [-1, 1] to [0, 1]).\n            vec3 scaleAndBias(vec3 p) { return 0.5 * p + vec3(0.5); }\n\n            void main() {\n                // Initialize ray.\n                vec3 origin = cameraPosition;\n                vec3 direction = texture(Texture, textureCoordinateFrag).xyz - origin;\n                int numberOfSteps = int( length(direction) / stepLength);\n                direction = normalize(direction);\n                \n                // trace\n                color = vec4(0.0);\n                for(int i = 0; i < numberOfSteps; ++i) {\n                    vec3 currentPoint = origin + stepLength * float(i) * direction;\n                    vec4 currentSample = textureLod(texture3D, scaleAndBias(currentPoint / sceneScale), mipmapLevel);\n\n                    if (currentSample.a > 0.0) {\n                        currentSample.rgb /= currentSample.a;\n                        // Alpha compositing\n                        color.rgb = color.rgb + (1.0 - color.a) * currentSample.a * currentSample.rgb;\n                        color.a   = color.a   + (1.0 - color.a) * currentSample.a;\n                    }\n                    if (color.a > 0.95) {\n                        break;\n                    }\n                    color += currentSample;\n                } \n                //color.rgb = pow(color.rgb, vec3(1.0 / 3.2));\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));n(4);class r{constructor(){`#version 300 es\n            precision highp float;\n\n            // Cred https://turanszkij.wordpress.com/2017/08/30/voxel-based-global-illumination/\n            // https://github.com/Cigg/Voxel-Cone-Tracing/blob/master/shaders/standard.frag\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            out vec2 vUv;\n            out vec3 position_world;\n            out vec4 position_depth;\n\n            out vec3 normal_world;\n            out mat3 tangentToWorld;\n\n            void main() {\n\n                mat4 biasMatrix = mat4(\n                    0.5, 0.0, 0.0, 0.0,\n                    0.0, 0.5, 0.0, 0.0,\n                    0.0, 0.0, 0.5, 0.0,\n                    0.5, 0.5, 0.5, 1.0\n                );\n\n                position_world = (modelMatrix * vec4(position, 1.0)).xyz;\n                position_depth = biasMatrix * depthMVP * vec4(position, 1.0);\n\n                // TODO: why do I need to normalize here? Bump factor too much weight otherwise\n                normal_world = normalize((modelMatrix * vec4(normal,0.0)).xyz);\n                vec3 tangent_world = normalize((modelMatrix * vec4(tangent,0.0)).xyz);\n                vec3 bitangent_world = normalize((modelMatrix * vec4(bitangent,0.0)).xyz);\n\n                vUv = uv;\n\n                tangentToWorld = mat3(\n                    tangent_world,\n                    normal_world,\n                    bitangent_world\n                );\n\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es\n            precision highp float;\n            precision mediump sampler3D;\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 - base | aligned offset\n                vec4 mdiffuse; // 16 16\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 52\n                bool hasNormalMap; // 4 56\n                bool hasSpecularMap; // 4 60\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n            uniform sampler2D shadowMap;\n            uniform sampler3D voxelTexture;\n\n            uniform float sceneScale;\n            uniform float voxelResolution;\n            uniform vec3 camera_world;\n\n            in vec2 vUv;\n            in vec3 position_world;\n            in vec4 position_depth;\n            in vec3 normal_world;\n\n            in mat3 tangentToWorld;\n\n            out vec4 outColor;\n\n            float voxelWorldSize;\n\n            const int NUM_CONES = 6;\n            vec3 coneDirections[6] = vec3[](                            \n                                        vec3(0, 1, 0),\n                                        vec3(0, 0.5, 0.866025),\n                                        vec3(0.823639, 0.5, 0.267617),\n                                        vec3(0.509037, 0.5, -0.700629),\n                                        vec3(-0.509037, 0.5, -0.700629),\n                                        vec3(-0.823639, 0.5, 0.267617)\n                                        );\n            float coneWeights[6] = float[](0.25, 0.15, 0.15, 0.15, 0.15, 0.15);\n\n            layout (std140) uniform guiDataBuffer {\n                float bumpIntensity;\n                float indirectMultiplier;\n                float directMultiplier;\n                float specularMultiplier;\n                float occlusionMultiplier;\n                float voxelConeStepSize;\n                float voxelConeMaxDist;\n                bool displayNormalMap;\n                bool displayOcclusion;\n            };\n\n            vec3 scaleAndBias(vec3 p) { return 0.5 * p + vec3(0.5); }\n\n            vec3 calculateBumpNormal() {\n                vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                bn.x *= bumpIntensity;\n                bn.y *= bumpIntensity;\n                return normalize(tangentToWorld * vec3(bn.x, 1.0, bn.y));\n            }\n\n            vec4 sampleVoxels(vec3 worldPosition, float mip) {\n                return textureLod(voxelTexture, scaleAndBias(worldPosition / 3000.0), mip);\n            }\n\n            vec4 coneTrace(vec3 direction, float tanHalfAngle, out float occlusion) {\n                vec3 color = vec3(0.0);\n                float alpha = 0.0;                    \n                occlusion = 0.0;\n            \n                // We need to offset the cone start position to avoid sampling its own voxel (self-occlusion):\n\t            // Unfortunately, it will result in disconnection between nearby surfaces :(\n                float dist = voxelWorldSize; // Start one voxel away to avoid self occlusion\n                vec3 startPos = position_world + normal_world * voxelWorldSize;                             \n\n                float maxDistance = voxelConeMaxDist * voxelWorldSize;\n                int count = 0;\n\n                while (dist < maxDistance) {\n                    // smallest sample diameter possible is the voxel size\n                    float diameter = max(voxelWorldSize, 2.0 * tanHalfAngle * dist);\n                    float mip = log2(diameter / voxelWorldSize);\n\n                    vec3 worldPosition = startPos + dist * direction;\n                    vec4 voxelColor = textureLod(voxelTexture, scaleAndBias(worldPosition / sceneScale), mip);\n\n                    // front-to-back compositing\n                    float a = (1.0 - alpha);\n                    color = color + a * voxelColor.rgb;\n                    alpha = alpha + a * voxelColor.a;\n                    \n                    color = color + voxelColor.rgb;\n                    occlusion = occlusion + a * voxelColor.a;\n\n                    dist = dist + diameter * voxelConeStepSize;\n\n                    if (alpha > 0.95) {\n                        break;\n                    }\n                }\n\n                return vec4(color, alpha);\n            }\n\n            vec3 calculateIndirectLightning(out float occlusion_out) {\n                vec4 color = vec4(0);\n                for(int i = 0; i < NUM_CONES; i++) {\n                    float occlusion = 0.0;\n                    // 60 degree cones -> tan(30) = 0.577\n                    // 90 degree cones -> tan(45) = 1.0\n                    color += coneWeights[i] * coneTrace(tangentToWorld * coneDirections[i], 0.577, occlusion);\n                    occlusion_out += coneWeights[i] * occlusion;\n                }\n                occlusion_out = max(1.0 - occlusion_out, 0.0);\n                return color.xyz;\n            }\n\n            void main() {\n\n                if (hasDissolveMap) {\n                    if (texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y)).r  < 0.1) {\n                        discard;\n                    }\n                }\n\n                voxelWorldSize = sceneScale / voxelResolution;\n                vec4 materialColor = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                float alpha = materialColor.a;\n                float occlusion = 0.0;\n\n                vec3 N = hasNormalMap ? calculateBumpNormal() : normalize(normal_world.xyz);\n                vec3 L = normalize(directional_world);\n                vec3 E = normalize(camera_world);\n\n                vec3 diffuseReflection;\n                {\n                    float visibility = 1.0;\n                    if (texture( shadowMap, position_depth.xy ).r  <  position_depth.z - 0.0005){\n                        //visibility = indirectMultiplier > 0.0 ? texture( shadowMap, position_depth.xy ).r : 0.0;\n                        visibility = 0.0;\n                    }\n\n                    // Direct diffuse light\n                    float cosTheta = max(0.0, dot(N, L));\n                    vec3 directDiffuseLight = directMultiplier * vec3(visibility * cosTheta);\n\n                    // Indirect diffuse light\n                    vec3 indirectDiffuseLight = indirectMultiplier * 2.0 * calculateIndirectLightning(occlusion);\n                    occlusion = min(1.0, occlusionMultiplier * occlusion); // Make occlusion brighter\n\n                    diffuseReflection = 2.0 * occlusion * mdiffuse.xyz * (directDiffuseLight + indirectDiffuseLight) * materialColor.rgb;\n                }\n\n                // Calculate specular light\n                vec3 specularReflection;\n                {\n                    vec4 specularColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                    specularColor = length(specularColor.gb) > 0.0 ? specularColor : specularColor.rrra;\n                    vec3 reflectDir = normalize(-E - 2.0 * dot(-E, N) * N);\n\n                    // Maybe fix so that the cone doesnt trace below the plane defined by the surface normal.\n                    // For example so that the floor doesnt reflect itself when looking at it with a small angle\n                    float specularOcclusion;\n                    vec4 tracedSpecular = coneTrace(reflectDir, 0.07, specularOcclusion); // 0.2 = 22.6 degrees, 0.1 = 11.4 degrees, 0.07 = 8 degrees angle\n                    specularReflection = 2.0 * specularOcclusion * specularMultiplier * specularColor.rgb * tracedSpecular.rgb;\n                }\n\n                if (displayNormalMap && hasNormalMap) {\n                    outColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                } else if (displayOcclusion) {\n                    outColor = vec4(occlusion, occlusion, occlusion, 1.0);\n                } else {\n                    outColor = vec4(diffuseReflection + specularReflection, alpha);\n                }\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n\n            // Cred https://turanszkij.wordpress.com/2017/08/30/voxel-based-global-illumination/\n            // https://github.com/Cigg/Voxel-Cone-Tracing/blob/master/shaders/standard.frag\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            out vec2 vUv;\n            out vec3 position_world;\n            out vec4 position_depth;\n\n            out vec3 normal_world;\n            out mat3 tangentToWorld;\n\n            void main() {\n\n                mat4 biasMatrix = mat4(\n                    0.5, 0.0, 0.0, 0.0,\n                    0.0, 0.5, 0.0, 0.0,\n                    0.0, 0.0, 0.5, 0.0,\n                    0.5, 0.5, 0.5, 1.0\n                );\n\n                position_world = (modelMatrix * vec4(position, 1.0)).xyz;\n                position_depth = biasMatrix * depthMVP * vec4(position, 1.0);\n\n                // TODO: why do I need to normalize here? Bump factor too much weight otherwise\n                normal_world = normalize((modelMatrix * vec4(normal,0.0)).xyz);\n                vec3 tangent_world = normalize((modelMatrix * vec4(tangent,0.0)).xyz);\n                vec3 bitangent_world = normalize((modelMatrix * vec4(bitangent,0.0)).xyz);\n\n                vUv = uv;\n\n                tangentToWorld = mat3(\n                    tangent_world,\n                    normal_world,\n                    bitangent_world\n                );\n\n                gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es\n            precision highp float;\n            precision mediump sampler3D;\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 - base | aligned offset\n                vec4 mdiffuse; // 16 16\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 52\n                bool hasNormalMap; // 4 56\n                bool hasSpecularMap; // 4 60\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                mat4 depthMVP;\n                vec3 directional_world;\n            };\n\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n            uniform sampler2D shadowMap;\n            uniform sampler3D voxelTexture;\n\n            uniform float sceneScale;\n            uniform float voxelResolution;\n            uniform vec3 camera_world;\n\n            in vec2 vUv;\n            in vec3 position_world;\n            in vec4 position_depth;\n            in vec3 normal_world;\n\n            in mat3 tangentToWorld;\n\n            out vec4 outColor;\n\n            float voxelWorldSize;\n\n            const int NUM_CONES = 6;\n            vec3 coneDirections[6] = vec3[](                            \n                                        vec3(0, 1, 0),\n                                        vec3(0, 0.5, 0.866025),\n                                        vec3(0.823639, 0.5, 0.267617),\n                                        vec3(0.509037, 0.5, -0.700629),\n                                        vec3(-0.509037, 0.5, -0.700629),\n                                        vec3(-0.823639, 0.5, 0.267617)\n                                        );\n            float coneWeights[6] = float[](0.25, 0.15, 0.15, 0.15, 0.15, 0.15);\n\n            layout (std140) uniform guiDataBuffer {\n                float bumpIntensity;\n                float indirectMultiplier;\n                float directMultiplier;\n                float specularMultiplier;\n                float occlusionMultiplier;\n                float voxelConeStepSize;\n                float voxelConeMaxDist;\n                bool displayNormalMap;\n                bool displayOcclusion;\n            };\n\n            vec3 scaleAndBias(vec3 p) { return 0.5 * p + vec3(0.5); }\n\n            vec3 calculateBumpNormal() {\n                vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                bn.x *= bumpIntensity;\n                bn.y *= bumpIntensity;\n                return normalize(tangentToWorld * vec3(bn.x, 1.0, bn.y));\n            }\n\n            vec4 sampleVoxels(vec3 worldPosition, float mip) {\n                return textureLod(voxelTexture, scaleAndBias(worldPosition / 3000.0), mip);\n            }\n\n            vec4 coneTrace(vec3 direction, float tanHalfAngle, out float occlusion) {\n                vec3 color = vec3(0.0);\n                float alpha = 0.0;                    \n                occlusion = 0.0;\n            \n                // We need to offset the cone start position to avoid sampling its own voxel (self-occlusion):\n\t            // Unfortunately, it will result in disconnection between nearby surfaces :(\n                float dist = voxelWorldSize; // Start one voxel away to avoid self occlusion\n                vec3 startPos = position_world + normal_world * voxelWorldSize;                             \n\n                float maxDistance = voxelConeMaxDist * voxelWorldSize;\n                int count = 0;\n\n                while (dist < maxDistance) {\n                    // smallest sample diameter possible is the voxel size\n                    float diameter = max(voxelWorldSize, 2.0 * tanHalfAngle * dist);\n                    float mip = log2(diameter / voxelWorldSize);\n\n                    vec3 worldPosition = startPos + dist * direction;\n                    vec4 voxelColor = textureLod(voxelTexture, scaleAndBias(worldPosition / sceneScale), mip);\n\n                    // front-to-back compositing\n                    float a = (1.0 - alpha);\n                    color = color + a * voxelColor.rgb;\n                    alpha = alpha + a * voxelColor.a;\n                    \n                    color = color + voxelColor.rgb;\n                    occlusion = occlusion + a * voxelColor.a;\n\n                    dist = dist + diameter * voxelConeStepSize;\n\n                    if (alpha > 0.95) {\n                        break;\n                    }\n                }\n\n                return vec4(color, alpha);\n            }\n\n            vec3 calculateIndirectLightning(out float occlusion_out) {\n                vec4 color = vec4(0);\n                for(int i = 0; i < NUM_CONES; i++) {\n                    float occlusion = 0.0;\n                    // 60 degree cones -> tan(30) = 0.577\n                    // 90 degree cones -> tan(45) = 1.0\n                    color += coneWeights[i] * coneTrace(tangentToWorld * coneDirections[i], 0.577, occlusion);\n                    occlusion_out += coneWeights[i] * occlusion;\n                }\n                occlusion_out = max(1.0 - occlusion_out, 0.0);\n                return color.xyz;\n            }\n\n            void main() {\n\n                if (hasDissolveMap) {\n                    if (texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y)).r  < 0.1) {\n                        discard;\n                    }\n                }\n\n                voxelWorldSize = sceneScale / voxelResolution;\n                vec4 materialColor = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                float alpha = materialColor.a;\n                float occlusion = 0.0;\n\n                vec3 N = hasNormalMap ? calculateBumpNormal() : normalize(normal_world.xyz);\n                vec3 L = normalize(directional_world);\n                vec3 E = normalize(camera_world);\n\n                vec3 diffuseReflection;\n                {\n                    float visibility = 1.0;\n                    if (texture( shadowMap, position_depth.xy ).r  <  position_depth.z - 0.0005){\n                        //visibility = indirectMultiplier > 0.0 ? texture( shadowMap, position_depth.xy ).r : 0.0;\n                        visibility = 0.0;\n                    }\n\n                    // Direct diffuse light\n                    float cosTheta = max(0.0, dot(N, L));\n                    vec3 directDiffuseLight = directMultiplier * vec3(visibility * cosTheta);\n\n                    // Indirect diffuse light\n                    vec3 indirectDiffuseLight = indirectMultiplier * 2.0 * calculateIndirectLightning(occlusion);\n                    occlusion = min(1.0, occlusionMultiplier * occlusion); // Make occlusion brighter\n\n                    diffuseReflection = 2.0 * occlusion * mdiffuse.xyz * (directDiffuseLight + indirectDiffuseLight) * materialColor.rgb;\n                }\n\n                // Calculate specular light\n                vec3 specularReflection;\n                {\n                    vec4 specularColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                    specularColor = length(specularColor.gb) > 0.0 ? specularColor : specularColor.rrra;\n                    vec3 reflectDir = normalize(-E - 2.0 * dot(-E, N) * N);\n\n                    // Maybe fix so that the cone doesnt trace below the plane defined by the surface normal.\n                    // For example so that the floor doesnt reflect itself when looking at it with a small angle\n                    float specularOcclusion;\n                    vec4 tracedSpecular = coneTrace(reflectDir, 0.07, specularOcclusion); // 0.2 = 22.6 degrees, 0.1 = 11.4 degrees, 0.07 = 8 degrees angle\n                    specularReflection = 2.0 * specularOcclusion * specularMultiplier * specularColor.rgb * tracedSpecular.rgb;\n                }\n\n                if (displayNormalMap && hasNormalMap) {\n                    outColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                } else if (displayOcclusion) {\n                    outColor = vec4(occlusion, occlusion, occlusion, 1.0);\n                } else {\n                    outColor = vec4(diffuseReflection + specularReflection, alpha);\n                }\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(3));n(4);class r{constructor(){`#version 300 es\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            // layout(location = 3) in vec3 tangent;\n            // layout(location = 4) in vec3 bitangent;\n           \n            // layout (std140) uniform modelMatrices {\n            //     mat4 modelMatrix;\n            //     mat4 normalMatrix;\n            // };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            out vec3 worldPosition;\n    \n            void main() {\n                worldPosition = vec3(vec4(position, 1.0));\n                gl_Position = projectionMatrix * viewMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es \n            precision highp float;\n            \n            in vec3 worldPosition;\n            out vec4 outColor;\n\n            const int MAX_POINT_LIGHTS = 8;\n\n            // TODO remoev\n            // layout (std140) uniform materialBuffer {\n            //     vec4 mambient; // 16 0 - base | aligned offset\n            //     vec4 mdiffuse; // 16 16\n            //     //vec4 memissive;\n            //     vec4 mspecular; // 16 32\n            //     float specularExponent; // 4 48\n            //     bool hasDiffuseMap; // 4 52\n            //     bool hasNormalMap; // 4 56\n            //     bool hasSpecularMap; // 4 60\n            //     bool hasDissolveMap; // 4 64\n            // };\n            \n            void main() {\n                outColor.rgb = worldPosition;\n                outColor.a = 1.0;\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            // layout(location = 3) in vec3 tangent;\n            // layout(location = 4) in vec3 bitangent;\n           \n            // layout (std140) uniform modelMatrices {\n            //     mat4 modelMatrix;\n            //     mat4 normalMatrix;\n            // };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            out vec3 worldPosition;\n    \n            void main() {\n                worldPosition = vec3(vec4(position, 1.0));\n                gl_Position = projectionMatrix * viewMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es \n            precision highp float;\n            \n            in vec3 worldPosition;\n            out vec4 outColor;\n\n            const int MAX_POINT_LIGHTS = 8;\n\n            // TODO remoev\n            // layout (std140) uniform materialBuffer {\n            //     vec4 mambient; // 16 0 - base | aligned offset\n            //     vec4 mdiffuse; // 16 16\n            //     //vec4 memissive;\n            //     vec4 mspecular; // 16 32\n            //     float specularExponent; // 4 48\n            //     bool hasDiffuseMap; // 4 52\n            //     bool hasNormalMap; // 4 56\n            //     bool hasSpecularMap; // 4 60\n            //     bool hasDissolveMap; // 4 64\n            // };\n            \n            void main() {\n                outColor.rgb = worldPosition;\n                outColor.a = 1.0;\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(5),o=n(1),r=n(0);class a extends i.a{constructor(e,t,n,i){console.assert(e&&t&&n&&i),super(),this.fov=e*(Math.PI/180),this.ratio=t,this.near=n,this.far=i,this.target=o.c.create(),this.up=o.c.fromValues(0,1,0),this.projectionMatrix=o.a.create(),this.viewMatrix=o.a.create(),this.position=o.c.fromValues(-852.113525390625,777.55029296875,102.569091796875),this.rotation=o.c.fromValues(.30800002813339233,.9680004119873047,0),this.updateProjectionMatrix()}setFov(e){e!==this.fov&&(this.fov=e*(Math.PI/180),this.updateProjectionMatrix())}setTarget(e){o.c.copy(this.target,e)}lookAt(){o.a.lookAt(this.viewMatrix,this.position,this.target,this.up)}updateProjectionMatrix(){Object(r.b)();o.a.perspective(this.projectionMatrix,this.fov,this.ratio,this.near,this.far)}}t.a=a},function(e,t,n){"use strict";(function(e){function i(e,t,n){return e<=t?t:e>=n?n:e}var o=n(1),r=n(0);const a=.5*-Math.PI;class s{constructor(t){const n=Object(r.b)();this.camera=t,this.domElement=n.canvas,this.radius=Math.max(t.position[0],t.position[2]),this.rx=Math.atan2(t.position[1],this.radius),this.ry=Math.atan2(t.position[2],t.position[0])+a,this.ox=0,this.oy=0,this.width=e.innerWidth,this.height=e.innerHeight,this.rotationSpeed=5*e.devicePixelRatio,this.zoomMin=.1,this.zoomMax=1/0,this.zoomSpeed=100,this.isDown=!1,this._listen()}_listen(){this.domElement.addEventListener("mousedown",this._onStart.bind(this),!1),this.domElement.addEventListener("mousemove",this._onMove.bind(this),!1),this.domElement.addEventListener("mouseup",this._onEnd.bind(this),!1),this.domElement.addEventListener("touchstart",this._onStart.bind(this),!1),this.domElement.addEventListener("touchmove",this._onMove.bind(this),!1),this.domElement.addEventListener("touchend",this._onEnd.bind(this),!1),e.addEventListener("mousewheel",this._onWheel.bind(this),!1)}_onStart(e){e.preventDefault(),this.oy=this.ry,this.ox=this.rx,this._startY=e.pageX/this.width,this._startX=e.pageY/this.height,this.isDown=!0}_onMove(e){if(this.isDown){const t=e.pageX/this.width,n=e.pageY/this.height;this.rx=this.ox+-(this._startX-n)*this.rotationSpeed,this.ry=this.oy+(this._startY-t)*this.rotationSpeed,this.rx=i(this.rx,.5*-Math.PI,.5*Math.PI)}}_onEnd(){this.isDown=!1}_onWheel(e){e.preventDefault();let t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=e.detail),this._zoom(-t)}_zoom(e){this.radius+=e/1e3*this.zoomSpeed,this.radius=i(this.radius,this.zoomMin,this.zoomMax)}update(){const e=this.radius*Math.sin(this.rx),t=this.radius*Math.cos(this.rx),n=Math.sin(this.ry)*t,i=Math.cos(this.ry)*t;o.c.set(this.camera.position,n,e,i),this.camera.lookAt()}}t.a=s}).call(t,n(39))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i=n(1),o=n(0);t.a=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}function r(e){e.preventDefault()}const a=Object(o.b)();this.camera=e,this.domElement=a.canvas,this.movementSpeed=50.5,this.rollSpeed=.32,this.dragToLook=!0,this.autoForward=!1,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=i.c.create(),this.rotationVector=i.c.create(),this.isDirty=!1,this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e=.9){const t=e*this.movementSpeed,n=1*e*this.rollSpeed,o=this.camera.viewMatrix,r=i.c.create();r[0]=o[0],r[1]=o[4],r[2]=o[8];const a=i.c.create();a[0]=o[2],a[1]=o[6],a[2]=o[10];const s=i.c.create();s[0]=o[1],s[1]=o[5],s[2]=o[11];const l=-this.moveVector[2],c=this.moveVector[1],u=this.moveVector[0];this.camera.position[0]+=(-l*a[0]+c*s[0]+u*r[0])*t,this.camera.position[1]+=(-l*a[1]+c*s[1]+u*r[1])*t,this.camera.position[2]+=(-l*a[2]+c*s[2]+u*r[2])*t,this.camera.rotation[0]+=this.rotationVector[0]*n,this.camera.rotation[1]+=this.rotationVector[1]*n,this.camera.rotation[2]+=this.rotationVector[2]*n,i.b.identity(this.camera.quaternion),i.b.rotateX(this.camera.quaternion,this.camera.quaternion,this.camera.rotation[0]),i.b.rotateZ(this.camera.quaternion,this.camera.quaternion,this.camera.rotation[2]),i.b.rotateY(this.camera.quaternion,this.camera.quaternion,this.camera.rotation[1]);const d=i.b.getAxisAngle(this.camera.quaternionAxisAngle,this.camera.quaternion);i.a.identity(this.camera.viewMatrix);const h=i.c.create();i.c.negate(h,this.camera.position),i.a.rotate(this.camera.viewMatrix,this.camera.viewMatrix,d,this.camera.quaternionAxisAngle),i.a.translate(this.camera.viewMatrix,this.camera.viewMatrix,h)},this.updateMovementVector=function(){const e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector[0]=-this.moveState.left+this.moveState.right,this.moveVector[1]=-this.moveState.down+this.moveState.up,this.moveVector[2]=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector[0]=this.moveState.pitchDown-this.moveState.pitchUp,this.rotationVector[1]=this.moveState.yawRight-this.moveState.yawLeft,this.rotationVector[2]=this.moveState.rollRight-this.moveState.rollLeft,this.isDirty=!0},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",r,!1),this.domElement.removeEventListener("mousedown",l,!1),this.domElement.removeEventListener("mousemove",s,!1),this.domElement.removeEventListener("mouseup",c,!1),window.removeEventListener("keydown",u,!1),window.removeEventListener("keyup",d,!1)};var s=n(this,this.mousemove),l=n(this,this.mousedown),c=n(this,this.mouseup),u=n(this,this.keydown),d=n(this,this.keyup);this.domElement.addEventListener("contextmenu",r,!1),this.domElement.addEventListener("mousemove",s,!1),this.domElement.addEventListener("mousedown",l,!1),this.domElement.addEventListener("mouseup",c,!1),window.addEventListener("keydown",u,!1),window.addEventListener("keyup",d,!1),this.updateMovementVector(),this.updateRotationVector()}},function(e,t,n){"use strict";var i=n(14),o=n(42);class r{constructor(){}load(e){return new Promise(t=>{o.downloadMeshes(e,e=>{let n=[];Object.entries(e).forEach(([e,t])=>{const o=!t.vertexNormals||!t.vertexNormals.length||isNaN(t.vertexNormals[0]);o&&console.log("Generating normals manually ...",t);const r={positions:t.vertices,normals:o?Object(i.b)(t.vertices,t.indices):t.vertexNormals,indices:t.indices,uvs:t.textures};n.push(r)}),t(n)})})}loadModelsAndMaterials(e){return new Promise(t=>{o.downloadModels(e).then(e=>{let n=[];setTimeout(()=>{Object.entries(e).forEach(([e,t])=>{const o=!t.vertexNormals||!t.vertexNormals.length||isNaN(t.vertexNormals[0]),r=!t.textures||!t.textures.length||isNaN(t.textures[0]);o&&console.info("Generating normals manually ...",e),r&&console.info("Generating UVs manually...",e);const a={name:e,objectData:{positions:t.vertices,normals:o?Object(i.b)(t.vertices,t.indices):t.vertexNormals,tangents:t.tangents,bitangents:t.bitangents,uvs:r?Object(i.c)(t.vertices):t.textures},materialData:{vertexMaterialIndices:t.vertexMaterialIndices,materialIndices:t.materialIndices,materialNames:t.materialNames,materialsByIndex:t.materialsByIndex},indices:t.indices};n.push(a)}),t(n)},2500)})})}}t.a=r},function(e,t,n){!function(t,n){e.exports=n()}("undefined"!=typeof self&&self,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){switch(e){case"BYTE":case"UNSIGNED_BYTE":return 1;case"SHORT":case"UNSIGNED_SHORT":return 2;case"FLOAT":return 4}}Object.defineProperty(t,"__esModule",{value:!0});var r=t.Layout=function e(){i(this,e);for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.attributes=n;var r=0,s=0,l=!0,c=!1,u=void 0;try{for(var d,h=n[Symbol.iterator]();!(l=(d=h.next()).done);l=!0){var f=d.value;if(this[f.key])throw new a(f);r%f.sizeOfType!=0&&(r+=f.sizeOfType-r%f.sizeOfType),this[f.key]={attribute:f,size:f.size,type:f.type,normalized:f.normalized,offset:r},r+=f.sizeInBytes,s=Math.max(s,f.sizeOfType)}}catch(e){c=!0,u=e}finally{try{!l&&h.return&&h.return()}finally{if(c)throw u}}r%s!=0&&(r+=s-r%s),this.stride=r;var p=!0,m=!1,v=void 0;try{for(var _,b=n[Symbol.iterator]();!(p=(_=b.next()).done);p=!0)this[_.value.key].stride=this.stride}catch(e){m=!0,v=e}finally{try{!p&&b.return&&b.return()}finally{if(m)throw v}}},a=function e(t){i(this,e),this.message="found duplicate attribute: "+t.key},s=function e(t,n,r){arguments.length>3&&void 0!==arguments[3]&&arguments[3],i(this,e),this.key=t,this.size=n,this.type=r,this.normalized=!1,this.sizeOfType=o(r),this.sizeInBytes=this.sizeOfType*n};r.POSITION=new s("position",3,"FLOAT"),r.NORMAL=new s("normal",3,"FLOAT"),r.TANGENT=new s("tangent",3,"FLOAT"),r.BITANGENT=new s("bitangent",3,"FLOAT"),r.UV=new s("uv",2,"FLOAT"),r.MATERIAL_INDEX=new s("materialIndex",1,"SHORT"),r.MATERIAL_ENABLED=new s("materialEnabled",1,"UNSIGNED_SHORT"),r.AMBIENT=new s("ambient",3,"FLOAT"),r.DIFFUSE=new s("diffuse",3,"FLOAT"),r.SPECULAR=new s("specular",3,"FLOAT"),r.SPECULAR_EXPONENT=new s("specularExponent",3,"FLOAT"),r.EMISSIVE=new s("emissive",3,"FLOAT"),r.TRANSMISSION_FILTER=new s("transmissionFilter",3,"FLOAT"),r.DISSOLVE=new s("dissolve",1,"FLOAT"),r.ILLUMINATION=new s("illumination",1,"UNSIGNED_SHORT"),r.REFRACTION_INDEX=new s("refractionIndex",1,"FLOAT"),r.SHARPNESS=new s("sharpness",1,"FLOAT"),r.MAP_DIFFUSE=new s("mapDiffuse",1,"SHORT"),r.MAP_AMBIENT=new s("mapAmbient",1,"SHORT"),r.MAP_SPECULAR=new s("mapSpecular",1,"SHORT"),r.MAP_SPECULAR_EXPONENT=new s("mapSpecularExponent",1,"SHORT"),r.MAP_DISSOLVE=new s("mapDissolve",1,"SHORT"),r.ANTI_ALIASING=new s("antiAliasing",1,"UNSIGNED_SHORT"),r.MAP_BUMP=new s("mapBump",1,"SHORT"),r.MAP_DISPLACEMENT=new s("mapDisplacement",1,"SHORT"),r.MAP_DECAL=new s("mapDecal",1,"SHORT"),r.MAP_EMISSIVE=new s("mapEmissive",1,"SHORT")},function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(0),s=function(){function e(t,n){o(this,e),(n=n||{}).materials=n.materials||{},n.enableWTextureCoord=!!n.enableWTextureCoord,n.indicesPerMaterial=!!n.indicesPerMaterial;var r=this;r.vertices=[],r.vertexNormals=[],r.textures=[],r.indices=[],r.textureStride=n.enableWTextureCoord?3:2,this.name="";var a=[],s=[],l=[],c={},u=[],d={},h=-1,f=0;c.verts=[],c.norms=[],c.textures=[],c.hashindices={},c.indices=[[]],c.materialIndices=[],c.index=0;for(var p=/^v\s/,m=/^vn\s/,v=/^vt\s/,_=/^f\s/,b=/\s+/,g=/^usemtl/,x=t.split("\n"),M=0;M<x.length;M++){var y=x[M].trim();if(y&&!y.startsWith("#")){var E=y.split(b);if(E.shift(),p.test(y))a.push.apply(a,i(E));else if(m.test(y))s.push.apply(s,i(E));else if(v.test(y)){var w=E;E.length>2&&!n.enableWTextureCoord?w=E.slice(0,1):2===E.length&&n.enableWTextureCoord&&w.push(0),l.push.apply(l,i(w))}else if(g.test(y)){var T=E[0];T in d||(u.push(T),d[T]=u.length-1,n.indicesPerMaterial&&d[T]>0&&c.indices.push([])),h=d[T],n.indicesPerMaterial&&(f=h)}else if(_.test(y))for(var A=!1,R=0,S=E.length;R<S;R++){3!==R||A||(R=2,A=!0);var F=E[0]+","+h,B=E[R]+","+h;if(B in c.hashindices)c.indices[f].push(c.hashindices[B]);else{var O=E[R].split("/"),C=O.length-1;if(c.verts.push(+a[3*(O[0]-1)+0]),c.verts.push(+a[3*(O[0]-1)+1]),c.verts.push(+a[3*(O[0]-1)+2]),l.length){var U=n.enableWTextureCoord?3:2;c.textures.push(+l[(O[1]-1)*U+0]),c.textures.push(+l[(O[1]-1)*U+1]),n.enableWTextureCoord&&c.textures.push(+l[(O[1]-1)*U+2])}c.norms.push(+s[3*(O[C]-1)+0]),c.norms.push(+s[3*(O[C]-1)+1]),c.norms.push(+s[3*(O[C]-1)+2]),c.materialIndices.push(h),c.hashindices[B]=c.index,c.indices[f].push(c.hashindices[B]),c.index+=1}3===R&&A&&c.indices[f].push(c.hashindices[F])}}}r.vertices=c.verts,r.vertexNormals=c.norms,r.textures=c.textures,r.vertexMaterialIndices=c.materialIndices,r.indices=n.indicesPerMaterial?c.indices:c.indices[f],r.materialNames=u,r.materialIndices=d,r.materialsByIndex={},n.calcTangentsAndBitangents&&this.calculateTangentsAndBitangents()}return r(e,[{key:"calculateTangentsAndBitangents",value:function(){var e={};e.tangents=[].concat(i(new Array(this.vertices.length))).map(function(e){return 0}),e.bitangents=[].concat(i(new Array(this.vertices.length))).map(function(e){return 0});var t=void 0;t=Array.isArray(this.indices[0])?[].concat.apply([],this.indices):this.indices;for(var n=this.vertices,o=this.vertexNormals,r=this.textures,a=0;a<t.length;a+=3){var s=t[a+0],l=t[a+1],c=t[a+2],u=n[3*s+0],d=n[3*s+1],h=n[3*s+2],f=r[2*s+0],p=r[2*s+1],m=n[3*l+0],v=n[3*l+1],_=n[3*l+2],b=r[2*l+0],g=r[2*l+1],x=m-u,M=v-d,y=_-h,E=n[3*c+0]-u,w=n[3*c+1]-d,T=n[3*c+2]-h,A=b-f,R=g-p,S=r[2*c+0]-f,F=r[2*c+1]-p,B=A*F-R*S,O=1/(Math.abs(B<1e-4)?1:B),C=(x*F-E*R)*O,U=(M*F-w*R)*O,L=(y*F-T*R)*O,D=(E*A-x*S)*O,k=(w*A-M*S)*O,P=(T*A-y*S)*O,I=o[3*s+0],N=o[3*s+1],z=o[3*s+2],j=o[3*l+0],V=o[3*l+1],X=o[3*l+2],H=o[3*c+0],G=o[3*c+1],W=o[3*c+2],Y=C*I+U*N+L*z,q=C*j+U*V+L*X,K=C*H+U*G+L*W,Q=C-I*Y,J=U-N*Y,Z=L-z*Y,$=C-j*q,ee=U-V*q,te=L-X*q,ne=C-H*K,ie=U-G*K,oe=L-W*K,re=Math.sqrt(Q*Q+J*J+Z*Z),ae=Math.sqrt($*$+ee*ee+te*te),se=Math.sqrt(ne*ne+ie*ie+oe*oe),le=D*I+k*N+P*z,ce=D*j+k*V+P*X,ue=D*H+k*G+P*W,de=D-I*le,he=k-N*le,fe=P-z*le,pe=D-j*ce,me=k-V*ce,ve=P-X*ce,_e=D-H*ue,be=k-G*ue,ge=P-W*ue,xe=Math.sqrt(de*de+he*he+fe*fe),Me=Math.sqrt(pe*pe+me*me+ve*ve),ye=Math.sqrt(_e*_e+be*be+ge*ge);e.tangents[3*s+0]+=Q/re,e.tangents[3*s+1]+=J/re,e.tangents[3*s+2]+=Z/re,e.tangents[3*l+0]+=$/ae,e.tangents[3*l+1]+=ee/ae,e.tangents[3*l+2]+=te/ae,e.tangents[3*c+0]+=ne/se,e.tangents[3*c+1]+=ie/se,e.tangents[3*c+2]+=oe/se,e.bitangents[3*s+0]+=de/xe,e.bitangents[3*s+1]+=he/xe,e.bitangents[3*s+2]+=fe/xe,e.bitangents[3*l+0]+=pe/Me,e.bitangents[3*l+1]+=me/Me,e.bitangents[3*l+2]+=ve/Me,e.bitangents[3*c+0]+=_e/ye,e.bitangents[3*c+1]+=be/ye,e.bitangents[3*c+2]+=ge/ye}this.tangents=e.tangents,this.bitangents=e.bitangents}},{key:"makeBufferData",value:function(e){var t=this.vertices.length/3,n=new ArrayBuffer(e.stride*t);n.numItems=t;for(var i=new DataView(n),o=0,r=0;o<t;o++){r=o*e.stride;var s=!0,l=!1,c=void 0;try{for(var u,d=e.attributes[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value,f=r+e[h.key].offset;switch(h.key){case a.Layout.POSITION.key:i.setFloat32(f,this.vertices[3*o],!0),i.setFloat32(f+4,this.vertices[3*o+1],!0),i.setFloat32(f+8,this.vertices[3*o+2],!0);break;case a.Layout.UV.key:i.setFloat32(f,this.textures[2*o],!0),i.setFloat32(f+4,this.vertices[2*o+1],!0);break;case a.Layout.NORMAL.key:i.setFloat32(f,this.vertexNormals[3*o],!0),i.setFloat32(f+4,this.vertexNormals[3*o+1],!0),i.setFloat32(f+8,this.vertexNormals[3*o+2],!0);break;case a.Layout.MATERIAL_INDEX.key:i.setInt16(f,this.vertexMaterialIndices[o],!0);break;case a.Layout.AMBIENT.key:var p=this.vertexMaterialIndices[o],m=this.materialsByIndex[p];if(!m)break;i.setFloat32(f,m.ambient[0],!0),i.setFloat32(f+4,m.ambient[1],!0),i.setFloat32(f+8,m.ambient[2],!0);break;case a.Layout.DIFFUSE.key:var v=this.vertexMaterialIndices[o],_=this.materialsByIndex[v];if(!_)break;i.setFloat32(f,_.diffuse[0],!0),i.setFloat32(f+4,_.diffuse[1],!0),i.setFloat32(f+8,_.diffuse[2],!0);break;case a.Layout.SPECULAR.key:var b=this.vertexMaterialIndices[o],g=this.materialsByIndex[b];if(!g)break;i.setFloat32(f,g.specular[0],!0),i.setFloat32(f+4,g.specular[1],!0),i.setFloat32(f+8,g.specular[2],!0);break;case a.Layout.SPECULAR_EXPONENT.key:var x=this.vertexMaterialIndices[o],M=this.materialsByIndex[x];if(!M)break;i.setFloat32(f,M.specularExponent,!0);break;case a.Layout.EMISSIVE.key:var y=this.vertexMaterialIndices[o],E=this.materialsByIndex[y];if(!E)break;i.setFloat32(f,E.emissive[0],!0),i.setFloat32(f+4,E.emissive[1],!0),i.setFloat32(f+8,E.emissive[2],!0);break;case a.Layout.TRANSMISSION_FILTER.key:var w=this.vertexMaterialIndices[o],T=this.materialsByIndex[w];if(!T)break;i.setFloat32(f,T.transmissionFilter[0],!0),i.setFloat32(f+4,T.transmissionFilter[1],!0),i.setFloat32(f+8,T.transmissionFilter[2],!0);break;case a.Layout.DISSOLVE.key:var A=this.vertexMaterialIndices[o],R=this.materialsByIndex[A];if(!R)break;i.setFloat32(f,R.dissolve,!0);break;case a.Layout.ILLUMINATION.key:var S=this.vertexMaterialIndices[o],F=this.materialsByIndex[S];if(!F)break;i.setInt16(f,F.illumination,!0);break;case a.Layout.REFRACTION_INDEX.key:var B=this.vertexMaterialIndices[o],O=this.materialsByIndex[B];if(!O)break;i.setFloat32(f,O.refractionIndex,!0);break;case a.Layout.SHARPNESS.key:var C=this.vertexMaterialIndices[o],U=this.materialsByIndex[C];if(!U)break;i.setFloat32(f,U.sharpness,!0);break;case a.Layout.ANTI_ALIASING.key:var L=this.vertexMaterialIndices[o],D=this.materialsByIndex[L];if(!D)break;i.setInt16(f,D.antiAliasing,!0)}}}catch(e){l=!0,c=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw c}}}return n}},{key:"makeIndexBufferData",value:function(){var e=new Uint16Array(this.indices);return e.numItems=this.indices.length,e}},{key:"addMaterialLibrary",value:function(e){for(var t in e.materials)if(t in this.materialIndices){var n=e.materials[t],i=this.materialIndices[n.name];this.materialsByIndex[i]=n}}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e){return Array.isArray(e)?e:Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=t.Material=function e(t){o(this,e),this.name=t,this.ambient=[0,0,0],this.diffuse=[0,0,0],this.specular=[0,0,0],this.emissive=[0,0,0],this.transmissionFilter=[0,0,0],this.dissolve=0,this.specularExponent=0,this.transparency=0,this.illumination=0,this.refractionIndex=1,this.sharpness=0,this.mapDiffuse=null,this.mapAmbient=null,this.mapSpecular=null,this.mapSpecularExponent=null,this.mapDissolve=null,this.antiAliasing=!1,this.mapBump=null,this.mapDisplacement=null,this.mapDecal=null,this.mapEmissive=null,this.mapReflections=[]};t.MaterialLibrary=function(){function e(t){o(this,e),this.data=t,this.currentMaterial=null,this.materials={},this.parse()}return r(e,[{key:"parse_newmtl",value:function(e){var t=e[0];this.currentMaterial=new a(t),this.materials[t]=this.currentMaterial}},{key:"parseColor",value:function(e){if("spectral"!=e[0]&&"xyz"!=e[0]){if(3==e.length)return e.map(parseFloat);var t=parseFloat(e[0]);return[t,t,t]}}},{key:"parse_Ka",value:function(e){this.currentMaterial.ambient=this.parseColor(e)}},{key:"parse_Kd",value:function(e){this.currentMaterial.diffuse=this.parseColor(e)}},{key:"parse_Ks",value:function(e){this.currentMaterial.specular=this.parseColor(e)}},{key:"parse_Ke",value:function(e){this.currentMaterial.emissive=this.parseColor(e)}},{key:"parse_Tf",value:function(e){this.currentMaterial.transmissionFilter=this.parseColor(e)}},{key:"parse_d",value:function(e){this.currentMaterial.dissolve=parseFloat(e.pop())}},{key:"parse_illum",value:function(e){this.currentMaterial.illumination=parseInt(e[0])}},{key:"parse_Ni",value:function(e){this.currentMaterial.refractionIndex=parseFloat(e[0])}},{key:"parse_Ns",value:function(e){this.currentMaterial.specularExponent=parseInt(e[0])}},{key:"parse_sharpness",value:function(e){this.currentMaterial.sharpness=parseInt(e[0])}},{key:"parse_cc",value:function(e,t){t.colorCorrection="on"==e[0]}},{key:"parse_blendu",value:function(e,t){t.horizontalBlending="on"==e[0]}},{key:"parse_blendv",value:function(e,t){t.verticalBlending="on"==e[0]}},{key:"parse_boost",value:function(e,t){t.boostMipMapSharpness=parseFloat(e[0])}},{key:"parse_mm",value:function(e,t){t.modifyTextureMap.brightness=parseFloat(e[0]),t.modifyTextureMap.contrast=parseFloat(e[1])}},{key:"parse_ost",value:function(e,t,n){for(;e.length<3;)e.push(n);t.u=parseFloat(e[0]),t.v=parseFloat(e[1]),t.w=parseFloat(e[2])}},{key:"parse_o",value:function(e,t){this.parse_ost(e,t.offset,0)}},{key:"parse_s",value:function(e,t){this.parse_ost(e,t.scale,1)}},{key:"parse_t",value:function(e,t){this.parse_ost(e,t.turbulence,0)}},{key:"parse_texres",value:function(e,t){t.textureResolution=parseFloat(e[0])}},{key:"parse_clamp",value:function(e,t){t.clamp="on"==e[0]}},{key:"parse_bm",value:function(e,t){t.bumpMultiplier=parseFloat(e[0])}},{key:"parse_imfchan",value:function(e,t){t.imfChan=e[0]}},{key:"parse_type",value:function(e,t){t.reflectionType=e[0]}},{key:"parseOptions",value:function(e){var t={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null},n=void 0,i=void 0,o={};for(e.reverse();e.length;){var r=e.pop();r.startsWith("-")?(n=r.substr(1),o[n]=[]):o[n].push(r)}for(n in o)if(o.hasOwnProperty(n)){i=o[n];var a=this["parse_"+n];a&&a.bind(this)(i,t)}return t}},{key:"parseMap",value:function(e){var t=void 0,n=void 0;if(e[0].startsWith("-"))t=e.pop(),n=e;else{var o=i(e);t=o[0],n=o.slice(1)}return n=this.parseOptions(n),n.filename=t,n}},{key:"parse_map_Ka",value:function(e){this.currentMaterial.mapAmbient=this.parseMap(e)}},{key:"parse_map_Kd",value:function(e){this.currentMaterial.mapDiffuse=this.parseMap(e)}},{key:"parse_map_Ks",value:function(e){this.currentMaterial.mapSpecular=this.parseMap(e)}},{key:"parse_map_Ke",value:function(e){this.currentMaterial.mapEmissive=this.parseMap(e)}},{key:"parse_map_Ns",value:function(e){this.currentMaterial.mapSpecularExponent=this.parseMap(e)}},{key:"parse_map_d",value:function(e){this.currentMaterial.mapDissolve=this.parseMap(e)}},{key:"parse_map_aat",value:function(e){this.currentMaterial.antiAliasing="on"==e[0]}},{key:"parse_map_bump",value:function(e){this.currentMaterial.mapBump=this.parseMap(e)}},{key:"parse_bump",value:function(e){this.parse_map_bump(e)}},{key:"parse_disp",value:function(e){this.currentMaterial.mapDisplacement=this.parseMap(e)}},{key:"parse_decal",value:function(e){this.currentMaterial.mapDecal=this.parseMap(e)}},{key:"parse_refl",value:function(e){this.currentMaterial.mapReflections.push(this.parseMap(e))}},{key:"parse",value:function(){var e=this.data.split(/\r?\n/),t=!0,n=!1,o=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var s=r.value;if((s=s.trim())&&!s.startsWith("#")){var l=s.split(/\s/),c=void 0,u=i(l);c=u[0],l=u.slice(1);var d=this["parse_"+c];d&&d.bind(this)(l)}}}catch(e){n=!0,o=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw o}}delete this.data,this.currentMaterial=null}}]),e}()},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMeshBuffers=t.initMeshBuffers=t.downloadMeshes=t.downloadModels=t.Layout=t.MaterialLibrary=t.Material=t.Mesh=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=n(2),r=n(0),a=n(5);t.Mesh=i.default,t.Material=o.Material,t.MaterialLibrary=o.MaterialLibrary,t.Layout=r.Layout,t.downloadModels=a.downloadModels,t.downloadMeshes=a.downloadMeshes,t.initMeshBuffers=a.initMeshBuffers,t.deleteMeshBuffers=a.deleteMeshBuffers},function(e,t,n){"use strict";function i(e,t){var n=["mapDiffuse","mapAmbient","mapSpecular","mapDissolve","mapBump","mapDisplacement","mapDecal","mapEmissive"];t.endsWith("/")||(t+="/");var i=[];for(var o in e.materials)if(e.materials.hasOwnProperty(o)){o=e.materials[o];var r=!0,a=!1,s=void 0;try{for(var l,c=n[Symbol.iterator]();!(r=(l=c.next()).done);r=!0){var u=l.value;!function(e){var n=o[u];if(!n)return"continue";var r=t+n.filename;i.push(fetch(r).then(function(e){if(!e.ok)throw new Error;return e.blob()}).then(function(e){var t=new Image;t.src=URL.createObjectURL(e),n.texture=t}).catch(function(){}))}()}}catch(e){a=!0,s=e}finally{try{!r&&c.return&&c.return()}finally{if(a)throw s}}}return Promise.all(i)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){o=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.downloadModels=function(e){var t=[],n=!0,s=!1,l=void 0;try{for(var c,u=e[Symbol.iterator]();!(n=(c=u.next()).done);n=!0)!function(e){var n=[];if(!e.obj)throw new Error('"obj" attribute of model object not set. The .obj file is required to be set in order to use downloadModels()');var o={};o.indicesPerMaterial=!!e.indicesPerMaterial,o.calcTangentsAndBitangents=!!e.calcTangentsAndBitangents;var s=e.name;if(!s){var l=e.obj.split("/");s=l[l.length-1].replace(".obj","")}if(n.push(Promise.resolve(s)),n.push(fetch(e.obj).then(function(e){return e.text()}).then(function(e){return new r.default(e,o)})),e.mtl){var c=e.mtl;"boolean"==typeof c&&(c=e.obj.replace(/\.obj$/,".mtl")),n.push(fetch(c).then(function(e){return e.text()}).then(function(t){var n=new a.MaterialLibrary(t);if(!1!==e.downloadMtlTextures){var o=e.mtlTextureRoot;return o||(o=c.substr(0,c.lastIndexOf("/"))),Promise.all([Promise.resolve(n),i(n,o)])}return Promise.all(Promise.resolve(n))}).then(function(e){return e[0]}))}t.push(Promise.all(n))}(c.value)}catch(e){s=!0,l=e}finally{try{!n&&u.return&&u.return()}finally{if(s)throw l}}return Promise.all(t).then(function(e){var t={},n=!0,i=!1,r=void 0;try{for(var a,s=e[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,c=o(l,3),u=c[0],d=c[1],h=c[2];d.name=u,h&&d.addMaterialLibrary(h),t[u]=d}}catch(e){i=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}return t})},t.downloadMeshes=function(e,t,n){void 0===n&&(n={});var i=[];for(var a in e)!function(t){if(!e.hasOwnProperty(t))return"continue";var n=e[t];i.push(fetch(n).then(function(e){return e.text()}).then(function(e){return[t,new r.default(e)]}))}(a);Promise.all(i).then(function(e){var i=!0,r=!1,a=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var c=s.value,u=o(c,2),d=u[0],h=u[1];n[d]=h}}catch(e){r=!0,a=e}finally{try{!i&&l.return&&l.return()}finally{if(r)throw a}}return t(n)})},t.initMeshBuffers=function(e,t){t.normalBuffer=s(e,e.ARRAY_BUFFER,t.vertexNormals,3),t.textureBuffer=s(e,e.ARRAY_BUFFER,t.textures,t.textureStride),t.vertexBuffer=s(e,e.ARRAY_BUFFER,t.vertices,3),t.indexBuffer=s(e,e.ELEMENT_ARRAY_BUFFER,t.indices,1)},t.deleteMeshBuffers=function(e,t){e.deleteBuffer(t.normalBuffer),e.deleteBuffer(t.textureBuffer),e.deleteBuffer(t.vertexBuffer),e.deleteBuffer(t.indexBuffer)};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),a=n(2),s=(n(0),function(e,t,n,i){var o=e.createBuffer(),r=t===e.ARRAY_BUFFER?Float32Array:Uint16Array;return e.bindBuffer(t,o),e.bufferData(t,new r(n),e.STATIC_DRAW),o.itemSize=i,o.numItems=n.length/i,o})}])})},function(e,t,n){"use strict";class i{constructor(){}loadImages(e){let t=[];return Object.entries(e).forEach(([e,n])=>{const i=new Promise(t=>{const i=new Image;i.onload=(()=>{const n={[e]:{width:i.width,height:i.height,data:i}};t(n)}),i.src=n});t.push(i)}),Promise.all(t)}}t.a=i}])});