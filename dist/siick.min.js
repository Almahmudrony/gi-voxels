!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("siick",[],t):"object"==typeof exports?exports.siick=t():e.siick=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/dist/",t(t.s=21)}([function(e,t,n){"use strict";n(9);var i=n(1),o=n(29),a=n(17),r=n(30),s=n(31),c=n(32),l=(n(8),n(18)),u=n(7),d=n(20);let h;class m{constructor(e){this._initialize()}_initialize(){h=canvas.getContext("webgl2",{antialias:!0});let e=f();console.log("amx draw buffers",e.getParameter(e.MAX_DRAW_BUFFERS)),this.quad=new d.a,this.renderShadowMap=!0,this.voxelize=!0,this.materialUBO=new o.a(new Float32Array(m.MATERIAL_DATA_CHUNK_SIZE)),this.modelMatricesUBO=new o.a([...i.a.create(),...i.a.create()]),this.guiUBO=new o.a(new Float32Array(500)),this.sceneUBO=new o.a(new Float32Array(400)),this.pointLightUBO=new o.a(new Float32Array(m.MAX_LIGHTS*m.LIGHT_DATA_CHUNK_SIZE)),this.directionalLightUBO=new o.a(new Float32Array(m.MAX_LIGHTS*m.LIGHT_DATA_CHUNK_SIZE)),this.standardShader=new r.a,this.shadowShader=new s.a,this.screenSpaceImageShader=new a.a,this.voxelConeTracer=new c.a(3e3,2e3,256,this.materialUBO,this.pointLightUBO,this.modelMatricesUBO,this.sceneUBO),this.sceneUBO.bind(),this.pointLightUBO.bind(),this.directionalLightUBO.bind(),this.modelMatricesUBO.bind(),this.materialUBO.bind(),this.guiUBO.bind(),this._initShadowMap()}_initShadowMap(){const e=f();this.depthFBO=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.depthFBO),this.depthTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.texImage2D(e.TEXTURE_2D,0,e.DEPTH_COMPONENT16,2048,2048,0,e.DEPTH_COMPONENT,e.UNSIGNED_SHORT,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,this.depthTexture,0),e.drawBuffers([e.NONE]),e.checkFramebufferStatus(e.FRAMEBUFFER)!=e.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+l.a.checkFrameBufferStatus(e.checkFramebufferStatus(e.FRAMEBUFFER))),this.shadowCam=new u.a(-1200,1200,-1200,1200,-2e3,2e3),this.shadowCam.position=i.c.fromValues(-.3,.9,-.25),this.shadowCam.lookAt(0,0,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}_renderObject(e,t,n,i){this.modelMatricesUBO.update([...e.modelMatrix,...e.normalMatrix]);const o=e.materialData;this.materialUBO.update([...[...o.ambient,0],...[...o.diffuse,0],...[...o.specular,0],o.specularExponent,Boolean(o.mapDiffuse),Boolean(o.mapBump),Boolean(o.mapSpecular),Boolean(o.mapDissolve)]);const a=f();a.uniformBlockBinding(i,a.getUniformBlockIndex(i,"materialBuffer"),this.materialUBO.location),a.uniformBlockBinding(i,a.getUniformBlockIndex(i,"modelMatrices"),this.modelMatricesUBO.location),e.uploadTextures(i),e.draw()}_uploadLightning(e,t){for(let t=0;t<e.pointLights.length;t++){const n=e.pointLights[t];this.pointLightUBO.update([...[n.position[0],n.position[1],n.position[2],0],...n.color,n.intensity],t*m.LIGHT_DATA_CHUNK_SIZE)}for(let t=0;t<e.directionalLights.length;++t){const n=e.directionalLights[t];this.directionalLightUBO.update([...[n.directionViewSpace[0],n.directionViewSpace[1],n.directionViewSpace[2],0],...n.color,n.intensity],t*m.LIGHT_DATA_CHUNK_SIZE)}}_renderShadowMapToScreen(){const e=f();this.screenSpaceImageShader.activate(),e.activeTexture(e.TEXTURE0+1),e.bindTexture(e.TEXTURE_2D,this.depthTexture),e.uniform1i(e.getUniformLocation(this.screenSpaceImageShader.program,"Texture"),1),e.viewport(0,0,600,600),this.quad.draw(),e.viewport(0,0,e.canvas.width,e.canvas.height)}_debugLightning(e,t){e.pointLights.forEach(e=>{if(e._debug){const n=i.a.create();i.a.multiply(n,t.viewMatrix,e.modelMatrix),i.a.multiply(n,t.projectionMatrix,n),e.draw(n)}}),e.directionalLights.forEach(e=>{if(e._debug){const n=i.a.create();i.a.multiply(n,t.viewMatrix,e.modelMatrix),i.a.multiply(n,t.projectionMatrix,n),e.draw(n)}})}_internalRender(e,t){this.guiUBO.update([e.gui.diffuseLod,e.gui.bumpIntensity,e.gui.displayBump,e.gui.displaySpecular]),this.sceneUBO.update([...t.viewMatrix,...t.projectionMatrix,e.pointLights.length,e.directionalLights.length]),this._uploadLightning(e,t),this.renderShadowMap&&(this._renderToShadowMap(e,t),this.renderShadowMap=!1),this.voxelize&&(this.voxelConeTracer.voxelize(e,t),this.voxelize=!1),e.gui.showVoxels?this.voxelConeTracer.renderVoxelDebug(e,t):this._renderScene(e,t)}_renderScene(e,t){this.standardShader.activate();const n=this.standardShader.program,i=f();i.uniformBlockBinding(n,i.getUniformBlockIndex(n,"guiDataBuffer"),this.guiUBO.location),i.uniformBlockBinding(n,i.getUniformBlockIndex(n,"sceneBuffer"),this.sceneUBO.location),i.uniformBlockBinding(n,i.getUniformBlockIndex(n,"pointLightsBuffer"),this.pointLightUBO.location),i.uniformBlockBinding(n,i.getUniformBlockIndex(n,"directionalLightsBuffer"),this.directionalLightUBO.location),e.objects.forEach(i=>{this._renderObject(i,e,t,n)})}_renderToShadowMap(e,t){const n=f();this.shadowShader.activate(),n.bindFramebuffer(n.FRAMEBUFFER,this.depthFBO),n.uniformMatrix4fv(n.getUniformLocation(this.shadowShader.program,"depthView"),!1,this.shadowCam.viewMatrix),n.uniformMatrix4fv(n.getUniformLocation(this.shadowShader.program,"depthProj"),!1,this.shadowCam.projectionMatrix),e.objects.forEach(e=>{this.modelMatricesUBO.update([...e.modelMatrix,...e.normalMatrix]),n.uniformBlockBinding(this.shadowShader.program,n.getUniformBlockIndex(this.shadowShader.program,"modelMatrices"),this.modelMatricesUBO.location),e.draw()}),n.viewport(0,0,n.canvas.width,n.canvas.height),n.bindFramebuffer(n.FRAMEBUFFER,null)}setSize(e,t){const n=e*window.devicePixelRatio,i=t*window.devicePixelRatio,o=f();o.canvas.width=n,o.canvas.height=i,o.canvas.style.width=`${n/window.devicePixelRatio}px`,o.canvas.style.height=`${i/window.devicePixelRatio}px`}render(e,t){const n=f();n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(127,127,213,1),n.clearDepth(1),n.cullFace(n.BACK),n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this._internalRender(e,t)}}m.LIGHT_DATA_CHUNK_SIZE=12,m.MATERIAL_DATA_CHUNK_SIZE=50,m.MAX_LIGHTS=16,m.MAX_MATERIALS=25;const f=()=>h;t.b=f,t.a=m},function(e,t,n){"use strict";n(4),n(22),n(23),n(10);var i=n(24),o=n(25),a=(n(26),n(11)),r=n(12);n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o}),n.d(t,"c",function(){return a}),n.d(t,"d",function(){return r})},function(e,t,n){"use strict";function i(e,t,n){const i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)?i:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(i)),e.deleteShader(i),null)}t.a=((e,t,n)=>{const o=i(e,e.VERTEX_SHADER,t),a=i(e,e.FRAGMENT_SHADER,n),r=e.createProgram();if(e.attachShader(r,o),e.attachShader(r,a),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;alert("Unable to initialize the shader program: "+e.getProgramInfoLog(r))})},function(e,t,n){"use strict";var i=n(0);class o{constructor(){const e=Object(i.b)();this._textureId=e.createTexture()}createTexture(e){const t=Object(i.b)();this._level=0,this._internalFormat=t.RGBA4,this._width=e.width,this._height=e.height,this._border=0,this._format=t.RGBA,this._dataType=t.UNSIGNED_BYTE,this._data=e,this.bind(),t.texImage2D(t.TEXTURE_2D,this._level,this._internalFormat,this._width,this._height,this._border,this._format,this._dataType,this._data),this._width&&this._height||console.err("Missing width or height"),t.generateMipmap(t.TEXTURE_2D),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR)}bind(){const e=Object(i.b)();e.bindTexture(e.TEXTURE_2D,this._textureId)}}t.a=o},function(e,t,n){"use strict";n.d(t,"a",function(){return o});const i=1e-6;t.b=i;let o="undefined"!=typeof Float32Array?Float32Array:Array;const a=Math.random;t.c=a;Math.PI},function(e,t,n){"use strict";var i=n(1);class o{constructor(){this.quaternionAxisAngle=i.c.create(),this.position=i.c.create(),this.rotation=i.c.create(),this.scale=i.c.fromValues(1,1,1),this.quaternion=i.b.create(),this.modelMatrix=i.a.create()}update(){i.a.identity(this.modelMatrix),i.b.identity(this.quaternion),i.b.rotateX(this.quaternion,this.quaternion,this.rotation[0]),i.b.rotateY(this.quaternion,this.quaternion,this.rotation[1]),i.b.rotateZ(this.quaternion,this.quaternion,this.rotation[2]);const e=i.b.getAxisAngle(this.quaternionAxisAngle,this.quaternion);i.a.translate(this.modelMatrix,this.modelMatrix,this.position),i.a.rotate(this.modelMatrix,this.modelMatrix,e,this.quaternionAxisAngle),i.a.scale(this.modelMatrix,this.modelMatrix,this.scale)}}t.a=o},function(e,t,n){"use strict";var i=n(14);class o{constructor(e,t=0){const n=.5+Math.sqrt(5)/2;let o=[-1,+n,0,1,+n,0,-1,-n,0,1,-n,0,0,-1,+n,0,1,+n,0,-1,-n,0,1,-n,+n,0,-1,+n,0,1,-n,0,-1,-n,0,1];const a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],r=[];let s={faces:Object(i.d)(a,3),positions:Object(i.d)(o,3)},c=Math.min(t,3);for(;c-- >0;)s=this.subdivide(s);for(let e=0;e<s.positions.length;e++){const t=this.normalize(s.positions[e]),n=.5*(-Math.atan2(t[2],-t[0])/Math.PI+1),i=.5+Math.asin(t[1])/Math.PI;r.push([1-n,1-i])}o=s.positions;for(let t=0;t<o.length;t++)this.scale(o[t],e);const l={positions:Object(i.a)(s.positions),indices:Object(i.a)(s.faces),normals:null,uvs:Object(i.a)(r,2)};return l.normals=Object(i.b)(l.positions,l.indices),l}fixPoleUVs(e,t,n){function i(t,i,o,a){const l=n[o],u=n[a];n[i][0]=(l[0]+u[0])/2,c++,r.push(e[i].slice()),s.push(n[i].slice()),t[0]=c}const o=this.firstYIndex(e,1),a=this.firstYIndex(e,-1);if(-1===o||-1===a)return;const r=e.slice(),s=n.slice();let c=r.length-1;for(let e=0;e<t.length;++e){const n=t[e],r=n[0],s=n[1],c=n[2];r===o?i(n,o,s,c):r===a&&i(n,a,s,c)}e=r,n=s}firstYIndex(e,t){for(let n=0;n<e.length;n++){const i=e[n];if(Math.abs(i[1]-t)<=1e-4)return n}return-1}normalize(e){let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];if(0===(t=Math.sqrt(t)))return Array.apply(null,new Array(e.length)).map(Number.prototype.valueOf,0);for(let n=0;n<e.length;n++)e[n]/=t;return e}scale(e,t){for(let n=0;n<e.length;n++)e[n]*=t;return e}subdivide(e){function t(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2,(e[2]+t[2])/2]}function n(e){return`${e[0].toPrecision(6)},${e[1].toPrecision(6)},${e[2].toPrecision(6)}`}function i(e,i){const o=t(e,i),a=n(o),r=c[a];return r||(c[a]=o,c[a])}const{positions:o,faces:a}=e,r=[],s=[],c={};let l=0;for(let e=0;e<a.length;e++){const t=a[e],n=t[0],c=t[1],u=t[2],d=o[n],h=o[c],m=o[u],f=i(d,h),p=i(h,m),v=i(m,d);let _=s.indexOf(f);-1===_&&(_=l++,s.push(f));let b=s.indexOf(p);-1===b&&(b=l++,s.push(p));let g=s.indexOf(v);-1===g&&(g=l++,s.push(v));let x=s.indexOf(d);-1===x&&(x=l++,s.push(d));let M=s.indexOf(h);-1===M&&(M=l++,s.push(h));let y=s.indexOf(m);-1===y&&(y=l++,s.push(m)),r.push([x,_,g]),r.push([M,b,_]),r.push([y,g,b]),r.push([_,b,g])}return{faces:r,positions:s}}}t.a=o},function(e,t,n){"use strict";var i=n(5),o=n(1);n(0);class a extends i.a{constructor(e,t,n,i,a,r){super(),this.left=e,this.right=t,this.bottom=n,this.top=i,this.near=a,this.far=r,this.up=o.c.fromValues(0,1,0),this.position=o.c.fromValues(0,0,0),this.projectionMatrix=o.a.create(),this.viewMatrix=o.a.create(),this.updateProjectionMatrix(e,t,n,i,a,r),this.lookAt(o.c.fromValues(-1,0,0))}lookAt(e){o.a.lookAt(this.viewMatrix,this.position,e,this.up)}updateProjectionMatrix(e,t,n,i,a,r){o.a.ortho(this.projectionMatrix,e,t,n,i,a,r)}}t.a=a},function(e,t,n){"use strict";var i=n(0),o=n(5),a=(n(36),n(37),n(38),n(3)),r=n(1);class s extends o.a{constructor(e,t){super(),this._normalMatrix=r.a.create(),this._geometry=e,this._indices=t,this._buffers=this._initializeBuffers()}get normalMatrix(){return this._normalMatrix}get shaders(){return this._shaders}get indexCount(){return this._indexCount}get buffers(){return this._buffers}set normalMatrix(e){this._normalMatrix=e}setMaterialData(e){this.materialData=e.materialData;const t=this.materialData;t.mapSpecular&&(this._specularMap=new a.a,this._specularMap.createTexture(t.mapSpecular.texture)),t.mapDiffuse&&(this._diffuseMap=new a.a,this._diffuseMap.createTexture(t.mapDiffuse.texture)),t.mapBump&&(this._bumpMap=new a.a,this._bumpMap.createTexture(t.mapBump.texture)),t.mapDissolve&&(this._dissolveMap=new a.a,this._dissolveMap.createTexture(t.mapDissolve.texture))}uploadTextures(e){const t=Object(i.b)();let n;this._diffuseMap&&(t.activeTexture(t.TEXTURE0+0),this._diffuseMap.bind(),n=t.getUniformLocation(e,"textureMap"),t.uniform1i(n,0)),this._bumpMap&&(t.activeTexture(t.TEXTURE0+1),this._bumpMap.bind(),n=t.getUniformLocation(e,"bumpMap"),t.uniform1i(n,1)),this._specularMap&&(t.activeTexture(t.TEXTURE0+2),this._specularMap.bind(),n=t.getUniformLocation(e,"specularMap"),t.uniform1i(n,2)),this._dissolveMap&&(t.activeTexture(t.TEXTURE0+3),this._dissolveMap.bind(),n=t.getUniformLocation(e,"dissolveMap"),t.uniform1i(n,3))}_initializeBuffers(){const e=this._geometry,t=Object(i.b)();this._vao=t.createVertexArray(),t.bindVertexArray(this._vao);{const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.positions),t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,3,t.FLOAT,!1,0,0)}{const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.normals),t.STATIC_DRAW),t.enableVertexAttribArray(1),t.vertexAttribPointer(1,3,t.FLOAT,!1,0,0)}{const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.uvs),t.STATIC_DRAW),t.enableVertexAttribArray(2),t.vertexAttribPointer(2,2,t.FLOAT,!1,0,0)}if(e.tangents){const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.tangents),t.STATIC_DRAW),t.enableVertexAttribArray(3),t.vertexAttribPointer(3,3,t.FLOAT,!1,0,0)}if(e.bitangents){const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.bitangents),t.STATIC_DRAW),t.enableVertexAttribArray(4),t.vertexAttribPointer(4,3,t.FLOAT,!1,0,0)}const n=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(this._indices),t.STATIC_DRAW)}draw(){const e=Object(i.b)();e.bindVertexArray(this._vao),e.drawElements(e.TRIANGLES,this._indices.length,e.UNSIGNED_INT,0)}}t.a=s},function(e,t,n){"use strict";var i=n(1),o=n(27),a=n(13),r=n(16);class s{constructor(){this.objects=[],this.pointLights=[],this.directionalLights=[],this._gui=new o.a}get gui(){return this._gui}add(e){if(e instanceof a.a){const t=e;this.pointLights.push(t);const n=this._gui.lights.addFolder("Light "+this.pointLights.length);return n.add(t.position,"x",-1e3,1e3).name("Pos x"),n.add(t.position,"y",-1e3,1e3).name("Pos y"),void n.add(t.position,"z",-1e3,1e3).name("Pos z")}if(e instanceof r.a){const t=e;this.directionalLights.push(t);const n=this._gui.lights.addFolder("Directional Light "+this.directionalLights.length);return n.add(t.direction,"x",-1e3,1e3).name("Dir x"),n.add(t.direction,"y",-1e3,1e3).name("Dir y"),void n.add(t.direction,"z",-1e3,1e3).name("Dir z")}this.objects.push(e)}traverse(e){this._gui;e.setFov(this._gui.fov);for(let t=0;t<this.objects.length;++t){this.objects[t].update();const n=this.objects[t].modelMatrix,o=i.a.create(),a=i.a.create();i.a.multiply(a,e.viewMatrix,n),i.a.invert(o,a),i.a.transpose(this.objects[t].normalMatrix,o)}for(let t=0;t<this.pointLights.length;t++){this.pointLights[t].update();const n=this.pointLights[t].position,o=i.d.fromValues(n[0],n[1],n[2],1);i.d.transformMat4(o,o,e.viewMatrix),this.pointLights[t].positionViewSpace[0]=o[0],this.pointLights[t].positionViewSpace[1]=o[1],this.pointLights[t].positionViewSpace[2]=o[2]}for(let t=0;t<this.directionalLights.length;t++){this.directionalLights[t].update();const n=this.directionalLights[t].direction,o=i.d.fromValues(n[0],n[1],n[2],0);i.d.transformMat4(o,o,e.viewMatrix),this.directionalLights[t].directionViewSpace[0]=o[0],this.directionalLights[t].directionViewSpace[1]=o[1],this.directionalLights[t].directionViewSpace[2]=o[2]}}}t.a=s},function(e,t,n){"use strict";t.a=function(){let e=new i.a(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e};var i=n(4)},function(e,t,n){"use strict";function i(){let e=new f.a(3);return e[0]=0,e[1]=0,e[2]=0,e}function o(e){let t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)}function a(e,t,n){let i=new f.a(3);return i[0]=e,i[1]=t,i[2]=n,i}function r(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function s(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function c(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function l(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+i*i+o*o)}function u(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return n*n+i*i+o*o}function d(e){let t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i}function h(e,t){let n=t[0],i=t[1],o=t[2],a=n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function m(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){var t=new f.a(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=o,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},t.subtract=r,t.multiply=s,t.divide=c,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},t.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},t.distance=l,t.squaredDistance=u,t.squaredLength=d,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=h,t.dot=m,t.cross=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=n[0],s=n[1],c=n[2];return e[0]=o*c-a*s,e[1]=a*r-i*c,e[2]=i*s-o*r,e},t.lerp=function(e,t,n,i){let o=t[0],a=t[1],r=t[2];return e[0]=o+i*(n[0]-o),e[1]=a+i*(n[1]-a),e[2]=r+i*(n[2]-r),e},t.hermite=function(e,t,n,i,o,a){let r=a*a,s=r*(2*a-3)+1,c=r*(a-2)+a,l=r*(a-1),u=r*(3-2*a);return e[0]=t[0]*s+n[0]*c+i[0]*l+o[0]*u,e[1]=t[1]*s+n[1]*c+i[1]*l+o[1]*u,e[2]=t[2]*s+n[2]*c+i[2]*l+o[2]*u,e},t.bezier=function(e,t,n,i,o,a){let r=1-a,s=r*r,c=a*a,l=s*r,u=3*a*s,d=3*c*r,h=c*a;return e[0]=t[0]*l+n[0]*u+i[0]*d+o[0]*h,e[1]=t[1]*l+n[1]*u+i[1]*d+o[1]*h,e[2]=t[2]*l+n[2]*u+i[2]*d+o[2]*h,e},t.random=function(e,t){t=t||1;let n=2*f.c()*Math.PI,i=2*f.c()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=i*t,e},t.transformMat4=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=n[3]*i+n[7]*o+n[11]*a+n[15];return r=r||1,e[0]=(n[0]*i+n[4]*o+n[8]*a+n[12])/r,e[1]=(n[1]*i+n[5]*o+n[9]*a+n[13])/r,e[2]=(n[2]*i+n[6]*o+n[10]*a+n[14])/r,e},t.transformMat3=function(e,t,n){let i=t[0],o=t[1],a=t[2];return e[0]=i*n[0]+o*n[3]+a*n[6],e[1]=i*n[1]+o*n[4]+a*n[7],e[2]=i*n[2]+o*n[5]+a*n[8],e},t.transformQuat=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=n[0],s=n[1],c=n[2],l=n[3],u=l*i+s*a-c*o,d=l*o+c*i-r*a,h=l*a+r*o-s*i,m=-r*i-s*o-c*a;return e[0]=u*l+m*-r+d*-c-h*-s,e[1]=d*l+m*-s+h*-r-u*-c,e[2]=h*l+m*-c+u*-s-d*-r,e},t.rotateX=function(e,t,n,i){let o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0],a[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),a[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.rotateY=function(e,t,n,i){let o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),a[1]=o[1],a[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.rotateZ=function(e,t,n,i){let o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),a[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),a[2]=o[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e},t.angle=function(e,t){let n=a(e[0],e[1],e[2]),i=a(t[0],t[1],t[2]);h(n,n),h(i,i);let o=m(n,i);return o>1?0:o<-1?Math.PI:Math.acos(o)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){let n=e[0],i=e[1],o=e[2],a=t[0],r=t[1],s=t[2];return Math.abs(n-a)<=f.b*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-r)<=f.b*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(o-s)<=f.b*Math.max(1,Math.abs(o),Math.abs(s))};var f=n(4);const p=r;t.sub=p;const v=s;t.mul=v;const _=c;t.div=_;const b=l;t.dist=b;const g=u;t.sqrDist=g;const x=o;t.len=x;const M=d;t.sqrLen=M;const y=function(){let e=i();return function(t,n,i,o,a,r){let s,c;for(n||(n=3),i||(i=0),c=o?Math.min(o*n+i,t.length):t.length,s=i;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],a(e,e,r),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}}();t.forEach=y},function(e,t,n){"use strict";function i(){let e=new m.a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function o(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function a(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function r(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function s(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function c(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(n*n+i*i+o*o+a*a)}function l(e,t){let n=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2],a=t[3]-e[3];return n*n+i*i+o*o+a*a}function u(e){let t=e[0],n=e[1],i=e[2],o=e[3];return Math.sqrt(t*t+n*n+i*i+o*o)}function d(e){let t=e[0],n=e[1],i=e[2],o=e[3];return t*t+n*n+i*i+o*o}function h(e,t){let n=t[0],i=t[1],o=t[2],a=t[3],r=n*n+i*i+o*o+a*a;return r>0&&(r=1/Math.sqrt(r),e[0]=n*r,e[1]=i*r,e[2]=o*r,e[3]=a*r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function(e){let t=new m.a(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,n,i){let o=new m.a(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,n,i,o){return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},t.subtract=o,t.multiply=a,t.divide=r,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},t.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=s,t.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},t.distance=c,t.squaredDistance=l,t.length=u,t.squaredLength=d,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=h,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,n,i){let o=t[0],a=t[1],r=t[2],s=t[3];return e[0]=o+i*(n[0]-o),e[1]=a+i*(n[1]-a),e[2]=r+i*(n[2]-r),e[3]=s+i*(n[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=m.c(),e[1]=m.c(),e[2]=m.c(),e[3]=m.c(),h(e,e),s(e,e,t),e},t.transformMat4=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=t[3];return e[0]=n[0]*i+n[4]*o+n[8]*a+n[12]*r,e[1]=n[1]*i+n[5]*o+n[9]*a+n[13]*r,e[2]=n[2]*i+n[6]*o+n[10]*a+n[14]*r,e[3]=n[3]*i+n[7]*o+n[11]*a+n[15]*r,e},t.transformQuat=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=n[0],s=n[1],c=n[2],l=n[3],u=l*i+s*a-c*o,d=l*o+c*i-r*a,h=l*a+r*o-s*i,m=-r*i-s*o-c*a;return e[0]=u*l+m*-r+d*-c-h*-s,e[1]=d*l+m*-s+h*-r-u*-c,e[2]=h*l+m*-c+u*-s-d*-r,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){let n=e[0],i=e[1],o=e[2],a=e[3],r=t[0],s=t[1],c=t[2],l=t[3];return Math.abs(n-r)<=m.b*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-s)<=m.b*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-c)<=m.b*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-l)<=m.b*Math.max(1,Math.abs(a),Math.abs(l))};var m=n(4);const f=o;t.sub=f;const p=a;t.mul=p;const v=r;t.div=v;const _=c;t.dist=_;const b=l;t.sqrDist=b;const g=u;t.len=g;const x=d;t.sqrLen=x;const M=function(){let e=i();return function(t,n,i,o,a,r){let s,c;for(n||(n=4),i||(i=0),c=o?Math.min(o*n+i,t.length):t.length,s=i;s<c;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,r),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();t.forEach=M},function(e,t,n){"use strict";var i=n(5),o=n(1),a=n(6),r=n(0),s=n(15);class c extends i.a{constructor(e){if(super(),this._debug=e.debug,this._color=e&&e.color||[1,1,1,1],this._intensity=e&&e.intensity||.5,this._positionViewSpace=o.c.create(),e.debug){const e=new a.a(3.2,6),t=Object(r.b)(),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.positions),t.STATIC_DRAW);const i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.indices),t.STATIC_DRAW),this._indexCount=e.indices.length,this.buffers={positions:n,indices:i},this._shader=new s.a}}get positionViewSpace(){return this._positionViewSpace}get color(){return this._color}get intensity(){return this._intensity}set positionViewSpace(e){this._positionViewSpace=e}set color(e){this._color=e}set intensity(e){this._intensity=e}draw(e){console.assert(this._debug);const t=Object(r.b)(),n=this._shader.programInfo;this._shader.activate(),t.uniformMatrix4fv(n.uniformLocations.mvp,!1,e),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.positions),t.enableVertexAttribArray(n.attribLocations.position),t.vertexAttribPointer(n.attribLocations.position,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffers.indices),t.drawElements(t.TRIANGLES,this._indexCount,t.UNSIGNED_INT,0)}}t.a=c},function(e,t,n){"use strict";function i(e){let t=[];for(let n=0;n<e.length;++n)Array.isArray(e[n])||e[n]instanceof Float32Array?t=t.concat(i(e[n])):t.push(e[n]);return t}function o(e,t){const n=[];for(let i=0;i<e.length;i+=t){const o=[];for(let n=0;n<t;n++)o.push(e[i+n]);n.push(o)}return n}function a(e,t){const n=o(t,3),a=o(e,3),s=[],c=r.c.create(),l=r.c.create(),u=r.c.create();let d,h,m;for(let e=0;e<n.length;e++){const t=n[e],i=t[0],o=t[1],f=t[2];d=a[i],h=a[o],m=a[f],r.c.subtract(c,m,h),r.c.subtract(l,d,h),r.c.cross(u,c,l),void 0===s[i]&&(s[i]=r.c.create()),void 0===s[o]&&(s[o]=r.c.create()),void 0===s[f]&&(s[f]=r.c.create()),r.c.add(s[i],s[i],u),r.c.add(s[o],s[o],u),r.c.add(s[f],s[f],u)}for(let e=0;e<s.length;e++)r.c.normalize(s[e],s[e]);return i(s,3)}t.a=i,t.d=o,t.c=function(e){const t=[];for(let n=0;n<e.length;++n)t[n]=.5;return t},t.b=a;var r=n(1)},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));class a{constructor(){`#version 300 es\n            precision mediump float;\n\n            uniform mat4 mvp;\n            in vec3 position;            \n\n            void main() {\n                gl_Position = mvp * vec4(position, 1.0);\n            }\n            `,`#version 300 es\n        precision mediump float;\n\n        out vec4 outColor;\n\n        void main() {\n            outColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }\n        `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision mediump float;\n\n            uniform mat4 mvp;\n            in vec3 position;            \n\n            void main() {\n                gl_Position = mvp * vec4(position, 1.0);\n            }\n            ","#version 300 es\n        precision mediump float;\n\n        out vec4 outColor;\n\n        void main() {\n            outColor = vec4(1.0, 0.0, 0.0, 1.0);\n        }\n        "),this.programInfo={attribLocations:{position:e.getAttribLocation(this.program,"position")},uniformLocations:{mvp:e.getUniformLocation(this.program,"mvp")}}}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";var i=n(5),o=n(1),a=n(6),r=n(0),s=n(15);class c extends i.a{constructor(e){if(super(),this._debug=e.debug,this._color=e&&e.color||[1,1,1,1],this._intensity=e&&e.intensity||.5,this.direction=e&&o.d.fromValues(e.direction[0],e.direction[1],e.direction[2],e.direction[3])||[0,-20,0,1],this.directionViewSpace=o.c.create(),e.debug){const e=new a.a(3.2,6),t=Object(r.b)(),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e.positions),t.STATIC_DRAW);const i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(e.indices),t.STATIC_DRAW),this._indexCount=e.indices.length,this.buffers={positions:n,indices:i},this._shader=new s.a}}get color(){return this._color}get intensity(){return this._intensity}set color(e){this._color=e}set intensity(e){this._intensity=e}draw(e){console.assert(this._debug);const t=Object(r.b)(),n=this._shader.programInfo;this._shader.activate(),t.uniformMatrix4fv(n.uniformLocations.mvp,!1,e),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.positions),t.enableVertexAttribArray(n.attribLocations.position),t.vertexAttribPointer(n.attribLocations.position,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffers.indices),t.drawElements(t.TRIANGLES,this._indexCount,t.UNSIGNED_INT,0)}}t.a=c},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));n(3);class a{constructor(){`#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 VertexPosition_model;\n\n            out vec2 vUv;\n\n            void main(){\n                gl_Position =  vec4(VertexPosition_model, 1);\n                vUv  = (VertexPosition_model.xy + vec2(1, 1))/2.0f;\n            }            \n        `,`#version 300 es \n            precision highp float;\n            in vec2 vUv;\n\n            layout(location = 0) out vec4 outColor;\n            \n            uniform sampler2D Texture;\n            \n            void main(){\n                outColor = normalize(texture(Texture, vUv));\n                //vec3 res = vec3(worldPosition);\n\n                //outColor = vec4(normalize(res), 1.0);\n                //outColor = vec4(texture(Texture, vUv).rgb, 1.0);\n            }\n            \n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 VertexPosition_model;\n\n            out vec2 vUv;\n\n            void main(){\n                gl_Position =  vec4(VertexPosition_model, 1);\n                vUv  = (VertexPosition_model.xy + vec2(1, 1))/2.0f;\n            }            \n        ","#version 300 es \n            precision highp float;\n            in vec2 vUv;\n\n            layout(location = 0) out vec4 outColor;\n            \n            uniform sampler2D Texture;\n            \n            void main(){\n                outColor = normalize(texture(Texture, vUv));\n                //vec3 res = vec3(worldPosition);\n\n                //outColor = vec4(normalize(res), 1.0);\n                //outColor = vec4(texture(Texture, vUv).rgb, 1.0);\n            }\n            \n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";var i=n(0);class o{constructor(e,t){const n=Object(i.b)();this.fbo=n.createFramebuffer(),n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),n.getExtension("EXT_color_buffer_float"),this.colorBuffer=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.colorBuffer),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texImage2D(n.TEXTURE_2D,0,n.RGBA16F,e,t,0,n.RGBA,n.FLOAT,null),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.colorBuffer,0),this.renderBuffer=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,this.renderBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,e,t),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.renderBuffer);const a=n.getError();console.assert(a==n.NO_ERROR);const r=n.checkFramebufferStatus(n.FRAMEBUFFER);r!=n.FRAMEBUFFER_COMPLETE&&console.error(o.checkFrameBufferStatus(r)),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null)}static checkFrameBufferStatus(e){const t=Object(i.b)();switch(e){case t.FRAMEBUFFER_COMPLETE:return"Framebuffer complete!";case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Framebuffer incomplete attachment";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"Framebuffer incomplete missing attachment";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Framebuffer incomplete dimensions!";case t.FRAMEBUFFER_UNSUPPORTED:return"Framebuffer unsupported!";case t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Framebuffer incomplete multisample!";case t.RENDERBUFFER_SAMPLES:return"Framebuffer samples!";default:return"WTF FBO!"}}transitionToShaderResource(e){const t=Object(i.b)();t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.colorBuffer),t.uniform1i(t.getUniformLocation(e,"Texture"),1)}bind(){const e=Object(i.b)();e.bindFramebuffer(e.FRAMEBUFFER,this.fbo),e.bindRenderbuffer(e.RENDERBUFFER,this.renderBuffer)}}t.a=o},function(e,t,n){"use strict";class i{constructor(e,t,n){const i=[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1];for(let o=0;o<i.length;o+=3)i[o+0]*=e,i[o+1]*=t,i[o+2]*=n;return{indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],geometry:{positions:i,uvs:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],normals:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]}}}}t.a=i},function(e,t,n){"use strict";var i=n(0),o=n(5);class a extends o.a{constructor(e,t){super(),this.positions=[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0];const n=Object(i.b)();this._vao=n.createVertexArray(),n.bindVertexArray(this._vao);{const e=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,e),n.bufferData(n.ARRAY_BUFFER,new Float32Array(this.positions),n.STATIC_DRAW),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,3,n.FLOAT,!1,0,0)}}draw(){const e=Object(i.b)();e.bindVertexArray(this._vao),e.drawArrays(e.TRIANGLES,0,6)}}t.a=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"BasicMaterial",function(){return BasicMaterial});var i=n(0),o=n(19),a=n(6),r=n(9),s=n(8),c=n(39),l=n(7),u=n(40),d=n(41),h=n(42),m=n(43),f=n(45),p=n(13),v=n(16),_=n(46),b=n(48);n.d(t,"PhongMaterial",function(){return u.a}),n.d(t,"LambertMaterial",function(){return h.a}),n.d(t,"ObjectLoader",function(){return _.a}),n.d(t,"Renderer",function(){return i.a}),n.d(t,"Cube",function(){return o.a}),n.d(t,"Sphere",function(){return a.a}),n.d(t,"Mesh",function(){return s.a}),n.d(t,"Scene",function(){return r.a}),n.d(t,"Material",function(){return d.a}),n.d(t,"PerspectiveCamera",function(){return c.a}),n.d(t,"OrthographicCamera",function(){return l.a}),n.d(t,"OrbitControls",function(){return m.a}),n.d(t,"FlyControls",function(){return f.a}),n.d(t,"PointLight",function(){return p.a}),n.d(t,"DirectionalLight",function(){return v.a}),n.d(t,"ResourceLoader",function(){return b.a}),Object.defineProperty(Float32Array.prototype,"x",{get:function(){return this[0]},set:function(e){this[0]=e}}),Object.defineProperty(Float32Array.prototype,"y",{get:function(){return this[1]},set:function(e){this[1]=e}}),Object.defineProperty(Float32Array.prototype,"z",{get:function(){return this[2]},set:function(e){this[2]=e}})},function(e,t,n){"use strict";n(4)},function(e,t,n){"use strict";n(4)},function(e,t,n){"use strict";function i(e,t,n){let i=t[0],o=t[1],a=t[2],r=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],h=t[9],m=t[10],f=t[11],p=t[12],v=t[13],_=t[14],b=t[15],g=n[0],x=n[1],M=n[2],y=n[3];return e[0]=g*i+x*s+M*d+y*p,e[1]=g*o+x*c+M*h+y*v,e[2]=g*a+x*l+M*m+y*_,e[3]=g*r+x*u+M*f+y*b,g=n[4],x=n[5],M=n[6],y=n[7],e[4]=g*i+x*s+M*d+y*p,e[5]=g*o+x*c+M*h+y*v,e[6]=g*a+x*l+M*m+y*_,e[7]=g*r+x*u+M*f+y*b,g=n[8],x=n[9],M=n[10],y=n[11],e[8]=g*i+x*s+M*d+y*p,e[9]=g*o+x*c+M*h+y*v,e[10]=g*a+x*l+M*m+y*_,e[11]=g*r+x*u+M*f+y*b,g=n[12],x=n[13],M=n[14],y=n[15],e[12]=g*i+x*s+M*d+y*p,e[13]=g*o+x*c+M*h+y*v,e[14]=g*a+x*l+M*m+y*_,e[15]=g*r+x*u+M*f+y*b,e}function o(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=function(){let e=new a.a(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){let t=new a.a(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,n,i,o,r,s,c,l,u,d,h,m,f,p,v){let _=new a.a(16);return _[0]=e,_[1]=t,_[2]=n,_[3]=i,_[4]=o,_[5]=r,_[6]=s,_[7]=c,_[8]=l,_[9]=u,_[10]=d,_[11]=h,_[12]=m,_[13]=f,_[14]=p,_[15]=v,_},t.set=function(e,t,n,i,o,a,r,s,c,l,u,d,h,m,f,p,v){return e[0]=t,e[1]=n,e[2]=i,e[3]=o,e[4]=a,e[5]=r,e[6]=s,e[7]=c,e[8]=l,e[9]=u,e[10]=d,e[11]=h,e[12]=m,e[13]=f,e[14]=p,e[15]=v,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){let n=t[1],i=t[2],o=t[3],a=t[6],r=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=o,e[13]=r,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){let n=t[0],i=t[1],o=t[2],a=t[3],r=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],m=t[11],f=t[12],p=t[13],v=t[14],_=t[15],b=n*s-i*r,g=n*c-o*r,x=n*l-a*r,M=i*c-o*s,y=i*l-a*s,E=o*l-a*c,w=u*p-d*f,T=u*v-h*f,S=u*_-m*f,A=d*v-h*p,L=d*_-m*p,R=h*_-m*v,B=b*R-g*L+x*A+M*S-y*T+E*w;return B?(B=1/B,e[0]=(s*R-c*L+l*A)*B,e[1]=(o*L-i*R-a*A)*B,e[2]=(p*E-v*y+_*M)*B,e[3]=(h*y-d*E-m*M)*B,e[4]=(c*S-r*R-l*T)*B,e[5]=(n*R-o*S+a*T)*B,e[6]=(v*x-f*E-_*g)*B,e[7]=(u*E-h*x+m*g)*B,e[8]=(r*L-s*S+l*w)*B,e[9]=(i*S-n*L-a*w)*B,e[10]=(f*y-p*x+_*b)*B,e[11]=(d*x-u*y-m*b)*B,e[12]=(s*T-r*A-c*w)*B,e[13]=(n*A-i*T+o*w)*B,e[14]=(p*g-f*M-v*b)*B,e[15]=(u*M-d*g+h*b)*B,e):null},t.adjoint=function(e,t){let n=t[0],i=t[1],o=t[2],a=t[3],r=t[4],s=t[5],c=t[6],l=t[7],u=t[8],d=t[9],h=t[10],m=t[11],f=t[12],p=t[13],v=t[14],_=t[15];return e[0]=s*(h*_-m*v)-d*(c*_-l*v)+p*(c*m-l*h),e[1]=-(i*(h*_-m*v)-d*(o*_-a*v)+p*(o*m-a*h)),e[2]=i*(c*_-l*v)-s*(o*_-a*v)+p*(o*l-a*c),e[3]=-(i*(c*m-l*h)-s*(o*m-a*h)+d*(o*l-a*c)),e[4]=-(r*(h*_-m*v)-u*(c*_-l*v)+f*(c*m-l*h)),e[5]=n*(h*_-m*v)-u*(o*_-a*v)+f*(o*m-a*h),e[6]=-(n*(c*_-l*v)-r*(o*_-a*v)+f*(o*l-a*c)),e[7]=n*(c*m-l*h)-r*(o*m-a*h)+u*(o*l-a*c),e[8]=r*(d*_-m*p)-u*(s*_-l*p)+f*(s*m-l*d),e[9]=-(n*(d*_-m*p)-u*(i*_-a*p)+f*(i*m-a*d)),e[10]=n*(s*_-l*p)-r*(i*_-a*p)+f*(i*l-a*s),e[11]=-(n*(s*m-l*d)-r*(i*m-a*d)+u*(i*l-a*s)),e[12]=-(r*(d*v-h*p)-u*(s*v-c*p)+f*(s*h-c*d)),e[13]=n*(d*v-h*p)-u*(i*v-o*p)+f*(i*h-o*d),e[14]=-(n*(s*v-c*p)-r*(i*v-o*p)+f*(i*c-o*s)),e[15]=n*(s*h-c*d)-r*(i*h-o*d)+u*(i*c-o*s),e},t.determinant=function(e){let t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],r=e[5],s=e[6],c=e[7],l=e[8],u=e[9],d=e[10],h=e[11],m=e[12],f=e[13],p=e[14],v=e[15];return(t*r-n*a)*(d*v-h*p)-(t*s-i*a)*(u*v-h*f)+(t*c-o*a)*(u*p-d*f)+(n*s-i*r)*(l*v-h*m)-(n*c-o*r)*(l*p-d*m)+(i*c-o*s)*(l*f-u*m)},t.multiply=i,t.translate=function(e,t,n){let i,o,a,r,s,c,l,u,d,h,m,f,p=n[0],v=n[1],_=n[2];return t===e?(e[12]=t[0]*p+t[4]*v+t[8]*_+t[12],e[13]=t[1]*p+t[5]*v+t[9]*_+t[13],e[14]=t[2]*p+t[6]*v+t[10]*_+t[14],e[15]=t[3]*p+t[7]*v+t[11]*_+t[15]):(i=t[0],o=t[1],a=t[2],r=t[3],s=t[4],c=t[5],l=t[6],u=t[7],d=t[8],h=t[9],m=t[10],f=t[11],e[0]=i,e[1]=o,e[2]=a,e[3]=r,e[4]=s,e[5]=c,e[6]=l,e[7]=u,e[8]=d,e[9]=h,e[10]=m,e[11]=f,e[12]=i*p+s*v+d*_+t[12],e[13]=o*p+c*v+h*_+t[13],e[14]=a*p+l*v+m*_+t[14],e[15]=r*p+u*v+f*_+t[15]),e},t.scale=function(e,t,n){let i=n[0],o=n[1],a=n[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,n,i){let o,r,s,c,l,u,d,h,m,f,p,v,_,b,g,x,M,y,E,w,T,S,A,L,R=i[0],B=i[1],I=i[2],O=Math.sqrt(R*R+B*B+I*I);return Math.abs(O)<a.b?null:(O=1/O,R*=O,B*=O,I*=O,o=Math.sin(n),r=Math.cos(n),s=1-r,c=t[0],l=t[1],u=t[2],d=t[3],h=t[4],m=t[5],f=t[6],p=t[7],v=t[8],_=t[9],b=t[10],g=t[11],x=R*R*s+r,M=B*R*s+I*o,y=I*R*s-B*o,E=R*B*s-I*o,w=B*B*s+r,T=I*B*s+R*o,S=R*I*s+B*o,A=B*I*s-R*o,L=I*I*s+r,e[0]=c*x+h*M+v*y,e[1]=l*x+m*M+_*y,e[2]=u*x+f*M+b*y,e[3]=d*x+p*M+g*y,e[4]=c*E+h*w+v*T,e[5]=l*E+m*w+_*T,e[6]=u*E+f*w+b*T,e[7]=d*E+p*w+g*T,e[8]=c*S+h*A+v*L,e[9]=l*S+m*A+_*L,e[10]=u*S+f*A+b*L,e[11]=d*S+p*A+g*L,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,n){let i=Math.sin(n),o=Math.cos(n),a=t[4],r=t[5],s=t[6],c=t[7],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+l*i,e[5]=r*o+u*i,e[6]=s*o+d*i,e[7]=c*o+h*i,e[8]=l*o-a*i,e[9]=u*o-r*i,e[10]=d*o-s*i,e[11]=h*o-c*i,e},t.rotateY=function(e,t,n){let i=Math.sin(n),o=Math.cos(n),a=t[0],r=t[1],s=t[2],c=t[3],l=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-l*i,e[1]=r*o-u*i,e[2]=s*o-d*i,e[3]=c*o-h*i,e[8]=a*i+l*o,e[9]=r*i+u*o,e[10]=s*i+d*o,e[11]=c*i+h*o,e},t.rotateZ=function(e,t,n){let i=Math.sin(n),o=Math.cos(n),a=t[0],r=t[1],s=t[2],c=t[3],l=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+l*i,e[1]=r*o+u*i,e[2]=s*o+d*i,e[3]=c*o+h*i,e[4]=l*o-a*i,e[5]=u*o-r*i,e[6]=d*o-s*i,e[7]=h*o-c*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,n){let i,o,r,s=n[0],c=n[1],l=n[2],u=Math.sqrt(s*s+c*c+l*l);return Math.abs(u)<a.b?null:(u=1/u,s*=u,c*=u,l*=u,i=Math.sin(t),o=Math.cos(t),r=1-o,e[0]=s*s*r+o,e[1]=c*s*r+l*i,e[2]=l*s*r-c*i,e[3]=0,e[4]=s*c*r-l*i,e[5]=c*c*r+o,e[6]=l*c*r+s*i,e[7]=0,e[8]=s*l*r+c*i,e[9]=c*l*r-s*i,e[10]=l*l*r+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){let n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){let n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){let n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,n){let i=t[0],o=t[1],a=t[2],r=t[3],s=i+i,c=o+o,l=a+a,u=i*s,d=i*c,h=i*l,m=o*c,f=o*l,p=a*l,v=r*s,_=r*c,b=r*l;return e[0]=1-(m+p),e[1]=d+b,e[2]=h-_,e[3]=0,e[4]=d-b,e[5]=1-(u+p),e[6]=f+v,e[7]=0,e[8]=h+_,e[9]=f-v,e[10]=1-(u+m),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){let n=t[0],i=t[1],o=t[2],a=t[4],r=t[5],s=t[6],c=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(n*n+i*i+o*o),e[1]=Math.sqrt(a*a+r*r+s*s),e[2]=Math.sqrt(c*c+l*l+u*u),e},t.getRotation=function(e,t){let n=t[0]+t[5]+t[10],i=0;return n>0?(i=2*Math.sqrt(n+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},t.fromRotationTranslationScale=function(e,t,n,i){let o=t[0],a=t[1],r=t[2],s=t[3],c=o+o,l=a+a,u=r+r,d=o*c,h=o*l,m=o*u,f=a*l,p=a*u,v=r*u,_=s*c,b=s*l,g=s*u,x=i[0],M=i[1],y=i[2];return e[0]=(1-(f+v))*x,e[1]=(h+g)*x,e[2]=(m-b)*x,e[3]=0,e[4]=(h-g)*M,e[5]=(1-(d+v))*M,e[6]=(p+_)*M,e[7]=0,e[8]=(m+b)*y,e[9]=(p-_)*y,e[10]=(1-(d+f))*y,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,n,i,o){let a=t[0],r=t[1],s=t[2],c=t[3],l=a+a,u=r+r,d=s+s,h=a*l,m=a*u,f=a*d,p=r*u,v=r*d,_=s*d,b=c*l,g=c*u,x=c*d,M=i[0],y=i[1],E=i[2],w=o[0],T=o[1],S=o[2];return e[0]=(1-(p+_))*M,e[1]=(m+x)*M,e[2]=(f-g)*M,e[3]=0,e[4]=(m-x)*y,e[5]=(1-(h+_))*y,e[6]=(v+b)*y,e[7]=0,e[8]=(f+g)*E,e[9]=(v-b)*E,e[10]=(1-(h+p))*E,e[11]=0,e[12]=n[0]+w-(e[0]*w+e[4]*T+e[8]*S),e[13]=n[1]+T-(e[1]*w+e[5]*T+e[9]*S),e[14]=n[2]+S-(e[2]*w+e[6]*T+e[10]*S),e[15]=1,e},t.fromQuat=function(e,t){let n=t[0],i=t[1],o=t[2],a=t[3],r=n+n,s=i+i,c=o+o,l=n*r,u=i*r,d=i*s,h=o*r,m=o*s,f=o*c,p=a*r,v=a*s,_=a*c;return e[0]=1-d-f,e[1]=u+_,e[2]=h-v,e[3]=0,e[4]=u-_,e[5]=1-l-f,e[6]=m+p,e[7]=0,e[8]=h+v,e[9]=m-p,e[10]=1-l-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,n,i,o,a,r){let s=1/(n-t),c=1/(o-i),l=1/(a-r);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*c,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(o+i)*c,e[10]=(r+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=r*a*2*l,e[15]=0,e},t.perspective=function(e,t,n,i,o){let a=1/Math.tan(t/2),r=1/(i-o);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+i)*r,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*i*r,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,n,i){let o=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),r=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),c=2/(r+s),l=2/(o+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(r-s)*c*.5,e[9]=(o-a)*l*.5,e[10]=i/(n-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*n/(n-i),e[15]=0,e},t.ortho=function(e,t,n,i,o,a,r){let s=1/(t-n),c=1/(i-o),l=1/(a-r);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(o+i)*c,e[14]=(r+a)*l,e[15]=1,e},t.lookAt=function(e,t,n,i){let o,r,s,c,l,u,d,h,m,f,p=t[0],v=t[1],_=t[2],b=i[0],g=i[1],x=i[2],M=n[0],y=n[1],E=n[2];return Math.abs(p-M)<a.b&&Math.abs(v-y)<a.b&&Math.abs(_-E)<a.b?mat4.identity(e):(d=p-M,h=v-y,m=_-E,f=1/Math.sqrt(d*d+h*h+m*m),d*=f,h*=f,m*=f,o=g*m-x*h,r=x*d-b*m,s=b*h-g*d,(f=Math.sqrt(o*o+r*r+s*s))?(o*=f=1/f,r*=f,s*=f):(o=0,r=0,s=0),c=h*s-m*r,l=m*o-d*s,u=d*r-h*o,(f=Math.sqrt(c*c+l*l+u*u))?(c*=f=1/f,l*=f,u*=f):(c=0,l=0,u=0),e[0]=o,e[1]=c,e[2]=d,e[3]=0,e[4]=r,e[5]=l,e[6]=h,e[7]=0,e[8]=s,e[9]=u,e[10]=m,e[11]=0,e[12]=-(o*p+r*v+s*_),e[13]=-(c*p+l*v+u*_),e[14]=-(d*p+h*v+m*_),e[15]=1,e)},t.targetTo=function(e,t,n,i){let o=t[0],a=t[1],r=t[2],s=i[0],c=i[1],l=i[2],u=o-n[0],d=a-n[1],h=r-n[2],m=u*u+d*d+h*h;m>0&&(u*=m=1/Math.sqrt(m),d*=m,h*=m);let f=c*h-l*d,p=l*u-s*h,v=s*d-c*u;return e[0]=f,e[1]=p,e[2]=v,e[3]=0,e[4]=d*v-h*p,e[5]=h*f-u*v,e[6]=u*p-d*f,e[7]=0,e[8]=u,e[9]=d,e[10]=h,e[11]=0,e[12]=o,e[13]=a,e[14]=r,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},t.subtract=o,t.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},t.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){let n=e[0],i=e[1],o=e[2],r=e[3],s=e[4],c=e[5],l=e[6],u=e[7],d=e[8],h=e[9],m=e[10],f=e[11],p=e[12],v=e[13],_=e[14],b=e[15],g=t[0],x=t[1],M=t[2],y=t[3],E=t[4],w=t[5],T=t[6],S=t[7],A=t[8],L=t[9],R=t[10],B=t[11],I=t[12],O=t[13],F=t[14],U=t[15];return Math.abs(n-g)<=a.b*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-x)<=a.b*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-M)<=a.b*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(r-y)<=a.b*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(s-E)<=a.b*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(c-w)<=a.b*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(l-T)<=a.b*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(u-S)<=a.b*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(d-A)<=a.b*Math.max(1,Math.abs(d),Math.abs(A))&&Math.abs(h-L)<=a.b*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(m-R)<=a.b*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(f-B)<=a.b*Math.max(1,Math.abs(f),Math.abs(B))&&Math.abs(p-I)<=a.b*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(v-O)<=a.b*Math.max(1,Math.abs(v),Math.abs(O))&&Math.abs(_-F)<=a.b*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(b-U)<=a.b*Math.max(1,Math.abs(b),Math.abs(U))};var a=n(4);const r=i;t.mul=r;const s=o;t.sub=s},function(e,t,n){"use strict";function i(){let e=new c.a(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function o(e,t,n){n*=.5;let i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e}function a(e,t,n){let i=t[0],o=t[1],a=t[2],r=t[3],s=n[0],c=n[1],l=n[2],u=n[3];return e[0]=i*u+r*s+o*l-a*c,e[1]=o*u+r*c+a*s-i*l,e[2]=a*u+r*l+i*c-o*s,e[3]=r*u-i*s-o*c-a*l,e}function r(e,t,n,i){let o,a,r,s,c,l=t[0],u=t[1],d=t[2],h=t[3],m=n[0],f=n[1],p=n[2],v=n[3];return(a=l*m+u*f+d*p+h*v)<0&&(a=-a,m=-m,f=-f,p=-p,v=-v),1-a>1e-6?(o=Math.acos(a),r=Math.sin(o),s=Math.sin((1-i)*o)/r,c=Math.sin(i*o)/r):(s=1-i,c=i),e[0]=s*l+c*m,e[1]=s*u+c*f,e[2]=s*d+c*p,e[3]=s*h+c*v,e}function s(e,t){let n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*o+o]-t[3*a+a]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+i]+t[3*i+o])*n,e[a]=(t[3*a+i]+t[3*i+a])*n}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=o,t.getAxisAngle=function(e,t){let n=2*Math.acos(t[3]),i=Math.sin(n/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},t.multiply=a,t.rotateX=function(e,t,n){n*=.5;let i=t[0],o=t[1],a=t[2],r=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=i*c+r*s,e[1]=o*c+a*s,e[2]=a*c-o*s,e[3]=r*c-i*s,e},t.rotateY=function(e,t,n){n*=.5;let i=t[0],o=t[1],a=t[2],r=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=i*c-a*s,e[1]=o*c+r*s,e[2]=a*c+i*s,e[3]=r*c-o*s,e},t.rotateZ=function(e,t,n){n*=.5;let i=t[0],o=t[1],a=t[2],r=t[3],s=Math.sin(n),c=Math.cos(n);return e[0]=i*c+o*s,e[1]=o*c-i*s,e[2]=a*c+r*s,e[3]=r*c-a*s,e},t.calculateW=function(e,t){let n=t[0],i=t[1],o=t[2];return e[0]=n,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-o*o)),e},t.slerp=r,t.invert=function(e,t){let n=t[0],i=t[1],o=t[2],a=t[3],r=n*n+i*i+o*o+a*a,s=r?1/r:0;return e[0]=-n*s,e[1]=-i*s,e[2]=-o*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=s,t.fromEuler=function(e,t,n,i){let o=.5*Math.PI/180;t*=o,n*=o,i*=o;let a=Math.sin(t),r=Math.cos(t),s=Math.sin(n),c=Math.cos(n),l=Math.sin(i),u=Math.cos(i);return e[0]=a*c*u-r*s*l,e[1]=r*s*u+a*c*l,e[2]=r*c*l-a*s*u,e[3]=r*c*u+a*s*l,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var c=n(4),l=n(10),u=n(11),d=n(12);const h=d.clone;t.clone=h;const m=d.fromValues;t.fromValues=m;const f=d.copy;t.copy=f;const p=d.set;t.set=p;const v=d.add;t.add=v;const _=a;t.mul=_;const b=d.scale;t.scale=b;const g=d.dot;t.dot=g;const x=d.lerp;t.lerp=x;const M=d.length;t.length=M;const y=M;t.len=y;const E=d.squaredLength;t.squaredLength=E;const w=E;t.sqrLen=w;const T=d.normalize;t.normalize=T;const S=d.exactEquals;t.exactEquals=S;const A=d.equals;t.equals=A;const L=function(){let e=u.create(),t=u.fromValues(1,0,0),n=u.fromValues(0,1,0);return function(i,a,r){let s=u.dot(a,r);return s<-.999999?(u.cross(e,t,a),u.len(e)<1e-6&&u.cross(e,n,a),u.normalize(e,e),o(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(u.cross(e,a,r),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,T(i,i))}}();t.rotationTo=L;const R=function(){let e=i(),t=i();return function(n,i,o,a,s,c){return r(e,i,s,c),r(t,o,a,c),r(n,e,t,2*c*(1-c)),n}}();t.sqlerp=R;const B=function(){let e=l.a();return function(t,n,i,o){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],T(t,s(t,e))}}();t.setAxes=B},function(e,t,n){"use strict";function i(){let e=new o.a(2);return e[0]=0,e[1]=0,e}var o=n(4);!function(){let e=i()}()},function(e,t,n){"use strict";const i=n(28).default;class o{constructor(){this._gui=new i.GUI,this._lightsFolder=this._gui.addFolder("Lights"),this.displayBump=!1,this.displaySpecular=!1,this.bumpIntensity=1,this.diffuseLod=0,this.fov=90,this._voxelFolder=this._gui.addFolder("Voxeldebug"),this.showVoxels=!1,this.voxelMipmap=0,this.voxelDebugStepSize=5,this._specularMap=this._gui.add(this,"displaySpecular"),this._bumpMap=this._gui.add(this,"displayBump"),this._bumpIntensity=this._gui.add(this,"bumpIntensity",0,2),this._lod=this._gui.add(this,"diffuseLod",0,5),this._fov=this._gui.add(this,"fov",0,100),this._showVoxels=this._voxelFolder.add(this,"showVoxels"),this._voxelMipmap=this._voxelFolder.add(this,"voxelMipmap",0,5),this._voxelDebugStepSize=this._voxelFolder.add(this,"voxelDebugStepSize",1,20)}get lights(){return this._lightsFolder}}t.a=o},function(e,t,n){"use strict";function i(e,t){var n=e.__state.conversionName.toString(),i=Math.round(e.r),o=Math.round(e.g),a=Math.round(e.b),r=e.a,s=Math.round(e.h),c=e.s.toFixed(1),l=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var u=e.hex.toString(16);u.length<6;)u="0"+u;return"#"+u}return"CSS_RGB"===n?"rgb("+i+","+o+","+a+")":"CSS_RGBA"===n?"rgba("+i+","+o+","+a+","+r+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+i+","+o+","+a+"]":"RGBA_ARRAY"===n?"["+i+","+o+","+a+","+r+"]":"RGB_OBJ"===n?"{r:"+i+",g:"+o+",b:"+a+"}":"RGBA_OBJ"===n?"{r:"+i+",g:"+o+",b:"+a+",a:"+r+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+c+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+c+",v:"+l+",a:"+r+"}":"unknown format"}function o(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space?this.__state[t]:(z.recalculateRGB(this,t,n),this.__state[t])},set:function(e){"RGB"!==this.__state.space&&(z.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function a(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space?this.__state[t]:(z.recalculateHSV(this),this.__state[t])},set:function(e){"HSV"!==this.__state.space&&(z.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}function r(e){if("0"===e||R.isUndefined(e))return 0;var t=e.match(Y);return R.isNull(t)?0:parseFloat(t[1])}function s(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}function c(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}function l(e,t,n,i,o){return i+(e-t)/(n-t)*(o-i)}function u(e,t,n,i){e.style.background="",R.each(ne,function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+i+" 100%); "})}function d(e){e.style.background="",e.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",e.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",e.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}function h(e,t,n){var i=document.createElement("li");return t&&i.appendChild(t),n?e.__ul.insertBefore(i,n):e.__ul.appendChild(i),e.onResize(),i}function m(e){q.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&q.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function f(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function p(e,t,n){if(n.__li=t,n.__gui=e,R.extend(n,{options:function(t){if(arguments.length>1){var i=n.__li.nextElementSibling;return n.remove(),_(e,n.object,n.property,{before:i,factoryArgs:[R.toArray(arguments)]})}if(R.isArray(t)||R.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),_(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof $){var i=new Z(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});R.each(["updateDisplay","onChange","onFinishChange","step"],function(e){var t=n[e],o=i[e];n[e]=i[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(i,e),t.apply(n,e)}}),q.addClass(t,"has-slider"),n.domElement.insertBefore(i.domElement,n.domElement.firstElementChild)}else if(n instanceof Z){var o=function(t){if(R.isNumber(n.__min)&&R.isNumber(n.__max)){var i=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var a=_(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return a.name(i),o&&a.listen(),a}return t};n.min=R.compose(o,n.min),n.max=R.compose(o,n.max)}else n instanceof W?(q.bind(t,"click",function(){q.fakeEvent(n.__checkbox,"click")}),q.bind(n.__checkbox,"click",function(e){e.stopPropagation()})):n instanceof ee?(q.bind(t,"click",function(){q.fakeEvent(n.__button,"click")}),q.bind(t,"mouseover",function(){q.addClass(n.__button,"hover")}),q.bind(t,"mouseout",function(){q.removeClass(n.__button,"hover")})):n instanceof te&&(q.addClass(t,"color"),n.updateDisplay=R.compose(function(e){return t.style.borderLeftColor=n.__color.toString(),e},n.updateDisplay),n.updateDisplay());n.setValue=R.compose(function(t){return e.getRoot().__preset_select&&n.isModified()&&f(e.getRoot(),!0),t},n.setValue)}function v(e,t){var n=e.getRoot(),i=n.__rememberedObjects.indexOf(t.object);if(-1!==i){var o=n.__rememberedObjectIndecesToControllers[i];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[i]=o),o[t.property]=t,n.load&&n.load.remembered){var a=n.load.remembered,r=void 0;if(a[e.preset])r=a[e.preset];else{if(!a[ce])return;r=a[ce]}if(r[i]&&void 0!==r[i][t.property]){var s=r[i][t.property];t.initialValue=s,t.setValue(s)}}}}function _(e,t,n,i){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(i.color)o=new te(t,n);else{var a=[t,n].concat(i.factoryArgs);o=oe.apply(e,a)}i.before instanceof X&&(i.before=i.before.__li),v(e,o),q.addClass(o.domElement,"c");var r=document.createElement("span");q.addClass(r,"property-name"),r.innerHTML=o.property;var s=document.createElement("div");s.appendChild(r),s.appendChild(o.domElement);var c=h(e,s,i.before);return q.addClass(c,pe.CLASS_CONTROLLER_ROW),o instanceof te?q.addClass(c,"color"):q.addClass(c,D(o.getValue())),p(e,c,o),e.__controllers.push(o),o}function b(e,t){return document.location.href+"."+t}function g(e,t,n){var i=document.createElement("option");i.innerHTML=t,i.value=t,e.__preset_select.appendChild(i),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function x(e,t){t.style.display=e.useLocalStorage?"block":"none"}function M(e){var t=e.__save_row=document.createElement("li");q.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),q.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",q.addClass(n,"button gears");var i=document.createElement("span");i.innerHTML="Save",q.addClass(i,"button"),q.addClass(i,"save");var o=document.createElement("span");o.innerHTML="New",q.addClass(o,"button"),q.addClass(o,"save-as");var a=document.createElement("span");a.innerHTML="Revert",q.addClass(a,"button"),q.addClass(a,"revert");var r=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?R.each(e.load.remembered,function(t,n){g(e,n,n===e.preset)}):g(e,ce,!1),q.bind(r,"change",function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value}),t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(a),le){var s=document.getElementById("dg-local-explain"),c=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(b(e,"isLocal"))&&c.setAttribute("checked","checked"),x(e,s),q.bind(c,"change",function(){e.useLocalStorage=!e.useLocalStorage,x(e,s)})}var l=document.getElementById("dg-new-constructor");q.bind(l,"keydown",function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||ue.hide()}),q.bind(n,"click",function(){l.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),ue.show(),l.focus(),l.select()}),q.bind(i,"click",function(){e.save()}),q.bind(o,"click",function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)}),q.bind(a,"click",function(){e.revert()})}function y(e){function t(t){return t.preventDefault(),e.width+=o-t.clientX,e.onResize(),o=t.clientX,!1}function n(){q.removeClass(e.__closeButton,pe.CLASS_DRAG),q.unbind(window,"mousemove",t),q.unbind(window,"mouseup",n)}function i(i){return i.preventDefault(),o=i.clientX,q.addClass(e.__closeButton,pe.CLASS_DRAG),q.bind(window,"mousemove",t),q.bind(window,"mouseup",n),!1}var o=void 0;e.__resize_handle=document.createElement("div"),R.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),q.bind(e.__resize_handle,"mousedown",i),q.bind(e.__closeButton,"mousedown",i),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function E(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function w(e,t){var n={};return R.each(e.__rememberedObjects,function(i,o){var a={},r=e.__rememberedObjectIndecesToControllers[o];R.each(r,function(e,n){a[n]=t?e.initialValue:e.getValue()}),n[o]=a}),n}function T(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}function S(e){0!==e.length&&ae.call(window,function(){S(e)}),R.each(e,function(e){e.updateDisplay()})}Object.defineProperty(t,"__esModule",{value:!0});var A=Array.prototype.forEach,L=Array.prototype.slice,R={BREAK:{},extend:function(e){return this.each(L.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))},this),e},defaults:function(e){return this.each(L.call(arguments,1),function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))},this),e},compose:function(){var e=L.call(arguments);return function(){for(var t=L.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(A&&e.forEach&&e.forEach===A)e.forEach(t,n);else if(e.length===e.length+0){var i=void 0,o=void 0;for(i=0,o=e.length;i<o;i++)if(i in e&&t.call(n,e[i],i)===this.BREAK)return}else for(var a in e)if(t.call(n,e[a],a)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var i=void 0;return function(){var o=this,a=arguments,r=n||!i;clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(o,a)},t),r&&e.apply(o,a)}},toArray:function(e){return e.toArray?e.toArray():L.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return isNaN(e)}),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)}},B=[{litmus:R.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:i},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:i},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:i},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:i}}},{litmus:R.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:R.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:R.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(R.isNumber(e.r)&&R.isNumber(e.g)&&R.isNumber(e.b)&&R.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(R.isNumber(e.r)&&R.isNumber(e.g)&&R.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(R.isNumber(e.h)&&R.isNumber(e.s)&&R.isNumber(e.v)&&R.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(R.isNumber(e.h)&&R.isNumber(e.s)&&R.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],I=void 0,O=void 0,F=function(){O=!1;var e=arguments.length>1?R.toArray(arguments):arguments[0];return R.each(B,function(t){if(t.litmus(e))return R.each(t.conversions,function(t,n){if(I=t.read(e),!1===O&&!1!==I)return O=I,I.conversionName=n,I.conversion=t,R.BREAK}),R.BREAK}),O},U=void 0,C={hsv_to_rgb:function(e,t,n){var i=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),a=n*(1-t),r=n*(1-o*t),s=n*(1-(1-o)*t),c=[[n,s,a],[r,n,a],[a,n,s],[a,r,n],[s,a,n],[n,a,r]][i];return{r:255*c[0],g:255*c[1],b:255*c[2]}},rgb_to_hsv:function(e,t,n){var i=Math.min(e,t,n),o=Math.max(e,t,n),a=o-i,r=void 0,s=void 0;return 0===o?{h:NaN,s:0,v:0}:(s=a/o,r=e===o?(t-n)/a:t===o?2+(n-e)/a:4+(e-t)/a,(r/=6)<0&&(r+=1),{h:360*r,s:s,v:o/255})},rgb_to_hex:function(e,t,n){var i=this.hex_with_component(0,2,e);return i=this.hex_with_component(i,1,t),i=this.hex_with_component(i,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(U=8*t)|e&~(255<<U)}},D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},k=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),N=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(i)},V=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},j=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},z=function(){function e(){if(P(this,e),this.__state=F.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return k(e,[{key:"toString",value:function(){return i(this)}},{key:"toHexString",value:function(){return i(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();z.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=C.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");R.extend(e.__state,C.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},z.recalculateHSV=function(e){var t=C.rgb_to_hsv(e.r,e.g,e.b);R.extend(e.__state,{s:t.s,v:t.v}),R.isNaN(t.h)?R.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},z.COMPONENTS=["r","g","b","h","s","v","hex","a"],o(z.prototype,"r",2),o(z.prototype,"g",1),o(z.prototype,"b",0),a(z.prototype,"h"),a(z.prototype,"s"),a(z.prototype,"v"),Object.defineProperty(z.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(z.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=C.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var X=function(){function e(t,n){P(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return k(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),H={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},G={};R.each(H,function(e,t){R.each(e,function(e){G[e]=t})});var Y=/(\d+(\.\d+)?)px/,q={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var i=n,o=t;R.isUndefined(o)&&(o=!0),R.isUndefined(i)&&(i=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),i&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,i){var o=n||{},a=G[t];if(!a)throw new Error("Event type "+t+" not supported.");var r=document.createEvent(a);switch(a){case"MouseEvents":var s=o.x||o.clientX||0,c=o.y||o.clientY||0;r.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,c,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=r.initKeyboardEvent||r.initKeyEvent;R.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:r.initEvent(t,o.bubbles||!1,o.cancelable||!0)}R.defaults(r,i),e.dispatchEvent(r)},bind:function(e,t,n,i){var o=i||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),q},unbind:function(e,t,n,i){var o=i||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),q},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return q},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),i=n.indexOf(t);-1!==i&&(n.splice(i,1),e.className=n.join(" "))}else e.className=void 0;return q},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return r(t["border-left-width"])+r(t["border-right-width"])+r(t["padding-left"])+r(t["padding-right"])+r(t.width)},getHeight:function(e){var t=getComputedStyle(e);return r(t["border-top-width"])+r(t["border-bottom-width"])+r(t["padding-top"])+r(t["padding-bottom"])+r(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},W=function(e){function t(e,n){P(this,t);var i=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=i;return i.__prev=i.getValue(),i.__checkbox=document.createElement("input"),i.__checkbox.setAttribute("type","checkbox"),q.bind(i.__checkbox,"change",function(){o.setValue(!o.__prev)},!1),i.domElement.appendChild(i.__checkbox),i.updateDisplay(),i}return V(t,X),k(t,[{key:"setValue",value:function(e){var n=N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),K=function(e){function t(e,n,i){P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i,r=o;if(o.__select=document.createElement("select"),R.isArray(a)){var s={};R.each(a,function(e){s[e]=e}),a=s}return R.each(a,function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),r.__select.appendChild(n)}),o.updateDisplay(),q.bind(o.__select,"change",function(){var e=this.options[this.selectedIndex].value;r.setValue(e)}),o.domElement.appendChild(o.__select),o}return V(t,X),k(t,[{key:"setValue",value:function(e){var n=N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return q.isActive(this.__select)?this:(this.__select.value=this.getValue(),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(),Q=function(e){function t(e,n){function i(){a.setValue(a.__input.value)}P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=o;return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),q.bind(o.__input,"keyup",i),q.bind(o.__input,"change",i),q.bind(o.__input,"blur",function(){a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}),q.bind(o.__input,"keydown",function(e){13===e.keyCode&&this.blur()}),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return V(t,X),k(t,[{key:"updateDisplay",value:function(){return q.isActive(this.__input)||(this.__input.value=this.getValue()),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),J=function(e){function t(e,n,i){P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=i||{};return o.__min=a.min,o.__max=a.max,o.__step=a.step,R.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=s(o.__impliedStep),o}return V(t,X),k(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=s(e),this}}]),t}(),Z=function(e){function t(e,n,i){function o(){c.__onFinishChange&&c.__onFinishChange.call(c,c.getValue())}function a(e){var t=l-e.clientY;c.setValue(c.getValue()+t*c.__impliedStep),l=e.clientY}function r(){q.unbind(window,"mousemove",a),q.unbind(window,"mouseup",r),o()}P(this,t);var s=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));s.__truncationSuspended=!1;var c=s,l=void 0;return s.__input=document.createElement("input"),s.__input.setAttribute("type","text"),q.bind(s.__input,"change",function(){var e=parseFloat(c.__input.value);R.isNaN(e)||c.setValue(e)}),q.bind(s.__input,"blur",function(){o()}),q.bind(s.__input,"mousedown",function(e){q.bind(window,"mousemove",a),q.bind(window,"mouseup",r),l=e.clientY}),q.bind(s.__input,"keydown",function(e){13===e.keyCode&&(c.__truncationSuspended=!0,this.blur(),c.__truncationSuspended=!1,o())}),s.updateDisplay(),s.domElement.appendChild(s.__input),s}return V(t,J),k(t,[{key:"updateDisplay",value:function(){return this.__input.value=this.__truncationSuspended?this.getValue():c(this.getValue(),this.__precision),N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),$=function(e){function t(e,n,i,o,a){function r(e){e.preventDefault();var t=h.__background.getBoundingClientRect();return h.setValue(l(e.clientX,t.left,t.right,h.__min,h.__max)),!1}function s(){q.unbind(window,"mousemove",r),q.unbind(window,"mouseup",s),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}function c(e){var t=e.touches[0].clientX,n=h.__background.getBoundingClientRect();h.setValue(l(t,n.left,n.right,h.__min,h.__max))}function u(){q.unbind(window,"touchmove",c),q.unbind(window,"touchend",u),h.__onFinishChange&&h.__onFinishChange.call(h,h.getValue())}P(this,t);var d=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:i,max:o,step:a})),h=d;return d.__background=document.createElement("div"),d.__foreground=document.createElement("div"),q.bind(d.__background,"mousedown",function(e){document.activeElement.blur(),q.bind(window,"mousemove",r),q.bind(window,"mouseup",s),r(e)}),q.bind(d.__background,"touchstart",function(e){1===e.touches.length&&(q.bind(window,"touchmove",c),q.bind(window,"touchend",u),c(e))}),q.addClass(d.__background,"slider"),q.addClass(d.__foreground,"slider-fg"),d.updateDisplay(),d.__background.appendChild(d.__foreground),d.domElement.appendChild(d.__background),d}return V(t,J),k(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",N(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(),ee=function(e){function t(e,n,i){P(this,t);var o=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),a=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===i?"Fire":i,q.bind(o.__button,"click",function(e){return e.preventDefault(),a.fire(),!1}),q.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return V(t,X),k(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(),te=function(e){function t(e,n){function i(e){l(e),q.bind(window,"mousemove",l),q.bind(window,"touchmove",l),q.bind(window,"mouseup",a),q.bind(window,"touchend",a)}function o(e){h(e),q.bind(window,"mousemove",h),q.bind(window,"touchmove",h),q.bind(window,"mouseup",r),q.bind(window,"touchend",r)}function a(){q.unbind(window,"mousemove",l),q.unbind(window,"touchmove",l),q.unbind(window,"mouseup",a),q.unbind(window,"touchend",a),c()}function r(){q.unbind(window,"mousemove",h),q.unbind(window,"touchmove",h),q.unbind(window,"mouseup",r),q.unbind(window,"touchend",r),c()}function s(){var e=F(this.value);!1!==e?(f.__color.__state=e,f.setValue(f.__color.toOriginal())):this.value=f.__color.toString()}function c(){f.__onFinishChange&&f.__onFinishChange.call(f,f.__color.toOriginal())}function l(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=f.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,i=n.clientX,o=n.clientY,a=(i-t.left)/(t.right-t.left),r=1-(o-t.top)/(t.bottom-t.top);return r>1?r=1:r<0&&(r=0),a>1?a=1:a<0&&(a=0),f.__color.v=r,f.__color.s=a,f.setValue(f.__color.toOriginal()),!1}function h(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=f.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),f.__color.h=360*n,f.setValue(f.__color.toOriginal()),!1}P(this,t);var m=j(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));m.__color=new z(m.getValue()),m.__temp=new z(0);var f=m;m.domElement=document.createElement("div"),q.makeSelectable(m.domElement,!1),m.__selector=document.createElement("div"),m.__selector.className="selector",m.__saturation_field=document.createElement("div"),m.__saturation_field.className="saturation-field",m.__field_knob=document.createElement("div"),m.__field_knob.className="field-knob",m.__field_knob_border="2px solid ",m.__hue_knob=document.createElement("div"),m.__hue_knob.className="hue-knob",m.__hue_field=document.createElement("div"),m.__hue_field.className="hue-field",m.__input=document.createElement("input"),m.__input.type="text",m.__input_textShadow="0 1px 1px ",q.bind(m.__input,"keydown",function(e){13===e.keyCode&&s.call(this)}),q.bind(m.__input,"blur",s),q.bind(m.__selector,"mousedown",function(){q.addClass(this,"drag").bind(window,"mouseup",function(){q.removeClass(f.__selector,"drag")})}),q.bind(m.__selector,"touchstart",function(){q.addClass(this,"drag").bind(window,"touchend",function(){q.removeClass(f.__selector,"drag")})});var p=document.createElement("div");return R.extend(m.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),R.extend(m.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:m.__field_knob_border+(m.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),R.extend(m.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),R.extend(m.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),R.extend(p.style,{width:"100%",height:"100%",background:"none"}),u(p,"top","rgba(0,0,0,0)","#000"),R.extend(m.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),d(m.__hue_field),R.extend(m.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:m.__input_textShadow+"rgba(0,0,0,0.7)"}),q.bind(m.__saturation_field,"mousedown",i),q.bind(m.__saturation_field,"touchstart",i),q.bind(m.__field_knob,"mousedown",i),q.bind(m.__field_knob,"touchstart",i),q.bind(m.__hue_field,"mousedown",o),q.bind(m.__hue_field,"touchstart",o),m.__saturation_field.appendChild(p),m.__selector.appendChild(m.__field_knob),m.__selector.appendChild(m.__saturation_field),m.__selector.appendChild(m.__hue_field),m.__hue_field.appendChild(m.__hue_knob),m.domElement.appendChild(m.__input),m.domElement.appendChild(m.__selector),m.updateDisplay(),m}return V(t,X),k(t,[{key:"updateDisplay",value:function(){var e=F(this.getValue());if(!1!==e){var t=!1;R.each(z.COMPONENTS,function(n){if(!R.isUndefined(e[n])&&!R.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}},this),t&&R.extend(this.__color.__state,e)}R.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,i=255-n;R.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,u(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),R.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+i+","+i+","+i+",.7)"})}}]),t}(),ne=["-moz-","-o-","-webkit-","-ms-",""],ie={load:function(e,t){var n=t||document,i=n.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=e,n.getElementsByTagName("head")[0].appendChild(i)},inject:function(e,t){var n=t||document,i=document.createElement("style");i.type="text/css",i.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(i)}catch(e){}}},oe=function(e,t){var n=e[t];return R.isArray(arguments[2])||R.isObject(arguments[2])?new K(e,t,arguments[2]):R.isNumber(n)?R.isNumber(arguments[2])&&R.isNumber(arguments[3])?R.isNumber(arguments[4])?new $(e,t,arguments[2],arguments[3],arguments[4]):new $(e,t,arguments[2],arguments[3]):R.isNumber(arguments[4])?new Z(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Z(e,t,{min:arguments[2],max:arguments[3]}):R.isString(n)?new Q(e,t):R.isFunction(n)?new ee(e,t,""):R.isBoolean(n)?new W(e,t):null},ae=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},re=function(){function e(){P(this,e),this.backgroundElement=document.createElement("div"),R.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),q.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),R.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;q.bind(this.backgroundElement,"click",function(){t.hide()})}return k(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),R.defer(function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"})}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",q.unbind(e.domElement,"webkitTransitionEnd",t),q.unbind(e.domElement,"transitionend",t),q.unbind(e.domElement,"oTransitionEnd",t)};q.bind(this.domElement,"webkitTransitionEnd",t),q.bind(this.domElement,"transitionend",t),q.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-q.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-q.getHeight(this.domElement)/2+"px"}}]),e}(),se=function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid transparent}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");ie.inject(se);var ce="Default",le=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}(),ue=void 0,de=!0,he=void 0,me=!1,fe=[],pe=function e(t){var n=this,i=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),q.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],i=R.defaults(i,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),i=R.defaults(i,{resizable:i.autoPlace,hideable:i.autoPlace}),R.isUndefined(i.load)?i.load={preset:ce}:i.preset&&(i.load.preset=i.preset),R.isUndefined(i.parent)&&i.hideable&&fe.push(this),i.resizable=R.isUndefined(i.parent)&&i.resizable,i.autoPlace&&R.isUndefined(i.scrollable)&&(i.scrollable=!0);var o=le&&"true"===localStorage.getItem(b(this,"isLocal")),a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return i.parent}},scrollable:{get:function(){return i.scrollable}},autoPlace:{get:function(){return i.autoPlace}},closeOnTop:{get:function(){return i.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:i.load.preset},set:function(e){n.parent?n.getRoot().preset=e:i.load.preset=e,T(this),n.revert()}},width:{get:function(){return i.width},set:function(e){i.width=e,E(n,e)}},name:{get:function(){return i.name},set:function(e){i.name=e,titleRowName&&(titleRowName.innerHTML=i.name)}},closed:{get:function(){return i.closed},set:function(t){i.closed=t,i.closed?q.addClass(n.__ul,e.CLASS_CLOSED):q.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return i.load}},useLocalStorage:{get:function(){return o},set:function(e){le&&(o=e,e?q.bind(window,"unload",a):q.unbind(window,"unload",a),localStorage.setItem(b(n,"isLocal"),e))}}}),R.isUndefined(i.parent)){if(i.closed=!1,q.addClass(this.domElement,e.CLASS_MAIN),q.makeSelectable(this.domElement,!1),le&&o){n.useLocalStorage=!0;var r=localStorage.getItem(b(this,"gui"));r&&(i.load=JSON.parse(r))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,q.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),i.closeOnTop?(q.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(q.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),q.bind(this.__closeButton,"click",function(){n.closed=!n.closed})}else{void 0===i.closed&&(i.closed=!0);var s=document.createTextNode(i.name);q.addClass(s,"controller-name");var c=h(n,s),l=function(e){return e.preventDefault(),n.closed=!n.closed,!1};q.addClass(this.__ul,e.CLASS_CLOSED),q.addClass(c,"title"),q.bind(c,"click",l),i.closed||(this.closed=!1)}i.autoPlace&&(R.isUndefined(i.parent)&&(de&&(he=document.createElement("div"),q.addClass(he,"dg"),q.addClass(he,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(he),de=!1),he.appendChild(this.domElement),q.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||E(n,i.width)),this.__resizeHandler=function(){n.onResizeDebounced()},q.bind(window,"resize",this.__resizeHandler),q.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),q.bind(this.__ul,"transitionend",this.__resizeHandler),q.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),i.resizable&&y(this),a=function(){le&&"true"===localStorage.getItem(b(n,"isLocal"))&&localStorage.setItem(b(n,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,i.parent||function(){var e=n.getRoot();e.width+=1,R.defer(function(){e.width-=1})}()};pe.toggleHide=function(){me=!me,R.each(fe,function(e){e.domElement.style.display=me?"none":""})},pe.CLASS_AUTO_PLACE="a",pe.CLASS_AUTO_PLACE_CONTAINER="ac",pe.CLASS_MAIN="main",pe.CLASS_CONTROLLER_ROW="cr",pe.CLASS_TOO_TALL="taller-than-window",pe.CLASS_CLOSED="closed",pe.CLASS_CLOSE_BUTTON="close-button",pe.CLASS_CLOSE_TOP="close-top",pe.CLASS_CLOSE_BOTTOM="close-bottom",pe.CLASS_DRAG="drag",pe.DEFAULT_WIDTH=245,pe.TEXT_CLOSED="Close Controls",pe.TEXT_OPEN="Open Controls",pe._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||pe.toggleHide()},q.bind(window,"keydown",pe._keydownHandler,!1),R.extend(pe.prototype,{add:function(e,t){return _(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return _(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;R.defer(function(){t.onResize()})},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&he.removeChild(this.domElement);var e=this;R.each(this.__folders,function(t){e.removeFolder(t)}),q.unbind(window,"keydown",pe._keydownHandler,!1),m(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new pe(t);this.__folders[e]=n;var i=h(this,n.domElement);return q.addClass(i,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],m(e);var t=this;R.each(e.__folders,function(t){e.removeFolder(t)}),R.defer(function(){t.onResize()})},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=q.getOffset(e.__ul).top,n=0;R.each(e.__ul.childNodes,function(t){e.autoPlace&&t===e.__save_row||(n+=q.getHeight(t))}),window.innerHeight-t-20<n?(q.addClass(e.domElement,pe.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(q.removeClass(e.domElement,pe.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&R.defer(function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"}),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:R.debounce(function(){this.onResize()},50),remember:function(){if(R.isUndefined(ue)&&((ue=new re).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;R.each(Array.prototype.slice.call(arguments),function(t){0===e.__rememberedObjects.length&&M(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)}),this.autoPlace&&E(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=w(this)),e.folders={},R.each(this.__folders,function(t,n){e.folders[n]=t.getSaveObject()}),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=w(this),f(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered[ce]=w(this,!0)),this.load.remembered[e]=w(this),this.preset=e,g(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){R.each(this.__controllers,function(t){this.getRoot().load.remembered?v(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())},this),R.each(this.__folders,function(e){e.revert(e)}),e||f(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&S(this.__listening)},updateDisplay:function(){R.each(this.__controllers,function(e){e.updateDisplay()}),R.each(this.__folders,function(e){e.updateDisplay()})}});var ve={color:{Color:z,math:C,interpret:F},controllers:{Controller:X,BooleanController:W,OptionController:K,StringController:Q,NumberController:J,NumberControllerBox:Z,NumberControllerSlider:$,FunctionController:ee,ColorController:te},dom:{dom:q},gui:{GUI:pe},GUI:pe};t.default=ve},function(e,t,n){"use strict";var i=n(0);class o{constructor(e){const t=Object(i.b)();this.location=++o.location,this.data=new Float32Array(e),this.buffer=t.createBuffer(),t.bindBuffer(t.UNIFORM_BUFFER,this.buffer),t.bufferData(t.UNIFORM_BUFFER,this.data,t.STATIC_DRAW),t.bindBuffer(t.UNIFORM_BUFFER,null)}bind(){const e=Object(i.b)();e.bindBufferBase(e.UNIFORM_BUFFER,this.location,this.buffer)}update(e,t=0){const n=Object(i.b)();this.data.set(e,t),n.bindBuffer(n.UNIFORM_BUFFER,this.buffer),n.bufferSubData(n.UNIFORM_BUFFER,0,this.data,0,null),n.bindBuffer(n.UNIFORM_BUFFER,null)}}o.location=0,t.a=o},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));n(3);class a{constructor(){`#version 300 es\n            precision mediump int;\n            precision mediump float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n    \n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n            \n            out vec3 vPosViewSpace;\n            out vec2 vUv;\n            out vec3 worldPosVertex;\n\n            out vec3 vNormalViewSpace;\n            out vec3 vTangentViewSpace;\n            out vec3 vBitangentViewSpace;\n\n            out mat3 TBN;\n\n            void main() {\n                mat4 modelViewMatrix = viewMatrix * modelMatrix;\n                                \n                vNormalViewSpace = vec3(mat3(modelViewMatrix) * normalize(normal));\n                vTangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(tangent));\n                vBitangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(bitangent));\n            \n                // Transpose is ok since we don't do non-uniform scaling\n                TBN = transpose(mat3(\n                    vTangentViewSpace,\n                    vBitangentViewSpace,\n                    vNormalViewSpace\n                ));\n                worldPosVertex = vec3(modelViewMatrix  * vec4(position, 1.0));\n                vPosViewSpace = vec3(modelViewMatrix * vec4(position, 1.0));\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es\n            precision mediump float;\n            precision mediump int;\n\n            const int MAX_DIRECTIONAL_LIGHTS = 8;\n            const int MAX_POINT_LIGHTS = 8;\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix; // 64 0\n                mat4 projectionMatrix; // 64 64\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            struct PointLight {\n                vec3 position;\n                vec4 color;\n                float intensity;\n            };\n\n            struct DirectionalLight {\n                vec3 directionViewSpace;\n                vec4 color;\n                float intensity;\n            };\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 - base | aligned offset\n                vec4 mdiffuse; // 16 16\n                //vec4 memissive;\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 52\n                bool hasNormalMap; // 4 56\n                bool hasSpecularMap; // 4 60\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform pointLightsBuffer {\n                PointLight pointLights[MAX_POINT_LIGHTS];\n            };\n\n            layout (std140) uniform directionalLightsBuffer {\n                DirectionalLight directionalLights[MAX_DIRECTIONAL_LIGHTS];\n            };\n\n            layout (std140) uniform guiDataBuffer {\n                float texLod;\n                float bumpIntensity;\n                bool displayNormalMap;\n                bool displaySpecularMap;\n            };\n\n            // Textures\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n\n            in vec3 vPosViewSpace;\n            in vec3 vNormalViewSpace;\n\n            in vec3 worldPosVertex;\n\n            in vec3 vTangentViewSpace;\n            in vec3 vBitangentViewSpace;\n\n            in mat3 TBN;\n            in vec2 vUv;\n\n            // TODO: light uniforms\n            vec3 Ia = vec3(0.2);\n            vec3 Id = vec3(1.0);\n            vec3 Is = vec3(1.0);\n\n            out vec4 outColor;\n\n            void light(int lightIndex, vec3 vPos, vec3 norm, out vec3 ambient, out vec3 diffuse, out vec3 spec, bool directional) {\n\n                // View space\n                vec3 n = norm;\n                vec3 l;\n\n                if (directional) {\n                    l = directionalLights[lightIndex].directionViewSpace;\n                } else {\n                    l = vec3(viewMatrix * vec4(pointLights[lightIndex].position, 1.0)) - vPos; // Light dir\n                }\n\n                vec3 v = -vPos;\n\n                if (hasNormalMap) {\n                    // Convert from view to tangent space\n                    l = normalize(TBN * l);\n                    v = normalize(TBN * v);\n\n                    vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                    bn.x *= bumpIntensity;\n                    bn.y *= bumpIntensity;\n                    n = normalize(bn);\n                } else {\n                    l = normalize(l);\n                    v = normalize(v);\n                    n = normalize(n);\n                }   \n\n                ambient = Ia * mambient.xyz;\n\n                diffuse = vec3(0);\n                spec  = vec3(0);\n                float intensity = max(dot(n, l), 0.0);\n                if (intensity > 0.0) {\n                    diffuse = Id * mdiffuse.xyz * intensity;\n\n                    //vec3 r = reflect(-l, n); // phong\n                    vec3 h = normalize(l + v); // blinn phong\n                    \n                    float intSpec = max(dot(h, n), 0.0);\n                    spec = Is * vec3(1.0, 1.0, 1.0) * pow(intSpec, specularExponent);\n                    //spec = Is * vec3(1.0, 1.0, 1.0) * pow(max(dot(r,v), 0.0), specularExponent);\n                }\n            } \n        \n            void main() {\n                vec3 ambientSum = vec3(0);\n                vec3 diffuseSum = vec3(0);\n                vec3 specSum = vec3(0);\n                vec3 ambient, diffuse, spec;\n\n                for (int i = 0; i < int(numLights); ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/false);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n                \n                for (int i = 0; i < int(numDirectionalLights); ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/true);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n\n                ambientSum /= float(numLights);\n        \n                if (displayNormalMap && hasNormalMap) {\n                    vec4 bumpColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                    outColor = bumpColor;\n                } else if (displaySpecularMap && hasSpecularMap) {\n                    outColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                }  else if (hasDiffuseMap) {\n                    vec4 specularMapColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                    vec4 texColor = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                    outColor = 2.0 * vec4(diffuseSum, 1.0) * texColor;//  + vec4(specSum, 1.0) * specularMapColor * float(hasSpecularMap);\n                } else {\n                    // No texture\n                    outColor = vec4(0.0, 0.0, 0.0, 1.0);\n                    //outColor = vec4(diffuseSum, 1.0) + vec4(specSum, 1.0);\n                }\n\n                // Dissolve map\n                // TODO: Greyscale, this is a waste of memory\n                if (hasDissolveMap) {\n                    vec4 alphaVal = texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y));\n                    \n                    if (alphaVal.x < 0.001) {\n                        discard;\n                    }\n                }\n                //outColor = vec4(worldPosVertex, 1.0);\n            }\n        `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision mediump int;\n            precision mediump float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n    \n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n            \n            out vec3 vPosViewSpace;\n            out vec2 vUv;\n            out vec3 worldPosVertex;\n\n            out vec3 vNormalViewSpace;\n            out vec3 vTangentViewSpace;\n            out vec3 vBitangentViewSpace;\n\n            out mat3 TBN;\n\n            void main() {\n                mat4 modelViewMatrix = viewMatrix * modelMatrix;\n                                \n                vNormalViewSpace = vec3(mat3(modelViewMatrix) * normalize(normal));\n                vTangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(tangent));\n                vBitangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(bitangent));\n            \n                // Transpose is ok since we don't do non-uniform scaling\n                TBN = transpose(mat3(\n                    vTangentViewSpace,\n                    vBitangentViewSpace,\n                    vNormalViewSpace\n                ));\n                worldPosVertex = vec3(modelViewMatrix  * vec4(position, 1.0));\n                vPosViewSpace = vec3(modelViewMatrix * vec4(position, 1.0));\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es\n            precision mediump float;\n            precision mediump int;\n\n            const int MAX_DIRECTIONAL_LIGHTS = 8;\n            const int MAX_POINT_LIGHTS = 8;\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix; // 64 0\n                mat4 projectionMatrix; // 64 64\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            struct PointLight {\n                vec3 position;\n                vec4 color;\n                float intensity;\n            };\n\n            struct DirectionalLight {\n                vec3 directionViewSpace;\n                vec4 color;\n                float intensity;\n            };\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 - base | aligned offset\n                vec4 mdiffuse; // 16 16\n                //vec4 memissive;\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 52\n                bool hasNormalMap; // 4 56\n                bool hasSpecularMap; // 4 60\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform pointLightsBuffer {\n                PointLight pointLights[MAX_POINT_LIGHTS];\n            };\n\n            layout (std140) uniform directionalLightsBuffer {\n                DirectionalLight directionalLights[MAX_DIRECTIONAL_LIGHTS];\n            };\n\n            layout (std140) uniform guiDataBuffer {\n                float texLod;\n                float bumpIntensity;\n                bool displayNormalMap;\n                bool displaySpecularMap;\n            };\n\n            // Textures\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n\n            in vec3 vPosViewSpace;\n            in vec3 vNormalViewSpace;\n\n            in vec3 worldPosVertex;\n\n            in vec3 vTangentViewSpace;\n            in vec3 vBitangentViewSpace;\n\n            in mat3 TBN;\n            in vec2 vUv;\n\n            // TODO: light uniforms\n            vec3 Ia = vec3(0.2);\n            vec3 Id = vec3(1.0);\n            vec3 Is = vec3(1.0);\n\n            out vec4 outColor;\n\n            void light(int lightIndex, vec3 vPos, vec3 norm, out vec3 ambient, out vec3 diffuse, out vec3 spec, bool directional) {\n\n                // View space\n                vec3 n = norm;\n                vec3 l;\n\n                if (directional) {\n                    l = directionalLights[lightIndex].directionViewSpace;\n                } else {\n                    l = vec3(viewMatrix * vec4(pointLights[lightIndex].position, 1.0)) - vPos; // Light dir\n                }\n\n                vec3 v = -vPos;\n\n                if (hasNormalMap) {\n                    // Convert from view to tangent space\n                    l = normalize(TBN * l);\n                    v = normalize(TBN * v);\n\n                    vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                    bn.x *= bumpIntensity;\n                    bn.y *= bumpIntensity;\n                    n = normalize(bn);\n                } else {\n                    l = normalize(l);\n                    v = normalize(v);\n                    n = normalize(n);\n                }   \n\n                ambient = Ia * mambient.xyz;\n\n                diffuse = vec3(0);\n                spec  = vec3(0);\n                float intensity = max(dot(n, l), 0.0);\n                if (intensity > 0.0) {\n                    diffuse = Id * mdiffuse.xyz * intensity;\n\n                    //vec3 r = reflect(-l, n); // phong\n                    vec3 h = normalize(l + v); // blinn phong\n                    \n                    float intSpec = max(dot(h, n), 0.0);\n                    spec = Is * vec3(1.0, 1.0, 1.0) * pow(intSpec, specularExponent);\n                    //spec = Is * vec3(1.0, 1.0, 1.0) * pow(max(dot(r,v), 0.0), specularExponent);\n                }\n            } \n        \n            void main() {\n                vec3 ambientSum = vec3(0);\n                vec3 diffuseSum = vec3(0);\n                vec3 specSum = vec3(0);\n                vec3 ambient, diffuse, spec;\n\n                for (int i = 0; i < int(numLights); ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/false);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n                \n                for (int i = 0; i < int(numDirectionalLights); ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/true);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n\n                ambientSum /= float(numLights);\n        \n                if (displayNormalMap && hasNormalMap) {\n                    vec4 bumpColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                    outColor = bumpColor;\n                } else if (displaySpecularMap && hasSpecularMap) {\n                    outColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                }  else if (hasDiffuseMap) {\n                    vec4 specularMapColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                    vec4 texColor = texture(textureMap, vec2(vUv.x, 1.0 - vUv.y));\n                    outColor = 2.0 * vec4(diffuseSum, 1.0) * texColor;//  + vec4(specSum, 1.0) * specularMapColor * float(hasSpecularMap);\n                } else {\n                    // No texture\n                    outColor = vec4(0.0, 0.0, 0.0, 1.0);\n                    //outColor = vec4(diffuseSum, 1.0) + vec4(specSum, 1.0);\n                }\n\n                // Dissolve map\n                // TODO: Greyscale, this is a waste of memory\n                if (hasDissolveMap) {\n                    vec4 alphaVal = texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y));\n                    \n                    if (alphaVal.x < 0.001) {\n                        discard;\n                    }\n                }\n                //outColor = vec4(worldPosVertex, 1.0);\n            }\n        ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));class a{constructor(){`#version 300 es\n            precision highp float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            uniform mat4 depthView;\n            uniform mat4 depthProj;\n\n            void main() {\n                gl_Position = depthProj * depthView * modelMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es \n            precision highp float;\n        \n            layout(location = 0) out float outColor;\n            \n            void main() {\n                // Not really needed, OpenGL does it anyway\n                outColor = gl_FragCoord.z;\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n\n            uniform mat4 depthView;\n            uniform mat4 depthProj;\n\n            void main() {\n                gl_Position = depthProj * depthView * modelMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es \n            precision highp float;\n        \n            layout(location = 0) out float outColor;\n            \n            void main() {\n                // Not really needed, OpenGL does it anyway\n                outColor = gl_FragCoord.z;\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";var i=n(33),o=n(34),a=n(35),r=n(17),s=n(18),c=n(7),l=n(19),u=n(8),d=n(20),h=n(0),m=n(1);class f{constructor(e,t,n,c,m,f,p){const v=Object(h.b)();this.sceneScale=e,this.voxelTextureSize=n;const _=new l.a(t,t,t);this.cubeMesh=new u.a(_.geometry,_.indices),this.screenSpaceImageShader=new r.a,this.voxelDebugShader=new o.a,this.voxelizationShader=new i.a,this.worldPositionShader=new a.a,this.materialUBO=c,this.pointLightUBO=m,this.modelMatricesUBO=f,this.sceneUBO=p,this.quad=new d.a,this.backFBO=new s.a(v.canvas.width,v.canvas.height),this.xTexture=v.createTexture(),v.bindTexture(v.TEXTURE_2D_ARRAY,this.xTexture),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_MIN_FILTER,v.LINEAR_MIPMAP_LINEAR),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_R,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texImage3D(v.TEXTURE_2D_ARRAY,0,v.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,v.RGBA,v.UNSIGNED_BYTE,null),this.zTexture=v.createTexture(),v.bindTexture(v.TEXTURE_2D_ARRAY,this.zTexture),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_MIN_FILTER,v.LINEAR_MIPMAP_LINEAR),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_R,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texImage3D(v.TEXTURE_2D_ARRAY,0,v.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,v.RGBA,v.UNSIGNED_BYTE,null),this.yTexture=v.createTexture(),v.bindTexture(v.TEXTURE_2D_ARRAY,this.yTexture),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_MIN_FILTER,v.LINEAR_MIPMAP_LINEAR),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_R,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_2D_ARRAY,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texImage3D(v.TEXTURE_2D_ARRAY,0,v.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,v.RGBA,v.UNSIGNED_BYTE,null),this.voxelTexture=v.createTexture(),v.bindTexture(v.TEXTURE_3D,this.voxelTexture),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_MIN_FILTER,v.LINEAR_MIPMAP_LINEAR),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_WRAP_R,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_WRAP_S,v.CLAMP_TO_EDGE),v.texParameteri(v.TEXTURE_3D,v.TEXTURE_WRAP_T,v.CLAMP_TO_EDGE),v.texImage3D(v.TEXTURE_3D,0,v.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,v.RGBA,v.UNSIGNED_BYTE,null),this.voxelFb=v.createFramebuffer()}renderVoxelDebug(e,t){const n=Object(h.b)();this.worldPositionShader.activate();const i=this.worldPositionShader.program;n.disable(n.CULL_FACE),n.enable(n.DEPTH_TEST),n.cullFace(n.FRONT),n.viewport(0,0,n.canvas.width,n.canvas.height),this.backFBO.bind(),n.uniformBlockBinding(i,n.getUniformBlockIndex(i,"sceneBuffer"),this.sceneUBO.location),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),this.cubeMesh.draw(),n.bindFramebuffer(n.FRAMEBUFFER,null),this.voxelDebugShader.activate(),n.uniform1f(n.getUniformLocation(this.voxelDebugShader.program,"mipmapLevel"),e.gui.voxelMipmap),n.uniform1f(n.getUniformLocation(this.voxelDebugShader.program,"stepLength"),e.gui.voxelDebugStepSize),n.uniform1f(n.getUniformLocation(this.voxelDebugShader.program,"sceneScale"),this.sceneScale),n.uniform3fv(n.getUniformLocation(this.voxelDebugShader.program,"cameraPosition"),t.position),n.activeTexture(n.TEXTURE0+0),n.bindTexture(n.TEXTURE_3D,this.voxelTexture),n.uniform1i(n.getUniformLocation(this.voxelDebugShader.program,"texture3D"),0),this.backFBO.transitionToShaderResource(this.voxelDebugShader.program),this.quad.draw(),this.screenSpaceImageShader.activate(),this.backFBO.transitionToShaderResource(this.screenSpaceImageShader.program),n.viewport(0,0,150,150),this.quad.draw(),n.viewport(0,0,n.canvas.width,n.canvas.height)}voxelize(e,t){var n=performance.now();const i=Object(h.b)();i.viewport(0,0,this.voxelTextureSize,this.voxelTextureSize),i.disable(i.CULL_FACE),i.enable(i.DEPTH_TEST),i.bindFramebuffer(i.FRAMEBUFFER,this.voxelFb),i.clearColor(0,0,0,0),this.voxelizationShader.activate();const o=this.voxelizationShader.program;i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"pointLightsBuffer"),this.pointLightUBO.location),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"sceneBuffer"),this.sceneUBO.location),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE);const a=this.sceneScale;i.bindTexture(i.TEXTURE_2D_ARRAY,this.yTexture);for(let n=0;n<this.voxelTextureSize;n++){const r=new c.a(-a,a,-a,a,a-n/this.voxelTextureSize*a*2,a-(n+1)/this.voxelTextureSize*a*2);r.up=m.c.fromValues(0,0,1),r.lookAt(m.c.fromValues(0,-1,0)),i.framebufferTextureLayer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,this.yTexture,0,n),i.checkFramebufferStatus(i.FRAMEBUFFER)!=i.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+s.a.checkFrameBufferStatus(i.checkFramebufferStatus(i.FRAMEBUFFER)));const l=m.a.create();m.a.multiply(l,r.projectionMatrix,r.viewMatrix),i.uniformMatrix4fv(i.getUniformLocation(o,"viewProjection"),!1,l),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"sceneBuffer"),this.sceneUBO.location),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"pointLightsBuffer"),this.pointLightUBO.location),e.objects.forEach(n=>{this._renderObject(n,e,t,o)})}i.bindTexture(i.TEXTURE_2D_ARRAY,this.zTexture);for(let n=0;n<this.voxelTextureSize;n++){const r=new c.a(-a,a,-a,a,a-n/this.voxelTextureSize*a*2,a-(n+1)/this.voxelTextureSize*a*2);r.lookAt(m.c.fromValues(0,0,-1)),i.framebufferTextureLayer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,this.zTexture,0,n),i.checkFramebufferStatus(i.FRAMEBUFFER)!=i.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+s.a.checkFrameBufferStatus(i.checkFramebufferStatus(i.FRAMEBUFFER)));const l=m.a.create();m.a.multiply(l,r.projectionMatrix,r.viewMatrix),i.uniformMatrix4fv(i.getUniformLocation(o,"viewProjection"),!1,l),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"sceneBuffer"),this.sceneUBO.location),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"pointLightsBuffer"),this.pointLightUBO.location),e.objects.forEach(n=>{this._renderObject(n,e,t,o)})}i.bindTexture(i.TEXTURE_2D_ARRAY,this.xTexture);for(let n=0;n<this.voxelTextureSize;n++){const r=new c.a(-a,a,-a,a,a-n/this.voxelTextureSize*a*2,a-(n+1)/this.voxelTextureSize*a*2);r.up=m.c.fromValues(0,1,0),r.lookAt(m.c.fromValues(1,0,0)),i.framebufferTextureLayer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,this.xTexture,0,n),i.checkFramebufferStatus(i.FRAMEBUFFER)!=i.FRAMEBUFFER_COMPLETE&&console.error("FBO is not complete"+s.a.checkFrameBufferStatus(i.checkFramebufferStatus(i.FRAMEBUFFER)));const l=m.a.create();m.a.multiply(l,r.projectionMatrix,r.viewMatrix),i.uniformMatrix4fv(i.getUniformLocation(o,"viewProjection"),!1,l),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"sceneBuffer"),this.sceneUBO.location),i.uniformBlockBinding(o,i.getUniformBlockIndex(o,"pointLightsBuffer"),this.pointLightUBO.location),e.objects.forEach(n=>{this._renderObject(n,e,t,o)})}let r=performance.now();console.log("Voxel rendering took "+(r-n)+" milliseconds.");const l=this.voxelTextureSize;let u=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*this.voxelTextureSize*4);for(let e=0;e<this.voxelTextureSize;e++){let t=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*4);i.framebufferTextureLayer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,this.xTexture,0,e),i.readPixels(0,0,this.voxelTextureSize,this.voxelTextureSize,i.RGBA,i.UNSIGNED_BYTE,t,0);let n=0,o=0;for(let i=0;i<l*l;i++){i>0&&i%l==0&&o++;u[4*(l-1+0+i*l*l-e-(l*l*l*o-l*o))+0]=t[n++],u[4*(l-1+0+i*l*l-e-(l*l*l*o-l*o))+1]=t[n++],u[4*(l-1+0+i*l*l-e-(l*l*l*o-l*o))+2]=t[n++],u[4*(l-1+0+i*l*l-e-(l*l*l*o-l*o))+3]=t[n++]}}for(let e=0;e<this.voxelTextureSize;e++){let t=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*4);i.framebufferTextureLayer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,this.yTexture,0,e),i.readPixels(0,0,this.voxelTextureSize,this.voxelTextureSize,i.RGBA,i.UNSIGNED_BYTE,t,0);let n=0,o=0,a=0;for(let i=0;i<l*l;i++)i>0&&i%l==0&&(o=0,a++),t[n+0]>0&&(u[4*(e*l+l*l*a+l-o-1)+0]=t[n+0]),t[n+1]>0&&(u[4*(e*l+l*l*a+l-o-1)+1]=t[n+1]),t[n+2]>0&&(u[4*(e*l+l*l*a+l-o-1)+2]=t[n+2]),t[n+3]>0&&(u[4*(e*l+l*l*a+l-o-1)+3]=t[n+3]),n+=4,o++}for(let e=0;e<this.voxelTextureSize;e++){let t=new Uint8Array(this.voxelTextureSize*this.voxelTextureSize*4);i.framebufferTextureLayer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,this.zTexture,0,e),i.readPixels(0,0,this.voxelTextureSize,this.voxelTextureSize,i.RGBA,i.UNSIGNED_BYTE,t,0);for(let n=0;n<this.voxelTextureSize*this.voxelTextureSize*4;n++)t[n]>0&&(u[this.voxelTextureSize*this.voxelTextureSize*e*4+n]=t[n])}i.bindTexture(i.TEXTURE_3D,this.voxelTexture),i.texImage3D(i.TEXTURE_3D,0,i.RGBA8,this.voxelTextureSize,this.voxelTextureSize,this.voxelTextureSize,0,i.RGBA,i.UNSIGNED_BYTE,u),i.generateMipmap(i.TEXTURE_3D),i.disable(i.BLEND),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.viewport(0,0,i.canvas.width,i.canvas.height),r=performance.now(),console.log("Voxelization took "+(r-n)+" milliseconds.")}_renderObject(e,t,n,i){this.modelMatricesUBO.update([...e.modelMatrix,...e.normalMatrix]);const o=e.materialData;this.materialUBO.update([...[...o.ambient,0],...[...o.diffuse,0],...[...o.specular,0],o.specularExponent,Boolean(o.mapDiffuse),Boolean(o.mapBump),Boolean(o.mapSpecular),Boolean(o.mapDissolve)]);const a=Object(h.b)();a.uniformBlockBinding(i,a.getUniformBlockIndex(i,"materialBuffer"),this.materialUBO.location),a.uniformBlockBinding(i,a.getUniformBlockIndex(i,"modelMatrices"),this.modelMatricesUBO.location),e.uploadTextures(i),e.draw()}}t.a=f},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));n(3);class a{constructor(){`#version 300 es\n\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n           \n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            out vec2 vUv;\n            out vec3 vNormalWorld;\n            out vec3 vPositionWorld;\n\n            uniform mat4 viewProjection;\n\n            void main() {\n                vUv = uv;\n                vPositionWorld = vec3(modelMatrix * vec4(position, 1.0));\n                vNormalWorld = vec3(normalMatrix * vec4(normal, 1.0));\n                gl_Position = viewProjection * modelMatrix *  vec4(position, 1); \n            }\n        `,`#version 300 es            \n        precision highp float;\n        precision highp int;\n\n        in vec2 vUv;\n        in vec3 vNormalWorld;\n        in vec3 vPositionWorld;\n\n        const int MAX_POINT_LIGHTS = 8;\n\n        uniform int renderTargetLayer;\n\n        layout (std140) uniform sceneBuffer {\n            mat4 viewMatrix;\n            mat4 projectionMatrix;\n            float numLights;\n            float numDirectionalLights;\n        };\n\n        layout (std140) uniform materialBuffer {\n            vec4 mambient; // 16 0 - base | aligned offset\n            vec4 mdiffuse; // 16 16\n            //vec4 memissive;\n            vec4 mspecular; // 16 32\n            float specularExponent; // 4 48\n            bool hasDiffuseMap; // 4 52\n            bool hasNormalMap; // 4 56\n            bool hasSpecularMap; // 4 60\n            bool hasDissolveMap; // 4 64\n        };\n\n        uniform sampler2D textureMap;\n        uniform sampler2D bumpMap;\n        uniform sampler2D specularMap;\n        uniform sampler2D dissolveMap;\n\n        struct PointLight {\n            vec3 position;\n            vec4 color;\n            float intensity;\n        };\n\n        layout (std140) uniform pointLightsBuffer {\n            PointLight pointLights[MAX_POINT_LIGHTS];\n        };\n\n        uniform bool xAxis;\n\n        // Lighting attenuation factors.\n        #define DIST_FACTOR 1.1 /* Distance is multiplied by this when calculating attenuation. */\n        #define CONSTANT 1.0\n        #define LINEAR 0.0\n        #define QUADRATIC 1.0\n\n        layout(location = 0) out vec4 layer0;\n   \n        // Returns an attenuation factor given a distance.\n        float attenuate(float dist) { \n            dist *= DIST_FACTOR; \n            return 1.0 / (CONSTANT);// + LINEAR * dist;// + QUADRATIC * dist * dist); \n        }\n        \n        vec3 calculatePointLight(PointLight light){\n            vec3 vertexPosition;\n            vertexPosition = vPositionWorld;\n\n            vec3 direction = normalize( light.position - vertexPosition );\n            float distanceToLight = distance(light.position, vertexPosition);\n            float attenuation = attenuate(distanceToLight);\n            float d = max(dot(normalize(vNormalWorld), direction), 0.0);\n            return d *attenuation * 0.15 * vec3(1.0); // intensity, light color missing\n        }\n\n        void main() {\n            vec3 color = vec3(0.0f);\n            for(int i = 0; i < int(numLights); ++i) {\n                color += calculatePointLight(pointLights[i]);\n            }\n\n            if (hasDiffuseMap) {\n                layer0 = vec4(color, 1.0) * texture(textureMap, vec2(vUv.x, 1.0 - vUv.y)); \n            } else {\n                layer0 = vec4(color, 1.0);\n            }        \n        }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n           \n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            out vec2 vUv;\n            out vec3 vNormalWorld;\n            out vec3 vPositionWorld;\n\n            uniform mat4 viewProjection;\n\n            void main() {\n                vUv = uv;\n                vPositionWorld = vec3(modelMatrix * vec4(position, 1.0));\n                vNormalWorld = vec3(normalMatrix * vec4(normal, 1.0));\n                gl_Position = viewProjection * modelMatrix *  vec4(position, 1); \n            }\n        ","#version 300 es            \n        precision highp float;\n        precision highp int;\n\n        in vec2 vUv;\n        in vec3 vNormalWorld;\n        in vec3 vPositionWorld;\n\n        const int MAX_POINT_LIGHTS = 8;\n\n        uniform int renderTargetLayer;\n\n        layout (std140) uniform sceneBuffer {\n            mat4 viewMatrix;\n            mat4 projectionMatrix;\n            float numLights;\n            float numDirectionalLights;\n        };\n\n        layout (std140) uniform materialBuffer {\n            vec4 mambient; // 16 0 - base | aligned offset\n            vec4 mdiffuse; // 16 16\n            //vec4 memissive;\n            vec4 mspecular; // 16 32\n            float specularExponent; // 4 48\n            bool hasDiffuseMap; // 4 52\n            bool hasNormalMap; // 4 56\n            bool hasSpecularMap; // 4 60\n            bool hasDissolveMap; // 4 64\n        };\n\n        uniform sampler2D textureMap;\n        uniform sampler2D bumpMap;\n        uniform sampler2D specularMap;\n        uniform sampler2D dissolveMap;\n\n        struct PointLight {\n            vec3 position;\n            vec4 color;\n            float intensity;\n        };\n\n        layout (std140) uniform pointLightsBuffer {\n            PointLight pointLights[MAX_POINT_LIGHTS];\n        };\n\n        uniform bool xAxis;\n\n        // Lighting attenuation factors.\n        #define DIST_FACTOR 1.1 /* Distance is multiplied by this when calculating attenuation. */\n        #define CONSTANT 1.0\n        #define LINEAR 0.0\n        #define QUADRATIC 1.0\n\n        layout(location = 0) out vec4 layer0;\n   \n        // Returns an attenuation factor given a distance.\n        float attenuate(float dist) { \n            dist *= DIST_FACTOR; \n            return 1.0 / (CONSTANT);// + LINEAR * dist;// + QUADRATIC * dist * dist); \n        }\n        \n        vec3 calculatePointLight(PointLight light){\n            vec3 vertexPosition;\n            vertexPosition = vPositionWorld;\n\n            vec3 direction = normalize( light.position - vertexPosition );\n            float distanceToLight = distance(light.position, vertexPosition);\n            float attenuation = attenuate(distanceToLight);\n            float d = max(dot(normalize(vNormalWorld), direction), 0.0);\n            return d *attenuation * 0.15 * vec3(1.0); // intensity, light color missing\n        }\n\n        void main() {\n            vec3 color = vec3(0.0f);\n            for(int i = 0; i < int(numLights); ++i) {\n                color += calculatePointLight(pointLights[i]);\n            }\n\n            if (hasDiffuseMap) {\n                layer0 = vec4(color, 1.0) * texture(textureMap, vec2(vUv.x, 1.0 - vUv.y)); \n            } else {\n                layer0 = vec4(color, 1.0);\n            }        \n        }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));n(3);class a{constructor(){`#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 position;\n        \n            out vec2 textureCoordinateFrag;\n\n            vec2 scaleAndBias(vec2 p) { return 0.5 * p + vec2(0.5); }\n            void main() {\n                textureCoordinateFrag = scaleAndBias(position.xy);\n                gl_Position = vec4(position, 1);\n            }\n        `,`#version 300 es     \n            precision highp float;      \n            precision mediump sampler3D;                  \n\n            #define STEP_LENGTH 5.0\n            \n            const int MAX_POINT_LIGHTS = 8;\n\n            uniform sampler2D Texture; // Unit cube back FBO.\n            uniform sampler3D texture3D; // Texture in which voxelization is stored.\n            uniform vec3 cameraPosition;\n\n            uniform float mipmapLevel;\n            uniform float stepLength;\n            uniform float sceneScale;\n\n            in vec2 textureCoordinateFrag; \n            out vec4 color;\n                        \n            // Scales and bias a given vector (i.e. from [-1, 1] to [0, 1]).\n            vec3 scaleAndBias(vec3 p) { return 0.5 * p + vec3(0.5); }\n\n            void main() {\n                // Initialize ray.\n                vec3 origin = cameraPosition;\n                vec3 direction = texture(Texture, textureCoordinateFrag).xyz - origin;\n                int numberOfSteps = int( length(direction) / stepLength);\n                direction = normalize(direction);\n               \n                // Trace.\n                color = vec4(0.0f);\n                for(int i = 0; i < numberOfSteps; ++i) {\n                    vec3 currentPoint = origin + stepLength * float(i) * direction;\n                    vec4 currentSample = textureLod(texture3D, scaleAndBias(currentPoint / sceneScale), mipmapLevel);\n\n                    if (currentSample.a > 0.0) {\n                        currentSample.rgb /= currentSample.a;\n                        // Alpha compositing\n                        color.rgb = color.rgb + (1.0 - color.a) * currentSample.a * currentSample.rgb;\n                        color.a   = color.a   + (1.0 - color.a) * currentSample.a;\n                    }\n                    if (color.a > 0.95) {\n                        break;\n                    }\n                    color += currentSample;\n                } \n                color.rgb = pow(color.rgb, vec3(1.0 / 3.2));\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n            layout(location = 0) in vec3 position;\n        \n            out vec2 textureCoordinateFrag;\n\n            vec2 scaleAndBias(vec2 p) { return 0.5 * p + vec2(0.5); }\n            void main() {\n                textureCoordinateFrag = scaleAndBias(position.xy);\n                gl_Position = vec4(position, 1);\n            }\n        ","#version 300 es     \n            precision highp float;      \n            precision mediump sampler3D;                  \n\n            #define STEP_LENGTH 5.0\n            \n            const int MAX_POINT_LIGHTS = 8;\n\n            uniform sampler2D Texture; // Unit cube back FBO.\n            uniform sampler3D texture3D; // Texture in which voxelization is stored.\n            uniform vec3 cameraPosition;\n\n            uniform float mipmapLevel;\n            uniform float stepLength;\n            uniform float sceneScale;\n\n            in vec2 textureCoordinateFrag; \n            out vec4 color;\n                        \n            // Scales and bias a given vector (i.e. from [-1, 1] to [0, 1]).\n            vec3 scaleAndBias(vec3 p) { return 0.5 * p + vec3(0.5); }\n\n            void main() {\n                // Initialize ray.\n                vec3 origin = cameraPosition;\n                vec3 direction = texture(Texture, textureCoordinateFrag).xyz - origin;\n                int numberOfSteps = int( length(direction) / stepLength);\n                direction = normalize(direction);\n               \n                // Trace.\n                color = vec4(0.0f);\n                for(int i = 0; i < numberOfSteps; ++i) {\n                    vec3 currentPoint = origin + stepLength * float(i) * direction;\n                    vec4 currentSample = textureLod(texture3D, scaleAndBias(currentPoint / sceneScale), mipmapLevel);\n\n                    if (currentSample.a > 0.0) {\n                        currentSample.rgb /= currentSample.a;\n                        // Alpha compositing\n                        color.rgb = color.rgb + (1.0 - color.a) * currentSample.a * currentSample.rgb;\n                        color.a   = color.a   + (1.0 - color.a) * currentSample.a;\n                    }\n                    if (color.a > 0.95) {\n                        break;\n                    }\n                    color += currentSample;\n                } \n                color.rgb = pow(color.rgb, vec3(1.0 / 3.2));\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));n(3);class a{constructor(){`#version 300 es\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            // layout(location = 3) in vec3 tangent;\n            // layout(location = 4) in vec3 bitangent;\n           \n            // layout (std140) uniform modelMatrices {\n            //     mat4 modelMatrix;\n            //     mat4 normalMatrix;\n            // };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            out vec3 worldPosition;\n    \n            void main() {\n                worldPosition = vec3(vec4(position, 1.0));\n                gl_Position = projectionMatrix * viewMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es \n            precision highp float;\n            \n            in vec3 worldPosition;\n            out vec4 outColor;\n\n            const int MAX_POINT_LIGHTS = 8;\n\n            // TODO remoev\n            // layout (std140) uniform materialBuffer {\n            //     vec4 mambient; // 16 0 - base | aligned offset\n            //     vec4 mdiffuse; // 16 16\n            //     //vec4 memissive;\n            //     vec4 mspecular; // 16 32\n            //     float specularExponent; // 4 48\n            //     bool hasDiffuseMap; // 4 52\n            //     bool hasNormalMap; // 4 56\n            //     bool hasSpecularMap; // 4 60\n            //     bool hasDissolveMap; // 4 64\n            // };\n            \n            void main() {\n                outColor.rgb = worldPosition;\n                outColor.a = 1.0;\n            }\n    `;const e=Object(i.b)();this.program=Object(o.a)(e,"#version 300 es\n            precision highp float;\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            // layout(location = 3) in vec3 tangent;\n            // layout(location = 4) in vec3 bitangent;\n           \n            // layout (std140) uniform modelMatrices {\n            //     mat4 modelMatrix;\n            //     mat4 normalMatrix;\n            // };\n\n            layout (std140) uniform sceneBuffer {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n                float numLights;\n                float numDirectionalLights;\n            };\n\n            out vec3 worldPosition;\n    \n            void main() {\n                worldPosition = vec3(vec4(position, 1.0));\n                gl_Position = projectionMatrix * viewMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es \n            precision highp float;\n            \n            in vec3 worldPosition;\n            out vec4 outColor;\n\n            const int MAX_POINT_LIGHTS = 8;\n\n            // TODO remoev\n            // layout (std140) uniform materialBuffer {\n            //     vec4 mambient; // 16 0 - base | aligned offset\n            //     vec4 mdiffuse; // 16 16\n            //     //vec4 memissive;\n            //     vec4 mspecular; // 16 32\n            //     float specularExponent; // 4 48\n            //     bool hasDiffuseMap; // 4 52\n            //     bool hasNormalMap; // 4 56\n            //     bool hasSpecularMap; // 4 60\n            //     bool hasDissolveMap; // 4 64\n            // };\n            \n            void main() {\n                outColor.rgb = worldPosition;\n                outColor.a = 1.0;\n            }\n    ")}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";n(0),n(1),n(2),n(3)},function(e,t,n){"use strict";n(0),n(1),n(2),n(3)},function(e,t,n){"use strict";n(0),n(1),n(2),n(3)},function(e,t,n){"use strict";var i=n(5),o=n(1),a=n(0);class r extends i.a{constructor(e,t,n,i){console.assert(e&&t&&n&&i),super(),this.fov=e*(Math.PI/180),this.ratio=t,this.near=n,this.far=i,this.target=o.c.create(),this.up=o.c.fromValues(0,1,0),this.projectionMatrix=o.a.create(),this.viewMatrix=o.a.create(),this.position=o.c.fromValues(-852.113525390625,777.55029296875,102.569091796875),this.rotation=o.c.fromValues(.30800002813339233,.9680004119873047,0),this.updateProjectionMatrix()}setFov(e){e!==this.fov&&(this.fov=e*(Math.PI/180),this.updateProjectionMatrix())}setTarget(e){o.c.copy(this.target,e)}lookAt(){o.a.lookAt(this.viewMatrix,this.position,this.target,this.up)}updateProjectionMatrix(){Object(a.b)();o.a.perspective(this.projectionMatrix,this.fov,this.ratio,this.near,this.far)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2)),a=n(3);class r{constructor(e={}){e.map?(this._texture=new a.a,this._texture.createTexture(e.map),console.log("Created Texture!")):console.warn("Material must have a texture ATM!");`#version 300 es\n      uniform modelMatrices {\n        mat4 modelMatrix;\n        mat4 normalMatrix;\n      };\n\n      uniform sceneMatrices {\n        mat4 viewMatrix;\n        mat4 projectionMatrix;\n      };\n\n      in vec3 position;\n      in vec3 normal;\n      in vec2 uv;\n      in float materialId;\n\n      out vec3 vPosition;\n      out vec3 vNormal;\n      out vec2 vUv;\n      out float vMaterial;\n\n      void main() {\n        vNormal = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n        vUv = uv;\n        vPosition = vec3(viewMatrix * modelMatrix * vec4(position, 1.0));\n        vMaterial = materialId;\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n      }\n    `,`#version 300 es\n      precision mediump float;\n\n      const int MAX_DIRECTIONAL_LIGHTS = 16;\n      const int MAX_MATERIALS = 16;\n\n      struct Directional {\n        vec4 color;\n        float intensity;\n        vec3 position;\n      };\n\n      struct Material {\n        vec3 ambient;\n      };\n\n      uniform materialBuffer {\n        Material materials[MAX_MATERIALS];\n      };\n\n      uniform directionalBuffer {\n        Directional directionalLights[MAX_DIRECTIONAL_LIGHTS];\n      };\n\n      uniform int numLights;\n      uniform vec3 color;\n      //uniform sampler2D textureMap;\n\n      vec3 ka = vec3(0.8);\n      vec3 kd = vec3(0.64, 0.48, 0.32);\n      vec3 ks = vec3(0.5, 0.5, 0.5);\n      float shininess = 96.078431;\n\n      vec3 Ia = vec3(0.3);\n      vec3 Id = vec3(0.5);\n      vec3 Is = vec3(0.5);\n\n      in vec3 vPosition;\n      in vec3 vNormal;\n      in vec2 vUv;\n      in float vMaterial;\n\n      out vec4 outColor;\n\n      void light(int lightIndex, vec3 pos, vec3 norm, out vec3 ambient, out vec3 diffuse, out vec3 spec) {\n        vec3 n = normalize(norm);\n        vec3 s = normalize(directionalLights[lightIndex].position - pos);\n        vec3 v = normalize(-pos);\n        vec3 r = reflect(-s,n);\n\n        ambient = Ia * ka;\n        float sDotN = max(dot(s,n), 0.0);\n        diffuse = Id * kd * sDotN;\n\n        spec = Is * ks * pow(max(dot(r,v) , 0.0 ), shininess);\n      }\n\n      void main() {\n        // vec3 ambientSum = vec3(0);\n        // vec3 diffuseSum = vec3(0);\n        // vec3 specSum = vec3(0);\n        // vec3 ambient, diffuse, spec;\n\n        // if (gl_FrontFacing) {\n        //   for (int i = 0; i < numLights; ++i) {\n        //     light(i, vPosition, vNormal, ambient, diffuse, spec);\n        //     ambientSum += ambient;\n        //     diffuseSum += diffuse;\n        //     specSum += spec;\n        //   }\n        // } else {\n        //   for (int i = 0; i < numLights; ++i) {\n        //     light(i, vPosition, -vNormal, ambient, diffuse, spec);\n        //     ambientSum += ambient;\n        //     diffuseSum += diffuse;\n        //     specSum += spec;\n        //   }\n        // }\n        // ambientSum /= float(numLights);\n\n        // vec4 texColor = texture(textureMap, vUv);\n        // outColor = vec4(ambientSum + diffuseSum, 1.0) * texColor + vec4(specSum, 1.0);\n        outColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    `;const t=Object(i.b)();this.uniforms={map:e.map||null,color:e.color||[1,1,1,1]},this.program=Object(o.a)(t,"#version 300 es\n      uniform modelMatrices {\n        mat4 modelMatrix;\n        mat4 normalMatrix;\n      };\n\n      uniform sceneMatrices {\n        mat4 viewMatrix;\n        mat4 projectionMatrix;\n      };\n\n      in vec3 position;\n      in vec3 normal;\n      in vec2 uv;\n      in float materialId;\n\n      out vec3 vPosition;\n      out vec3 vNormal;\n      out vec2 vUv;\n      out float vMaterial;\n\n      void main() {\n        vNormal = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n        vUv = uv;\n        vPosition = vec3(viewMatrix * modelMatrix * vec4(position, 1.0));\n        vMaterial = materialId;\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n      }\n    ","#version 300 es\n      precision mediump float;\n\n      const int MAX_DIRECTIONAL_LIGHTS = 16;\n      const int MAX_MATERIALS = 16;\n\n      struct Directional {\n        vec4 color;\n        float intensity;\n        vec3 position;\n      };\n\n      struct Material {\n        vec3 ambient;\n      };\n\n      uniform materialBuffer {\n        Material materials[MAX_MATERIALS];\n      };\n\n      uniform directionalBuffer {\n        Directional directionalLights[MAX_DIRECTIONAL_LIGHTS];\n      };\n\n      uniform int numLights;\n      uniform vec3 color;\n      //uniform sampler2D textureMap;\n\n      vec3 ka = vec3(0.8);\n      vec3 kd = vec3(0.64, 0.48, 0.32);\n      vec3 ks = vec3(0.5, 0.5, 0.5);\n      float shininess = 96.078431;\n\n      vec3 Ia = vec3(0.3);\n      vec3 Id = vec3(0.5);\n      vec3 Is = vec3(0.5);\n\n      in vec3 vPosition;\n      in vec3 vNormal;\n      in vec2 vUv;\n      in float vMaterial;\n\n      out vec4 outColor;\n\n      void light(int lightIndex, vec3 pos, vec3 norm, out vec3 ambient, out vec3 diffuse, out vec3 spec) {\n        vec3 n = normalize(norm);\n        vec3 s = normalize(directionalLights[lightIndex].position - pos);\n        vec3 v = normalize(-pos);\n        vec3 r = reflect(-s,n);\n\n        ambient = Ia * ka;\n        float sDotN = max(dot(s,n), 0.0);\n        diffuse = Id * kd * sDotN;\n\n        spec = Is * ks * pow(max(dot(r,v) , 0.0 ), shininess);\n      }\n\n      void main() {\n        // vec3 ambientSum = vec3(0);\n        // vec3 diffuseSum = vec3(0);\n        // vec3 specSum = vec3(0);\n        // vec3 ambient, diffuse, spec;\n\n        // if (gl_FrontFacing) {\n        //   for (int i = 0; i < numLights; ++i) {\n        //     light(i, vPosition, vNormal, ambient, diffuse, spec);\n        //     ambientSum += ambient;\n        //     diffuseSum += diffuse;\n        //     specSum += spec;\n        //   }\n        // } else {\n        //   for (int i = 0; i < numLights; ++i) {\n        //     light(i, vPosition, -vNormal, ambient, diffuse, spec);\n        //     ambientSum += ambient;\n        //     diffuseSum += diffuse;\n        //     specSum += spec;\n        //   }\n        // }\n        // ambientSum /= float(numLights);\n\n        // vec4 texColor = texture(textureMap, vUv);\n        // outColor = vec4(ambientSum + diffuseSum, 1.0) * texColor + vec4(specSum, 1.0);\n        outColor = vec4(1.0, 1.0, 1.0, 1.0);\n      }\n    "),this.programInfo={attribLocations:{position:t.getAttribLocation(this.program,"position"),material:t.getAttribLocation(this.program,"materialId"),normal:t.getAttribLocation(this.program,"normal"),uv:t.getAttribLocation(this.program,"uv")},uniformLocations:{numLights:t.getUniformLocation(this.program,"numLights"),projectionMatrix:t.getUniformLocation(this.program,"projectionMatrix"),modelViewMatrix:t.getUniformLocation(this.program,"modelViewMatrix"),normalMatrix:t.getUniformLocation(this.program,"normalMatrix")}}}setUniform(e,t){const n=Object(i.b)();switch(e){case"numLights":n.uniform1i(this.programInfo.uniformLocations.numLights,t);break;default:console.warn("Unknown Uniform")}}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2)),a=n(3);class r{constructor(e){this._materialData=e,e.mapSpecular&&(this._specularMap=new a.a,this._specularMap.createTexture(e.mapSpecular.texture)),e.mapDiffuse&&(this._texture=new a.a,this._texture.createTexture(e.mapDiffuse.texture)),e.mapBump&&(this._bumpMap=new a.a,this._bumpMap.createTexture(e.mapBump.texture)),e.mapDissolve&&(this._dissolveMap=new a.a,this._dissolveMap.createTexture(e.mapDissolve.texture));`#version 300 es\n            precision mediump int;\n            precision mediump float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n    \n            layout (std140) uniform sceneMatrices {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n            \n            out vec3 vPosViewSpace;\n            out vec2 vUv;\n\n            out vec3 vNormalViewSpace;\n            out vec3 vTangentViewSpace;\n            out vec3 vBitangentViewSpace;\n\n            out mat3 TBN;\n\n            void main() {\n                mat4 modelViewMatrix = viewMatrix * modelMatrix;\n                                \n                vNormalViewSpace = vec3(mat3(modelViewMatrix) * normalize(normal));\n                vTangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(tangent));\n                vBitangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(bitangent));\n            \n                // Transpose is ok since we don't do non-uniform scaling\n                TBN = transpose(mat3(\n                    vTangentViewSpace,\n                    vBitangentViewSpace,\n                    vNormalViewSpace\n                ));\n                \n                vPosViewSpace = vec3(modelViewMatrix * vec4(position, 1.0));\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n        `,`#version 300 es\n            precision mediump float;\n            precision mediump int;\n\n            const int MAX_DIRECTIONAL_LIGHTS = 8;\n            const int MAX_POINT_LIGHTS = 8;\n\n            layout (std140) uniform sceneMatrices {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n            };\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            struct PointLight {\n                vec3 positionViewSpace;\n                vec4 color;\n                float intensity;\n            };\n\n            struct DirectionalLight {\n                vec3 directionViewSpace;\n                vec4 color;\n                float intensity;\n            };\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 \n                vec4 mdiffuse; // 16 16\n                //vec4 memissive; // 16 32\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 56\n                bool hasNormalMap; // 4 60\n                bool hasSpecularMap; // 4 64\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform pointLightsBuffer {\n                PointLight pointLights[MAX_POINT_LIGHTS];\n            };\n\n            layout (std140) uniform directionalLightsBuffer {\n                DirectionalLight directionalLights[MAX_DIRECTIONAL_LIGHTS];\n            };\n\n            layout (std140) uniform guiDataBuffer {\n                float texLod;\n                float bumpIntensity;\n                bool displayNormalMap;\n                bool displaySpecularMap;\n            };\n\n            uniform int numLights;\n            uniform int numDirectionalLights;\n\n            // Textures\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n\n            in vec3 vPosViewSpace;\n            in vec3 vNormalViewSpace;\n\n            in vec3 vTangentViewSpace;\n            in vec3 vBitangentViewSpace;\n\n            in mat3 TBN;\n            in vec2 vUv;\n\n            // TODO: light uniforms\n            vec3 Ia = vec3(0.2);\n            vec3 Id = vec3(1.0);\n            vec3 Is = vec3(1.0);\n\n            out vec4 outColor;\n\n            void light(int lightIndex, vec3 vPos, vec3 norm, out vec3 ambient, out vec3 diffuse, out vec3 spec, bool directional) {\n\n                // View space\n                vec3 n = norm;\n                vec3 l;\n\n                if (directional) {\n                    l = directionalLights[lightIndex].directionViewSpace;\n                } else {\n                    l = pointLights[lightIndex].positionViewSpace - vPos; // Light dir\n                }\n\n                vec3 v = -vPos;\n\n                if (hasNormalMap) {\n                    // Convert from view to tangent space\n                    l = normalize(TBN * l);\n                    v = normalize(TBN * v);\n\n                    vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                    bn.x *= bumpIntensity;\n                    bn.y *= bumpIntensity;\n                    n = normalize(bn);\n                } else {\n                    l = normalize(l);\n                    v = normalize(v);\n                    n = normalize(n);\n                }   \n\n                ambient = Ia * mambient.xyz;\n\n                diffuse = vec3(0);\n                spec  = vec3(0);\n                float intensity = max(dot(n, l), 0.0);\n                if (intensity > 0.0) {\n                    diffuse = Id * mdiffuse.xyz * intensity;\n\n                    //vec3 r = reflect(-l, n); // phong\n                    vec3 h = normalize(l + v); // blinn phong\n                    \n                    float intSpec = max(dot(h, n), 0.0);\n                    spec = Is * vec3(1.0, 1.0, 1.0) * pow(intSpec, specularExponent);\n                    //spec = Is * vec3(1.0, 1.0, 1.0) * pow(max(dot(r,v), 0.0), specularExponent);\n                }\n            } \n        \n            void main() {\n                vec3 ambientSum = vec3(0);\n                vec3 diffuseSum = vec3(0);\n                vec3 specSum = vec3(0);\n                vec3 ambient, diffuse, spec;\n\n                for (int i = 0; i < numLights; ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/false);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n                \n                for (int i = 0; i < numDirectionalLights; ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/true);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n\n                ambientSum /= float(numLights);\n\n        \n                if (displayNormalMap && hasNormalMap) {\n                    vec4 bumpColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                    outColor = bumpColor;\n                } else if (displaySpecularMap && hasSpecularMap) {\n                    outColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                }  else if (hasDiffuseMap) {\n                    vec4 specularMapColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                    vec4 texColor = textureLod(textureMap, vec2(vUv.x, 1.0 - vUv.y), texLod);\n                    outColor = vec4(diffuseSum, 1.0) * texColor + vec4(specSum, 1.0) * specularMapColor * float(hasSpecularMap);\n                } else {\n                    // No texture\n                    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n                    //outColor = vec4(diffuseSum, 1.0) + vec4(specSum, 1.0);\n                }\n\n                // Dissolve map\n                // TODO: Greyscale, this is a waste of memory\n                if (hasDissolveMap) {\n                    vec4 alphaVal = texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y));\n                    \n                    if (alphaVal.x < 0.001) {\n                        discard;\n                    }\n                }\n            }\n        `;const t=Object(i.b)();this.program=Object(o.a)(t,"#version 300 es\n            precision mediump int;\n            precision mediump float;\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n    \n            layout (std140) uniform sceneMatrices {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n            };\n\n            layout(location = 0) in vec3 position;\n            layout(location = 1) in vec3 normal;\n            layout(location = 2) in vec2 uv;\n\n            layout(location = 3) in vec3 tangent;\n            layout(location = 4) in vec3 bitangent;\n            \n            out vec3 vPosViewSpace;\n            out vec2 vUv;\n\n            out vec3 vNormalViewSpace;\n            out vec3 vTangentViewSpace;\n            out vec3 vBitangentViewSpace;\n\n            out mat3 TBN;\n\n            void main() {\n                mat4 modelViewMatrix = viewMatrix * modelMatrix;\n                                \n                vNormalViewSpace = vec3(mat3(modelViewMatrix) * normalize(normal));\n                vTangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(tangent));\n                vBitangentViewSpace = vec3(mat3(modelViewMatrix) * normalize(bitangent));\n            \n                // Transpose is ok since we don't do non-uniform scaling\n                TBN = transpose(mat3(\n                    vTangentViewSpace,\n                    vBitangentViewSpace,\n                    vNormalViewSpace\n                ));\n                \n                vPosViewSpace = vec3(modelViewMatrix * vec4(position, 1.0));\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n            }\n        ","#version 300 es\n            precision mediump float;\n            precision mediump int;\n\n            const int MAX_DIRECTIONAL_LIGHTS = 8;\n            const int MAX_POINT_LIGHTS = 8;\n\n            layout (std140) uniform sceneMatrices {\n                mat4 viewMatrix;\n                mat4 projectionMatrix;\n            };\n\n            layout (std140) uniform modelMatrices {\n                mat4 modelMatrix;\n                mat4 normalMatrix;\n            };\n\n            struct PointLight {\n                vec3 positionViewSpace;\n                vec4 color;\n                float intensity;\n            };\n\n            struct DirectionalLight {\n                vec3 directionViewSpace;\n                vec4 color;\n                float intensity;\n            };\n\n            layout (std140) uniform materialBuffer {\n                vec4 mambient; // 16 0 \n                vec4 mdiffuse; // 16 16\n                //vec4 memissive; // 16 32\n                vec4 mspecular; // 16 32\n                float specularExponent; // 4 48\n                bool hasDiffuseMap; // 4 56\n                bool hasNormalMap; // 4 60\n                bool hasSpecularMap; // 4 64\n                bool hasDissolveMap; // 4 64\n            };\n\n            layout (std140) uniform pointLightsBuffer {\n                PointLight pointLights[MAX_POINT_LIGHTS];\n            };\n\n            layout (std140) uniform directionalLightsBuffer {\n                DirectionalLight directionalLights[MAX_DIRECTIONAL_LIGHTS];\n            };\n\n            layout (std140) uniform guiDataBuffer {\n                float texLod;\n                float bumpIntensity;\n                bool displayNormalMap;\n                bool displaySpecularMap;\n            };\n\n            uniform int numLights;\n            uniform int numDirectionalLights;\n\n            // Textures\n            uniform sampler2D textureMap;\n            uniform sampler2D bumpMap;\n            uniform sampler2D specularMap;\n            uniform sampler2D dissolveMap;\n\n            in vec3 vPosViewSpace;\n            in vec3 vNormalViewSpace;\n\n            in vec3 vTangentViewSpace;\n            in vec3 vBitangentViewSpace;\n\n            in mat3 TBN;\n            in vec2 vUv;\n\n            // TODO: light uniforms\n            vec3 Ia = vec3(0.2);\n            vec3 Id = vec3(1.0);\n            vec3 Is = vec3(1.0);\n\n            out vec4 outColor;\n\n            void light(int lightIndex, vec3 vPos, vec3 norm, out vec3 ambient, out vec3 diffuse, out vec3 spec, bool directional) {\n\n                // View space\n                vec3 n = norm;\n                vec3 l;\n\n                if (directional) {\n                    l = directionalLights[lightIndex].directionViewSpace;\n                } else {\n                    l = pointLights[lightIndex].positionViewSpace - vPos; // Light dir\n                }\n\n                vec3 v = -vPos;\n\n                if (hasNormalMap) {\n                    // Convert from view to tangent space\n                    l = normalize(TBN * l);\n                    v = normalize(TBN * v);\n\n                    vec3 bn = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y)).rgb * 2.0 - 1.0;\n                    bn.x *= bumpIntensity;\n                    bn.y *= bumpIntensity;\n                    n = normalize(bn);\n                } else {\n                    l = normalize(l);\n                    v = normalize(v);\n                    n = normalize(n);\n                }   \n\n                ambient = Ia * mambient.xyz;\n\n                diffuse = vec3(0);\n                spec  = vec3(0);\n                float intensity = max(dot(n, l), 0.0);\n                if (intensity > 0.0) {\n                    diffuse = Id * mdiffuse.xyz * intensity;\n\n                    //vec3 r = reflect(-l, n); // phong\n                    vec3 h = normalize(l + v); // blinn phong\n                    \n                    float intSpec = max(dot(h, n), 0.0);\n                    spec = Is * vec3(1.0, 1.0, 1.0) * pow(intSpec, specularExponent);\n                    //spec = Is * vec3(1.0, 1.0, 1.0) * pow(max(dot(r,v), 0.0), specularExponent);\n                }\n            } \n        \n            void main() {\n                vec3 ambientSum = vec3(0);\n                vec3 diffuseSum = vec3(0);\n                vec3 specSum = vec3(0);\n                vec3 ambient, diffuse, spec;\n\n                for (int i = 0; i < numLights; ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/false);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n                \n                for (int i = 0; i < numDirectionalLights; ++i) {\n                    light(i, vPosViewSpace, vNormalViewSpace, ambient, diffuse, spec, /*directional=*/true);\n                    ambientSum += ambient;\n                    diffuseSum += diffuse;\n                    specSum += spec;\n                }          \n\n                ambientSum /= float(numLights);\n\n        \n                if (displayNormalMap && hasNormalMap) {\n                    vec4 bumpColor = texture(bumpMap, vec2(vUv.x, 1.0 - vUv.y));\n                    outColor = bumpColor;\n                } else if (displaySpecularMap && hasSpecularMap) {\n                    outColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                }  else if (hasDiffuseMap) {\n                    vec4 specularMapColor = texture(specularMap, vec2(vUv.x, 1.0 - vUv.y));\n                    vec4 texColor = textureLod(textureMap, vec2(vUv.x, 1.0 - vUv.y), texLod);\n                    outColor = vec4(diffuseSum, 1.0) * texColor + vec4(specSum, 1.0) * specularMapColor * float(hasSpecularMap);\n                } else {\n                    // No texture\n                    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n                    //outColor = vec4(diffuseSum, 1.0) + vec4(specSum, 1.0);\n                }\n\n                // Dissolve map\n                // TODO: Greyscale, this is a waste of memory\n                if (hasDissolveMap) {\n                    vec4 alphaVal = texture(dissolveMap, vec2(vUv.x, 1.0 - vUv.y));\n                    \n                    if (alphaVal.x < 0.001) {\n                        discard;\n                    }\n                }\n            }\n        "),this.programInfo={uniformLocations:{numLights:t.getUniformLocation(this.program,"numLights"),numDirectionalLights:t.getUniformLocation(this.program,"numDirectionalLights")},uniformBlockLocations:{material:t.getUniformBlockIndex(this.program,"materialBuffer"),model:t.getUniformBlockIndex(this.program,"modelMatrices"),scene:t.getUniformBlockIndex(this.program,"sceneMatrices"),pointlights:t.getUniformBlockIndex(this.program,"pointLightsBuffer"),directionallights:t.getUniformBlockIndex(this.program,"directionalLightsBuffer"),gui:t.getUniformBlockIndex(this.program,"guiDataBuffer")}}}get materialData(){return this._materialData}bindTextures(){const e=Object(i.b)();let t;this._texture&&(e.activeTexture(e.TEXTURE0+0),this._texture.bind(),t=e.getUniformLocation(this.program,"textureMap"),e.uniform1i(t,0)),this._bumpMap&&(e.activeTexture(e.TEXTURE0+1),this._bumpMap.bind(),t=e.getUniformLocation(this.program,"bumpMap"),e.uniform1i(t,1)),this._specularMap&&(e.activeTexture(e.TEXTURE0+2),this._specularMap.bind(),t=e.getUniformLocation(this.program,"specularMap"),e.uniform1i(t,2)),this._dissolveMap&&(e.activeTexture(e.TEXTURE0+3),this._dissolveMap.bind(),t=e.getUniformLocation(this.program,"dissolveMap"),e.uniform1i(t,3))}activate(){Object(i.b)().useProgram(this.program)}}t.a=r},function(e,t,n){"use strict";var i=n(0),o=(n(1),n(2));class a{constructor(e={}){console.assert(e.color),this.color=e.color;`#version 300 es\n      uniform perModel {\n        mat4 modelMatrix;\n        mat4 normalMatrix;\n      };\n\n      uniform perScene {\n        mat4 viewMatrix;\n        mat4 projectionMatrix;\n      };\n\n      in vec3 position;\n      in vec3 normal;\n\n      out vec3 vPosition;\n      out vec3 vNormal;\n\n      void main() {\n        vNormal = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n        vPosition = vec3(viewMatrix * modelMatrix * vec4(position, 1.0));\n        // TODO texcoord\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n      }\n    `,`#version 300 es\n      precision mediump float;\n\n      const int MAX_DIRECTIONAL_LIGHTS = 16;\n\n      struct Directional {\n        vec4 color;\n        float intensity;\n        vec3 position;\n      };\n\n      uniform directional {\n        Directional directionalLights[MAX_DIRECTIONAL_LIGHTS];\n      };\n\n      uniform int numLights;\n      uniform vec3 color;\n\n      vec3 ka = vec3(0.0);\n      vec3 kd = vec3(0.64, 0.48, 0.32);\n\n      vec3 Ia = vec3(0.0);\n      vec3 Id = vec3(0.5);\n\n      in vec3 vPosition;\n      in vec3 vNormal;\n\n      out vec4 outColor;\n\n      void light(int lightIndex, vec3 pos, vec3 norm, out vec3 ambient, out vec3 diffuse) {\n        vec3 n = normalize(norm);\n        vec3 s = normalize(directionalLights[lightIndex].position - pos);\n\n        ambient = Ia * ka;\n        float sDotN = max(dot(s,n), 0.0);\n        diffuse = Id * kd * sDotN;\n      }\n\n\n      void main() {\n        vec3 ambientSum = vec3(0);\n        vec3 diffuseSum = vec3(0);\n        vec3 ambient, diffuse, spec;\n\n        if (gl_FrontFacing) {\n          for (int i = 0; i < numLights; ++i) {\n            light(i, vPosition, vNormal, ambient, diffuse);\n            ambientSum += ambient;\n            diffuseSum += diffuse;\n          }\n        } else {\n          for (int i = 0; i < numLights; ++i) {\n            light(i, vPosition, -vNormal, ambient, diffuse);\n            ambientSum += ambient;\n            diffuseSum += diffuse;\n          }\n        }\n        ambientSum /= float(numLights);\n\n        //vec4 texColor = texture(Tex, data.TexCoord);\n        outColor = vec4(ambientSum + diffuseSum, 1.0);\n      }\n    `;const t=Object(i.b)();this.program=Object(o.a)(t,"#version 300 es\n      uniform perModel {\n        mat4 modelMatrix;\n        mat4 normalMatrix;\n      };\n\n      uniform perScene {\n        mat4 viewMatrix;\n        mat4 projectionMatrix;\n      };\n\n      in vec3 position;\n      in vec3 normal;\n\n      out vec3 vPosition;\n      out vec3 vNormal;\n\n      void main() {\n        vNormal = normalize(vec3(normalMatrix * vec4(normal, 1.0)));\n        vPosition = vec3(viewMatrix * modelMatrix * vec4(position, 1.0));\n        // TODO texcoord\n        gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.0);\n      }\n    ","#version 300 es\n      precision mediump float;\n\n      const int MAX_DIRECTIONAL_LIGHTS = 16;\n\n      struct Directional {\n        vec4 color;\n        float intensity;\n        vec3 position;\n      };\n\n      uniform directional {\n        Directional directionalLights[MAX_DIRECTIONAL_LIGHTS];\n      };\n\n      uniform int numLights;\n      uniform vec3 color;\n\n      vec3 ka = vec3(0.0);\n      vec3 kd = vec3(0.64, 0.48, 0.32);\n\n      vec3 Ia = vec3(0.0);\n      vec3 Id = vec3(0.5);\n\n      in vec3 vPosition;\n      in vec3 vNormal;\n\n      out vec4 outColor;\n\n      void light(int lightIndex, vec3 pos, vec3 norm, out vec3 ambient, out vec3 diffuse) {\n        vec3 n = normalize(norm);\n        vec3 s = normalize(directionalLights[lightIndex].position - pos);\n\n        ambient = Ia * ka;\n        float sDotN = max(dot(s,n), 0.0);\n        diffuse = Id * kd * sDotN;\n      }\n\n\n      void main() {\n        vec3 ambientSum = vec3(0);\n        vec3 diffuseSum = vec3(0);\n        vec3 ambient, diffuse, spec;\n\n        if (gl_FrontFacing) {\n          for (int i = 0; i < numLights; ++i) {\n            light(i, vPosition, vNormal, ambient, diffuse);\n            ambientSum += ambient;\n            diffuseSum += diffuse;\n          }\n        } else {\n          for (int i = 0; i < numLights; ++i) {\n            light(i, vPosition, -vNormal, ambient, diffuse);\n            ambientSum += ambient;\n            diffuseSum += diffuse;\n          }\n        }\n        ambientSum /= float(numLights);\n\n        //vec4 texColor = texture(Tex, data.TexCoord);\n        outColor = vec4(ambientSum + diffuseSum, 1.0);\n      }\n    "),this.programInfo={attribLocations:{position:t.getAttribLocation(this.program,"position"),normal:t.getAttribLocation(this.program,"normal")},uniformLocations:{numLights:t.getUniformLocation(this.program,"numLights"),color:t.getUniformLocation(this.program,"color"),projectionMatrix:t.getUniformLocation(this.program,"projectionMatrix"),modelViewMatrix:t.getUniformLocation(this.program,"modelViewMatrix"),normalMatrix:t.getUniformLocation(this.program,"normalMatrix")}}}setUniform(e,t){const n=Object(i.b)();switch(e){case"numLights":n.uniform1i(this.programInfo.uniformLocations.numLights,t);break;case"dLightPosition":n.uniform3fv(this.programInfo.uniformLocations.dLightPosition,t);break;case"dLightIntensity":n.uniform1f(this.programInfo.uniformLocations.dLightIntensity,t);break;case"modelViewMatrix":n.uniformMatrix4fv(this.programInfo.uniformLocations.modelViewMatrix,!1,t);break;case"projectionMatrix":n.uniformMatrix4fv(this.programInfo.uniformLocations.projectionMatrix,!1,t);break;case"normalMatrix":n.uniformMatrix4fv(this.programInfo.uniformLocations.normalMatrix,!1,t);break;default:console.warn("Unknown Uniform")}}setInternalUniforms(){Object(i.b)().uniform3fv(this.programInfo.uniformLocations.color,this.color)}activate(){Object(i.b)().useProgram(this.program)}}t.a=a},function(e,t,n){"use strict";(function(e){function i(e,t,n){return e<=t?t:e>=n?n:e}var o=n(1),a=n(0);const r=.5*-Math.PI;class s{constructor(t){const n=Object(a.b)();this.camera=t,this.domElement=n.canvas,this.radius=Math.max(t.position[0],t.position[2]),this.rx=Math.atan2(t.position[1],this.radius),this.ry=Math.atan2(t.position[2],t.position[0])+r,this.ox=0,this.oy=0,this.width=e.innerWidth,this.height=e.innerHeight,this.rotationSpeed=5*e.devicePixelRatio,this.zoomMin=.1,this.zoomMax=1/0,this.zoomSpeed=100,this.isDown=!1,this._listen()}_listen(){this.domElement.addEventListener("mousedown",this._onStart.bind(this),!1),this.domElement.addEventListener("mousemove",this._onMove.bind(this),!1),this.domElement.addEventListener("mouseup",this._onEnd.bind(this),!1),this.domElement.addEventListener("touchstart",this._onStart.bind(this),!1),this.domElement.addEventListener("touchmove",this._onMove.bind(this),!1),this.domElement.addEventListener("touchend",this._onEnd.bind(this),!1),e.addEventListener("mousewheel",this._onWheel.bind(this),!1)}_onStart(e){e.preventDefault(),this.oy=this.ry,this.ox=this.rx,this._startY=e.pageX/this.width,this._startX=e.pageY/this.height,this.isDown=!0}_onMove(e){if(this.isDown){const t=e.pageX/this.width,n=e.pageY/this.height;this.rx=this.ox+-(this._startX-n)*this.rotationSpeed,this.ry=this.oy+(this._startY-t)*this.rotationSpeed,this.rx=i(this.rx,.5*-Math.PI,.5*Math.PI)}}_onEnd(){this.isDown=!1}_onWheel(e){e.preventDefault();let t=0;e.wheelDelta?t=e.wheelDelta:e.detail&&(t=e.detail),this._zoom(-t)}_zoom(e){this.radius+=e/1e3*this.zoomSpeed,this.radius=i(this.radius,this.zoomMin,this.zoomMax)}update(){const e=this.radius*Math.sin(this.rx),t=this.radius*Math.cos(this.rx),n=Math.sin(this.ry)*t,i=Math.cos(this.ry)*t;o.c.set(this.camera.position,n,e,i),this.camera.lookAt()}}t.a=s}).call(t,n(44))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var i=n(1),o=n(0);t.a=function(e,t){function n(e,t){return function(){t.apply(e,arguments)}}function a(e){e.preventDefault()}const r=Object(o.b)();this.camera=e,this.domElement=r.canvas,this.movementSpeed=25.5,this.rollSpeed=.22,this.dragToLook=!0,this.autoForward=!1,this.mouseStatus=0,this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this.moveVector=i.c.create(),this.rotationVector=i.c.create(),this.isDirty=!1,this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}},this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()},this.mousedown=function(e){if(this.domElement!==document&&this.domElement.focus(),e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}},this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),n=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-n)/n,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}},this.mouseup=function(e){if(e.preventDefault(),e.stopPropagation(),this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()},this.update=function(e=.9){const t=e*this.movementSpeed,n=1*e*this.rollSpeed,o=this.camera.viewMatrix,a=i.c.create();a[0]=o[0],a[1]=o[4],a[2]=o[8];const r=i.c.create();r[0]=o[2],r[1]=o[6],r[2]=o[10];const s=i.c.create();s[0]=o[1],s[1]=o[5],s[2]=o[11];const c=-this.moveVector[2],l=this.moveVector[1],u=this.moveVector[0];this.camera.position[0]+=(-c*r[0]+l*s[0]+u*a[0])*t,this.camera.position[1]+=(-c*r[1]+l*s[1]+u*a[1])*t,this.camera.position[2]+=(-c*r[2]+l*s[2]+u*a[2])*t,this.camera.rotation[0]+=this.rotationVector[0]*n,this.camera.rotation[1]+=this.rotationVector[1]*n,this.camera.rotation[2]+=this.rotationVector[2]*n,i.b.identity(this.camera.quaternion),i.b.rotateX(this.camera.quaternion,this.camera.quaternion,this.camera.rotation[0]),i.b.rotateZ(this.camera.quaternion,this.camera.quaternion,this.camera.rotation[2]),i.b.rotateY(this.camera.quaternion,this.camera.quaternion,this.camera.rotation[1]);const d=i.b.getAxisAngle(this.camera.quaternionAxisAngle,this.camera.quaternion);i.a.identity(this.camera.viewMatrix);const h=i.c.create();i.c.negate(h,this.camera.position),i.a.rotate(this.camera.viewMatrix,this.camera.viewMatrix,d,this.camera.quaternionAxisAngle),i.a.translate(this.camera.viewMatrix,this.camera.viewMatrix,h)},this.updateMovementVector=function(){const e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector[0]=-this.moveState.left+this.moveState.right,this.moveVector[1]=-this.moveState.down+this.moveState.up,this.moveVector[2]=-e+this.moveState.back},this.updateRotationVector=function(){this.rotationVector[0]=this.moveState.pitchDown-this.moveState.pitchUp,this.rotationVector[1]=this.moveState.yawRight-this.moveState.yawLeft,this.rotationVector[2]=this.moveState.rollRight-this.moveState.rollLeft,this.isDirty=!0},this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}},this.dispose=function(){this.domElement.removeEventListener("contextmenu",a,!1),this.domElement.removeEventListener("mousedown",c,!1),this.domElement.removeEventListener("mousemove",s,!1),this.domElement.removeEventListener("mouseup",l,!1),window.removeEventListener("keydown",u,!1),window.removeEventListener("keyup",d,!1)};var s=n(this,this.mousemove),c=n(this,this.mousedown),l=n(this,this.mouseup),u=n(this,this.keydown),d=n(this,this.keyup);this.domElement.addEventListener("contextmenu",a,!1),this.domElement.addEventListener("mousemove",s,!1),this.domElement.addEventListener("mousedown",c,!1),this.domElement.addEventListener("mouseup",l,!1),window.addEventListener("keydown",u,!1),window.addEventListener("keyup",d,!1),this.updateMovementVector(),this.updateRotationVector()}},function(e,t,n){"use strict";var i=n(14),o=n(47);class a{constructor(){}load(e){return new Promise(t=>{o.downloadMeshes(e,e=>{let n=[];Object.entries(e).forEach(([e,t])=>{const o=!t.vertexNormals||!t.vertexNormals.length||isNaN(t.vertexNormals[0]);o&&console.log("Generating normals manually ...",t);const a={positions:t.vertices,normals:o?Object(i.b)(t.vertices,t.indices):t.vertexNormals,indices:t.indices,uvs:t.textures};n.push(a)}),t(n)})})}loadModelsAndMaterials(e){return new Promise(t=>{o.downloadModels(e).then(e=>{let n=[];setTimeout(()=>{Object.entries(e).forEach(([e,t])=>{const o=!t.vertexNormals||!t.vertexNormals.length||isNaN(t.vertexNormals[0]),a=!t.textures||!t.textures.length||isNaN(t.textures[0]);o&&console.info("Generating normals manually ...",e),a&&console.info("Generating UVs manually...",e);const r={name:e,objectData:{positions:t.vertices,normals:o?Object(i.b)(t.vertices,t.indices):t.vertexNormals,tangents:t.tangents,bitangents:t.bitangents,uvs:a?Object(i.c)(t.vertices):t.textures},materialData:{vertexMaterialIndices:t.vertexMaterialIndices,materialIndices:t.materialIndices,materialNames:t.materialNames,materialsByIndex:t.materialsByIndex},indices:t.indices};n.push(r)}),t(n)},2500)})})}}t.a=a},function(e,t,n){!function(t,n){e.exports=n()}("undefined"!=typeof self&&self,function(){return function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=3)}([function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){switch(e){case"BYTE":case"UNSIGNED_BYTE":return 1;case"SHORT":case"UNSIGNED_SHORT":return 2;case"FLOAT":return 4}}Object.defineProperty(t,"__esModule",{value:!0});var a=t.Layout=function e(){i(this,e);for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.attributes=n;var a=0,s=0,c=!0,l=!1,u=void 0;try{for(var d,h=n[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var m=d.value;if(this[m.key])throw new r(m);a%m.sizeOfType!=0&&(a+=m.sizeOfType-a%m.sizeOfType),this[m.key]={attribute:m,size:m.size,type:m.type,normalized:m.normalized,offset:a},a+=m.sizeInBytes,s=Math.max(s,m.sizeOfType)}}catch(e){l=!0,u=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw u}}a%s!=0&&(a+=s-a%s),this.stride=a;var f=!0,p=!1,v=void 0;try{for(var _,b=n[Symbol.iterator]();!(f=(_=b.next()).done);f=!0)this[_.value.key].stride=this.stride}catch(e){p=!0,v=e}finally{try{!f&&b.return&&b.return()}finally{if(p)throw v}}},r=function e(t){i(this,e),this.message="found duplicate attribute: "+t.key},s=function e(t,n,a){arguments.length>3&&void 0!==arguments[3]&&arguments[3],i(this,e),this.key=t,this.size=n,this.type=a,this.normalized=!1,this.sizeOfType=o(a),this.sizeInBytes=this.sizeOfType*n};a.POSITION=new s("position",3,"FLOAT"),a.NORMAL=new s("normal",3,"FLOAT"),a.TANGENT=new s("tangent",3,"FLOAT"),a.BITANGENT=new s("bitangent",3,"FLOAT"),a.UV=new s("uv",2,"FLOAT"),a.MATERIAL_INDEX=new s("materialIndex",1,"SHORT"),a.MATERIAL_ENABLED=new s("materialEnabled",1,"UNSIGNED_SHORT"),a.AMBIENT=new s("ambient",3,"FLOAT"),a.DIFFUSE=new s("diffuse",3,"FLOAT"),a.SPECULAR=new s("specular",3,"FLOAT"),a.SPECULAR_EXPONENT=new s("specularExponent",3,"FLOAT"),a.EMISSIVE=new s("emissive",3,"FLOAT"),a.TRANSMISSION_FILTER=new s("transmissionFilter",3,"FLOAT"),a.DISSOLVE=new s("dissolve",1,"FLOAT"),a.ILLUMINATION=new s("illumination",1,"UNSIGNED_SHORT"),a.REFRACTION_INDEX=new s("refractionIndex",1,"FLOAT"),a.SHARPNESS=new s("sharpness",1,"FLOAT"),a.MAP_DIFFUSE=new s("mapDiffuse",1,"SHORT"),a.MAP_AMBIENT=new s("mapAmbient",1,"SHORT"),a.MAP_SPECULAR=new s("mapSpecular",1,"SHORT"),a.MAP_SPECULAR_EXPONENT=new s("mapSpecularExponent",1,"SHORT"),a.MAP_DISSOLVE=new s("mapDissolve",1,"SHORT"),a.ANTI_ALIASING=new s("antiAliasing",1,"UNSIGNED_SHORT"),a.MAP_BUMP=new s("mapBump",1,"SHORT"),a.MAP_DISPLACEMENT=new s("mapDisplacement",1,"SHORT"),a.MAP_DECAL=new s("mapDecal",1,"SHORT"),a.MAP_EMISSIVE=new s("mapEmissive",1,"SHORT")},function(e,t,n){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(0),s=function(){function e(t,n){o(this,e),(n=n||{}).materials=n.materials||{},n.enableWTextureCoord=!!n.enableWTextureCoord,n.indicesPerMaterial=!!n.indicesPerMaterial;var a=this;a.vertices=[],a.vertexNormals=[],a.textures=[],a.indices=[],a.textureStride=n.enableWTextureCoord?3:2,this.name="";var r=[],s=[],c=[],l={},u=[],d={},h=-1,m=0;l.verts=[],l.norms=[],l.textures=[],l.hashindices={},l.indices=[[]],l.materialIndices=[],l.index=0;for(var f=/^v\s/,p=/^vn\s/,v=/^vt\s/,_=/^f\s/,b=/\s+/,g=/^usemtl/,x=t.split("\n"),M=0;M<x.length;M++){var y=x[M].trim();if(y&&!y.startsWith("#")){var E=y.split(b);if(E.shift(),f.test(y))r.push.apply(r,i(E));else if(p.test(y))s.push.apply(s,i(E));else if(v.test(y)){var w=E;E.length>2&&!n.enableWTextureCoord?w=E.slice(0,1):2===E.length&&n.enableWTextureCoord&&w.push(0),c.push.apply(c,i(w))}else if(g.test(y)){var T=E[0];T in d||(u.push(T),d[T]=u.length-1,n.indicesPerMaterial&&d[T]>0&&l.indices.push([])),h=d[T],n.indicesPerMaterial&&(m=h)}else if(_.test(y))for(var S=!1,A=0,L=E.length;A<L;A++){3!==A||S||(A=2,S=!0);var R=E[0]+","+h,B=E[A]+","+h;if(B in l.hashindices)l.indices[m].push(l.hashindices[B]);else{var I=E[A].split("/"),O=I.length-1;if(l.verts.push(+r[3*(I[0]-1)+0]),l.verts.push(+r[3*(I[0]-1)+1]),l.verts.push(+r[3*(I[0]-1)+2]),c.length){var F=n.enableWTextureCoord?3:2;l.textures.push(+c[(I[1]-1)*F+0]),l.textures.push(+c[(I[1]-1)*F+1]),n.enableWTextureCoord&&l.textures.push(+c[(I[1]-1)*F+2])}l.norms.push(+s[3*(I[O]-1)+0]),l.norms.push(+s[3*(I[O]-1)+1]),l.norms.push(+s[3*(I[O]-1)+2]),l.materialIndices.push(h),l.hashindices[B]=l.index,l.indices[m].push(l.hashindices[B]),l.index+=1}3===A&&S&&l.indices[m].push(l.hashindices[R])}}}a.vertices=l.verts,a.vertexNormals=l.norms,a.textures=l.textures,a.vertexMaterialIndices=l.materialIndices,a.indices=n.indicesPerMaterial?l.indices:l.indices[m],a.materialNames=u,a.materialIndices=d,a.materialsByIndex={},n.calcTangentsAndBitangents&&this.calculateTangentsAndBitangents()}return a(e,[{key:"calculateTangentsAndBitangents",value:function(){var e={};e.tangents=[].concat(i(new Array(this.vertices.length))).map(function(e){return 0}),e.bitangents=[].concat(i(new Array(this.vertices.length))).map(function(e){return 0});var t=void 0;t=Array.isArray(this.indices[0])?[].concat.apply([],this.indices):this.indices;for(var n=this.vertices,o=this.vertexNormals,a=this.textures,r=0;r<t.length;r+=3){var s=t[r+0],c=t[r+1],l=t[r+2],u=n[3*s+0],d=n[3*s+1],h=n[3*s+2],m=a[2*s+0],f=a[2*s+1],p=n[3*c+0],v=n[3*c+1],_=n[3*c+2],b=a[2*c+0],g=a[2*c+1],x=p-u,M=v-d,y=_-h,E=n[3*l+0]-u,w=n[3*l+1]-d,T=n[3*l+2]-h,S=b-m,A=g-f,L=a[2*l+0]-m,R=a[2*l+1]-f,B=S*R-A*L,I=1/(Math.abs(B<1e-4)?1:B),O=(x*R-E*A)*I,F=(M*R-w*A)*I,U=(y*R-T*A)*I,C=(E*S-x*L)*I,D=(w*S-M*L)*I,P=(T*S-y*L)*I,k=o[3*s+0],N=o[3*s+1],V=o[3*s+2],j=o[3*c+0],z=o[3*c+1],X=o[3*c+2],H=o[3*l+0],G=o[3*l+1],Y=o[3*l+2],q=O*k+F*N+U*V,W=O*j+F*z+U*X,K=O*H+F*G+U*Y,Q=O-k*q,J=F-N*q,Z=U-V*q,$=O-j*W,ee=F-z*W,te=U-X*W,ne=O-H*K,ie=F-G*K,oe=U-Y*K,ae=Math.sqrt(Q*Q+J*J+Z*Z),re=Math.sqrt($*$+ee*ee+te*te),se=Math.sqrt(ne*ne+ie*ie+oe*oe),ce=C*k+D*N+P*V,le=C*j+D*z+P*X,ue=C*H+D*G+P*Y,de=C-k*ce,he=D-N*ce,me=P-V*ce,fe=C-j*le,pe=D-z*le,ve=P-X*le,_e=C-H*ue,be=D-G*ue,ge=P-Y*ue,xe=Math.sqrt(de*de+he*he+me*me),Me=Math.sqrt(fe*fe+pe*pe+ve*ve),ye=Math.sqrt(_e*_e+be*be+ge*ge);e.tangents[3*s+0]+=Q/ae,e.tangents[3*s+1]+=J/ae,e.tangents[3*s+2]+=Z/ae,e.tangents[3*c+0]+=$/re,e.tangents[3*c+1]+=ee/re,e.tangents[3*c+2]+=te/re,e.tangents[3*l+0]+=ne/se,e.tangents[3*l+1]+=ie/se,e.tangents[3*l+2]+=oe/se,e.bitangents[3*s+0]+=de/xe,e.bitangents[3*s+1]+=he/xe,e.bitangents[3*s+2]+=me/xe,e.bitangents[3*c+0]+=fe/Me,e.bitangents[3*c+1]+=pe/Me,e.bitangents[3*c+2]+=ve/Me,e.bitangents[3*l+0]+=_e/ye,e.bitangents[3*l+1]+=be/ye,e.bitangents[3*l+2]+=ge/ye}this.tangents=e.tangents,this.bitangents=e.bitangents}},{key:"makeBufferData",value:function(e){var t=this.vertices.length/3,n=new ArrayBuffer(e.stride*t);n.numItems=t;for(var i=new DataView(n),o=0,a=0;o<t;o++){a=o*e.stride;var s=!0,c=!1,l=void 0;try{for(var u,d=e.attributes[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var h=u.value,m=a+e[h.key].offset;switch(h.key){case r.Layout.POSITION.key:i.setFloat32(m,this.vertices[3*o],!0),i.setFloat32(m+4,this.vertices[3*o+1],!0),i.setFloat32(m+8,this.vertices[3*o+2],!0);break;case r.Layout.UV.key:i.setFloat32(m,this.textures[2*o],!0),i.setFloat32(m+4,this.vertices[2*o+1],!0);break;case r.Layout.NORMAL.key:i.setFloat32(m,this.vertexNormals[3*o],!0),i.setFloat32(m+4,this.vertexNormals[3*o+1],!0),i.setFloat32(m+8,this.vertexNormals[3*o+2],!0);break;case r.Layout.MATERIAL_INDEX.key:i.setInt16(m,this.vertexMaterialIndices[o],!0);break;case r.Layout.AMBIENT.key:var f=this.vertexMaterialIndices[o],p=this.materialsByIndex[f];if(!p)break;i.setFloat32(m,p.ambient[0],!0),i.setFloat32(m+4,p.ambient[1],!0),i.setFloat32(m+8,p.ambient[2],!0);break;case r.Layout.DIFFUSE.key:var v=this.vertexMaterialIndices[o],_=this.materialsByIndex[v];if(!_)break;i.setFloat32(m,_.diffuse[0],!0),i.setFloat32(m+4,_.diffuse[1],!0),i.setFloat32(m+8,_.diffuse[2],!0);break;case r.Layout.SPECULAR.key:var b=this.vertexMaterialIndices[o],g=this.materialsByIndex[b];if(!g)break;i.setFloat32(m,g.specular[0],!0),i.setFloat32(m+4,g.specular[1],!0),i.setFloat32(m+8,g.specular[2],!0);break;case r.Layout.SPECULAR_EXPONENT.key:var x=this.vertexMaterialIndices[o],M=this.materialsByIndex[x];if(!M)break;i.setFloat32(m,M.specularExponent,!0);break;case r.Layout.EMISSIVE.key:var y=this.vertexMaterialIndices[o],E=this.materialsByIndex[y];if(!E)break;i.setFloat32(m,E.emissive[0],!0),i.setFloat32(m+4,E.emissive[1],!0),i.setFloat32(m+8,E.emissive[2],!0);break;case r.Layout.TRANSMISSION_FILTER.key:var w=this.vertexMaterialIndices[o],T=this.materialsByIndex[w];if(!T)break;i.setFloat32(m,T.transmissionFilter[0],!0),i.setFloat32(m+4,T.transmissionFilter[1],!0),i.setFloat32(m+8,T.transmissionFilter[2],!0);break;case r.Layout.DISSOLVE.key:var S=this.vertexMaterialIndices[o],A=this.materialsByIndex[S];if(!A)break;i.setFloat32(m,A.dissolve,!0);break;case r.Layout.ILLUMINATION.key:var L=this.vertexMaterialIndices[o],R=this.materialsByIndex[L];if(!R)break;i.setInt16(m,R.illumination,!0);break;case r.Layout.REFRACTION_INDEX.key:var B=this.vertexMaterialIndices[o],I=this.materialsByIndex[B];if(!I)break;i.setFloat32(m,I.refractionIndex,!0);break;case r.Layout.SHARPNESS.key:var O=this.vertexMaterialIndices[o],F=this.materialsByIndex[O];if(!F)break;i.setFloat32(m,F.sharpness,!0);break;case r.Layout.ANTI_ALIASING.key:var U=this.vertexMaterialIndices[o],C=this.materialsByIndex[U];if(!C)break;i.setInt16(m,C.antiAliasing,!0)}}}catch(e){c=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(c)throw l}}}return n}},{key:"makeIndexBufferData",value:function(){var e=new Uint16Array(this.indices);return e.numItems=this.indices.length,e}},{key:"addMaterialLibrary",value:function(e){for(var t in e.materials)if(t in this.materialIndices){var n=e.materials[t],i=this.materialIndices[n.name];this.materialsByIndex[i]=n}}}]),e}();t.default=s},function(e,t,n){"use strict";function i(e){return Array.isArray(e)?e:Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=t.Material=function e(t){o(this,e),this.name=t,this.ambient=[0,0,0],this.diffuse=[0,0,0],this.specular=[0,0,0],this.emissive=[0,0,0],this.transmissionFilter=[0,0,0],this.dissolve=0,this.specularExponent=0,this.transparency=0,this.illumination=0,this.refractionIndex=1,this.sharpness=0,this.mapDiffuse=null,this.mapAmbient=null,this.mapSpecular=null,this.mapSpecularExponent=null,this.mapDissolve=null,this.antiAliasing=!1,this.mapBump=null,this.mapDisplacement=null,this.mapDecal=null,this.mapEmissive=null,this.mapReflections=[]};t.MaterialLibrary=function(){function e(t){o(this,e),this.data=t,this.currentMaterial=null,this.materials={},this.parse()}return a(e,[{key:"parse_newmtl",value:function(e){var t=e[0];this.currentMaterial=new r(t),this.materials[t]=this.currentMaterial}},{key:"parseColor",value:function(e){if("spectral"!=e[0]&&"xyz"!=e[0]){if(3==e.length)return e.map(parseFloat);var t=parseFloat(e[0]);return[t,t,t]}}},{key:"parse_Ka",value:function(e){this.currentMaterial.ambient=this.parseColor(e)}},{key:"parse_Kd",value:function(e){this.currentMaterial.diffuse=this.parseColor(e)}},{key:"parse_Ks",value:function(e){this.currentMaterial.specular=this.parseColor(e)}},{key:"parse_Ke",value:function(e){this.currentMaterial.emissive=this.parseColor(e)}},{key:"parse_Tf",value:function(e){this.currentMaterial.transmissionFilter=this.parseColor(e)}},{key:"parse_d",value:function(e){this.currentMaterial.dissolve=parseFloat(e.pop())}},{key:"parse_illum",value:function(e){this.currentMaterial.illumination=parseInt(e[0])}},{key:"parse_Ni",value:function(e){this.currentMaterial.refractionIndex=parseFloat(e[0])}},{key:"parse_Ns",value:function(e){this.currentMaterial.specularExponent=parseInt(e[0])}},{key:"parse_sharpness",value:function(e){this.currentMaterial.sharpness=parseInt(e[0])}},{key:"parse_cc",value:function(e,t){t.colorCorrection="on"==e[0]}},{key:"parse_blendu",value:function(e,t){t.horizontalBlending="on"==e[0]}},{key:"parse_blendv",value:function(e,t){t.verticalBlending="on"==e[0]}},{key:"parse_boost",value:function(e,t){t.boostMipMapSharpness=parseFloat(e[0])}},{key:"parse_mm",value:function(e,t){t.modifyTextureMap.brightness=parseFloat(e[0]),t.modifyTextureMap.contrast=parseFloat(e[1])}},{key:"parse_ost",value:function(e,t,n){for(;e.length<3;)e.push(n);t.u=parseFloat(e[0]),t.v=parseFloat(e[1]),t.w=parseFloat(e[2])}},{key:"parse_o",value:function(e,t){this.parse_ost(e,t.offset,0)}},{key:"parse_s",value:function(e,t){this.parse_ost(e,t.scale,1)}},{key:"parse_t",value:function(e,t){this.parse_ost(e,t.turbulence,0)}},{key:"parse_texres",value:function(e,t){t.textureResolution=parseFloat(e[0])}},{key:"parse_clamp",value:function(e,t){t.clamp="on"==e[0]}},{key:"parse_bm",value:function(e,t){t.bumpMultiplier=parseFloat(e[0])}},{key:"parse_imfchan",value:function(e,t){t.imfChan=e[0]}},{key:"parse_type",value:function(e,t){t.reflectionType=e[0]}},{key:"parseOptions",value:function(e){var t={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null},n=void 0,i=void 0,o={};for(e.reverse();e.length;){var a=e.pop();a.startsWith("-")?(n=a.substr(1),o[n]=[]):o[n].push(a)}for(n in o)if(o.hasOwnProperty(n)){i=o[n];var r=this["parse_"+n];r&&r.bind(this)(i,t)}return t}},{key:"parseMap",value:function(e){var t=void 0,n=void 0;if(e[0].startsWith("-"))t=e.pop(),n=e;else{var o=i(e);t=o[0],n=o.slice(1)}return n=this.parseOptions(n),n.filename=t,n}},{key:"parse_map_Ka",value:function(e){this.currentMaterial.mapAmbient=this.parseMap(e)}},{key:"parse_map_Kd",value:function(e){this.currentMaterial.mapDiffuse=this.parseMap(e)}},{key:"parse_map_Ks",value:function(e){this.currentMaterial.mapSpecular=this.parseMap(e)}},{key:"parse_map_Ke",value:function(e){this.currentMaterial.mapEmissive=this.parseMap(e)}},{key:"parse_map_Ns",value:function(e){this.currentMaterial.mapSpecularExponent=this.parseMap(e)}},{key:"parse_map_d",value:function(e){this.currentMaterial.mapDissolve=this.parseMap(e)}},{key:"parse_map_aat",value:function(e){this.currentMaterial.antiAliasing="on"==e[0]}},{key:"parse_map_bump",value:function(e){this.currentMaterial.mapBump=this.parseMap(e)}},{key:"parse_bump",value:function(e){this.parse_map_bump(e)}},{key:"parse_disp",value:function(e){this.currentMaterial.mapDisplacement=this.parseMap(e)}},{key:"parse_decal",value:function(e){this.currentMaterial.mapDecal=this.parseMap(e)}},{key:"parse_refl",value:function(e){this.currentMaterial.mapReflections.push(this.parseMap(e))}},{key:"parse",value:function(){var e=this.data.split(/\r?\n/),t=!0,n=!1,o=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var s=a.value;if((s=s.trim())&&!s.startsWith("#")){var c=s.split(/\s/),l=void 0,u=i(c);l=u[0],c=u.slice(1);var d=this["parse_"+l];d&&d.bind(this)(c)}}}catch(e){n=!0,o=e}finally{try{!t&&r.return&&r.return()}finally{if(n)throw o}}delete this.data,this.currentMaterial=null}}]),e}()},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteMeshBuffers=t.initMeshBuffers=t.downloadMeshes=t.downloadModels=t.Layout=t.MaterialLibrary=t.Material=t.Mesh=void 0;var i=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),o=n(2),a=n(0),r=n(5);t.Mesh=i.default,t.Material=o.Material,t.MaterialLibrary=o.MaterialLibrary,t.Layout=a.Layout,t.downloadModels=r.downloadModels,t.downloadMeshes=r.downloadMeshes,t.initMeshBuffers=r.initMeshBuffers,t.deleteMeshBuffers=r.deleteMeshBuffers},function(e,t,n){"use strict";function i(e,t){var n=["mapDiffuse","mapAmbient","mapSpecular","mapDissolve","mapBump","mapDisplacement","mapDecal","mapEmissive"];t.endsWith("/")||(t+="/");var i=[];for(var o in e.materials)if(e.materials.hasOwnProperty(o)){o=e.materials[o];var a=!0,r=!1,s=void 0;try{for(var c,l=n[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var u=c.value;!function(e){var n=o[u];if(!n)return"continue";var a=t+n.filename;i.push(fetch(a).then(function(e){if(!e.ok)throw new Error;return e.blob()}).then(function(e){var t=new Image;t.src=URL.createObjectURL(e),n.texture=t}).catch(function(){}))}()}}catch(e){r=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(r)throw s}}}return Promise.all(i)}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var n=[],i=!0,o=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(e){o=!0,a=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.downloadModels=function(e){var t=[],n=!0,s=!1,c=void 0;try{for(var l,u=e[Symbol.iterator]();!(n=(l=u.next()).done);n=!0)!function(e){var n=[];if(!e.obj)throw new Error('"obj" attribute of model object not set. The .obj file is required to be set in order to use downloadModels()');var o={};o.indicesPerMaterial=!!e.indicesPerMaterial,o.calcTangentsAndBitangents=!!e.calcTangentsAndBitangents;var s=e.name;if(!s){var c=e.obj.split("/");s=c[c.length-1].replace(".obj","")}if(n.push(Promise.resolve(s)),n.push(fetch(e.obj).then(function(e){return e.text()}).then(function(e){return new a.default(e,o)})),e.mtl){var l=e.mtl;"boolean"==typeof l&&(l=e.obj.replace(/\.obj$/,".mtl")),n.push(fetch(l).then(function(e){return e.text()}).then(function(t){var n=new r.MaterialLibrary(t);if(!1!==e.downloadMtlTextures){var o=e.mtlTextureRoot;return o||(o=l.substr(0,l.lastIndexOf("/"))),Promise.all([Promise.resolve(n),i(n,o)])}return Promise.all(Promise.resolve(n))}).then(function(e){return e[0]}))}t.push(Promise.all(n))}(l.value)}catch(e){s=!0,c=e}finally{try{!n&&u.return&&u.return()}finally{if(s)throw c}}return Promise.all(t).then(function(e){var t={},n=!0,i=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done);n=!0){var c=r.value,l=o(c,3),u=l[0],d=l[1],h=l[2];d.name=u,h&&d.addMaterialLibrary(h),t[u]=d}}catch(e){i=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw a}}return t})},t.downloadMeshes=function(e,t,n){void 0===n&&(n={});var i=[];for(var r in e)!function(t){if(!e.hasOwnProperty(t))return"continue";var n=e[t];i.push(fetch(n).then(function(e){return e.text()}).then(function(e){return[t,new a.default(e)]}))}(r);Promise.all(i).then(function(e){var i=!0,a=!1,r=void 0;try{for(var s,c=e[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var l=s.value,u=o(l,2),d=u[0],h=u[1];n[d]=h}}catch(e){a=!0,r=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw r}}return t(n)})},t.initMeshBuffers=function(e,t){t.normalBuffer=s(e,e.ARRAY_BUFFER,t.vertexNormals,3),t.textureBuffer=s(e,e.ARRAY_BUFFER,t.textures,t.textureStride),t.vertexBuffer=s(e,e.ARRAY_BUFFER,t.vertices,3),t.indexBuffer=s(e,e.ELEMENT_ARRAY_BUFFER,t.indices,1)},t.deleteMeshBuffers=function(e,t){e.deleteBuffer(t.normalBuffer),e.deleteBuffer(t.textureBuffer),e.deleteBuffer(t.vertexBuffer),e.deleteBuffer(t.indexBuffer)};var a=function(e){return e&&e.__esModule?e:{default:e}}(n(1)),r=n(2),s=(n(0),function(e,t,n,i){var o=e.createBuffer(),a=t===e.ARRAY_BUFFER?Float32Array:Uint16Array;return e.bindBuffer(t,o),e.bufferData(t,new a(n),e.STATIC_DRAW),o.itemSize=i,o.numItems=n.length/i,o})}])})},function(e,t,n){"use strict";class i{constructor(){}loadImages(e){let t=[];return Object.entries(e).forEach(([e,n])=>{const i=new Promise(t=>{const i=new Image;i.onload=(()=>{const n={[e]:{width:i.width,height:i.height,data:i}};t(n)}),i.src=n});t.push(i)}),Promise.all(t)}}t.a=i}])});