<html>

<head>
    <title>Hello World</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html,
        body {
            margin: 0;
            background-color: #000;
        }

        span.fps {
            position: absolute;
            padding: 10px;
            color: white;
        }
    </style>
</head>

<body>
    <span class="fps">
        <span id="fps_meter"></span> FPS</span>
    <script src="/webpack-dev-server.js"></script>
    <script src="engine.min.js"></script>
    <script type="text/javascript">
        const canvas = document.createElement('canvas');
        canvas.style.display = 'block';
        canvas.style.boxSizing = 'border-box';

        canvas.width = window.innerWidth * window.devicePixelRatio;
        canvas.height = window.innerHeight * window.devicePixelRatio;
        canvas.style.width = window.innerWidth;
        canvas.style.height = window.innerHeight;
        document.body.appendChild(canvas);

        //  const objectsToLoad = {
        //     //'suzanne': 'data/dabrovic/sponza.obj'
        //     'suzanne': 'data/suzanne.obj'
        //   };


        const objectsToLoad = [
            {
                name: 'die',
                // obj: 'data/suzannefromex/die.obj',
                //obj: 'data/deferredsponza/sponza.obj',
                obj: 'data/crysponza/sponza.obj',
                //obj: 'data/cornell/cornellsphere.obj',
                //obj: 'data/dragon.obj',ebgl
                //obj: 'data/breakfast_room_triangulated/breakfastroom.obj',
                mtl: true,
                //  downloadMtlTextures: true
                //mtlTextureRoot: '/dev/data/suzannefromex/'
            },
            // {
            //   name : 'die2',
            //   obj: 'data/suzannefromex/die.obj',
            //   mtl:true
            // }
            // {
            //   name: 'suzanne2',
            //   obj: 'data/suzanne.obj'
            // }
            // {'suzanne': 'data/suzanne.obj'}
            //   {
            //   name: 'suzanne',
            //   obj: 'data/suzannefromex/suzanne.obj',
            //   mtl: true
            // }
        ];

        // const objectMaterialsToLoad = {
        //   'suzanne': ['data/suzanne.obj', 'data/suzanne.mtl']
        // }

        const texturesToLoad = {
            'placeholder': 'placeholder.jpg'
        };

        const objLoader = new engine.ObjectLoader();
        const resourceLoader = new engine.ResourceLoader();
        //const materialLoader = new engine.MaterialLoader();

        //materialLoader.load(objectMaterialsToLoad);
        //const loadImagesPromise = resourceLoader.loadImages(texturesToLoad);
        const loadModelsAndMaterialsPromise = objLoader.loadModelsAndMaterials(objectsToLoad);

        Promise.all([loadModelsAndMaterialsPromise]).then(([objMatData]) => {
            console.log("object and mat data", objMatData);

            //const placeHolderImg = imgData[0].placeholder.data;

            const scene = new engine.Scene();
            const camera = new engine.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 1.0, 5000.0);
            const renderer = new engine.Renderer(canvas);
            const geometry = new engine.Cube(0.5, 0.5, 0.5);


            window.addEventListener('resize', () => {
                renderer.setSize(window.innerWidth, window.innerHeight);
            })
            const pointLight = new engine.PointLight(
                { color: [1.0, 1.0, 1.0, 1.0], intensity: 1.0, debug: true }
            );

            pointLight.position[1] += 200.0;

            // Non-material buffers
            // Set up buffers for mesh
            const dieMesh = new engine.Mesh(objMatData[0].objectData);
            //dieMesh.setupBuffers(objMatData[0]);

            // If specified material in obj file, parse it!
            if (objMatData[0].materialData) {
                dieMesh.attachShader(objMatData[0].materialData);
            } // Otherwise, parse some material seleted by user

            scene.add(dieMesh);
            scene.add(pointLight);
            // MUST be called after all objects has been added to scene
            //renderer.postInitialize(scene);

            const fl = new engine.FlyControls(camera);
            const fpsMeter = document.getElementById("fps_meter");

            let prev = 0;

            const render = now => {
                let delta = now - prev;
                let fps = Math.round(1000 / delta);
                prev = now;

                fpsMeter.innerHTML = fps;

                // Updates view matrix
                fl.update(0.1);
                // dieMesh2.rotation[0] += 0.01;
                //dieMesh2.rotation[1] += 0.01;

                // suzanneMesh.rotation[0] += 0.01;
                //  suzanneMesh.rotation[1] += 0.01;
                scene.traverse(camera);
                renderer.render(scene, camera);
                requestAnimationFrame(render);
            }
            render();
        });
    </script>

</body>

</html>